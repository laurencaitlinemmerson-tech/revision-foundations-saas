<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Children's Nursing OSCE Revision Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
<style>
  @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');

  * { font-family: 'Outfit', system-ui, sans-serif; }
  .mono { font-family: 'JetBrains Mono', monospace; }

  body { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; overflow: auto; }

  .main-wrapper { min-height: 100%; width: 100%; }

  /* ---------- Background ---------- */
  .gradient-bg {
    background: linear-gradient(
      135deg,
      #1a0b2e 0%,
      #2d1b4e 25%,
      #4a1f6f 50%,
      #6b2d8f 75%,
      #8b3da0 100%
    );
    position: relative;
    overflow: hidden;
  }

  .gradient-bg::before {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at 20% 20%, rgba(167, 70, 224, 0.15) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(244, 114, 182, 0.15) 0%, transparent 50%);
    pointer-events: none;
  }

  .particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    pointer-events: none;
    animation: float 20s infinite;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.3; }
    25% { transform: translate(30px, -30px) scale(1.2); opacity: 0.6; }
    50% { transform: translate(-20px, -60px) scale(0.8); opacity: 0.4; }
    75% { transform: translate(40px, -90px) scale(1.1); opacity: 0.5; }
  }

  /* ---------- Glass Cards ---------- */
  .glass-card {
    background: rgba(30, 15, 50, 0.6);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(167, 70, 224, 0.2);
    box-shadow:
      0 8px 32px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .glass-card:hover {
    border-color: rgba(167, 70, 224, 0.4);
  }

  /* ---------- Buttons ---------- */
  .btn-gradient {
    background: linear-gradient(135deg, #a746e0 0%, #f472b6 100%);
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(167, 70, 224, 0.4);
  }

  .btn-gradient:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(167, 70, 224, 0.6);
  }

  .btn-gradient:focus-visible {
    outline: 3px solid rgba(167, 70, 224, 0.6);
    outline-offset: 2px;
  }

  .btn-secondary {
    background: rgba(148, 163, 184, 0.1);
    border: 1px solid rgba(148, 163, 184, 0.3);
    transition: all 0.3s ease;
  }

  .btn-secondary:hover:not(:disabled) {
    background: rgba(148, 163, 184, 0.2);
    border-color: rgba(148, 163, 184, 0.5);
  }

  .btn-secondary:focus-visible {
    outline: 3px solid rgba(148, 163, 184, 0.6);
    outline-offset: 2px;
  }

  /* ---------- Topic Cards ---------- */
  .topic-card {
    background: rgba(30, 15, 50, 0.4);
    border: 2px solid rgba(167, 70, 224, 0.2);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .topic-card:hover {
    border-color: rgba(167, 70, 224, 0.6);
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(167, 70, 224, 0.3);
  }

  .topic-card:focus-visible {
    outline: 3px solid rgba(167, 70, 224, 0.6);
    outline-offset: 2px;
  }

  .topic-card.selected {
    border-color: #a746e0;
    background: rgba(167, 70, 224, 0.2);
    box-shadow: 0 0 30px rgba(167, 70, 224, 0.4);
  }

  /* ---------- Checklist Items ---------- */
  .checklist-item {
    background: rgba(30, 15, 50, 0.4);
    border-left: 3px solid rgba(148, 163, 184, 0.3);
    transition: all 0.2s ease;
  }

  .checklist-item.checked {
    background: rgba(34, 197, 94, 0.15);
    border-left-color: #22c55e;
  }

  .checklist-item.critical {
    border-left-color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
  }

  /* ---------- Tabs ---------- */
  .tab-button {
    transition: all 0.2s ease;
    border-bottom: 2px solid transparent;
  }

  .tab-button.active {
    border-bottom-color: #a746e0;
    color: #f472b6;
  }

  .tab-button:focus-visible {
    outline: 3px solid rgba(167, 70, 224, 0.6);
    outline-offset: 2px;
  }

  /* ---------- Inputs ---------- */
  input[type="checkbox"]:focus-visible,
  textarea:focus-visible,
  input:focus-visible {
    outline: 3px solid rgba(167, 70, 224, 0.6);
    outline-offset: 2px;
  }

  /* ---------- Navigator Drawer ---------- */
  .navigator-drawer {
    position: fixed;
    top: 0;
    right: -400px;
    width: 400px;
    height: 100%;
    background: rgba(20, 10, 35, 0.95);
    backdrop-filter: blur(20px);
    border-left: 1px solid rgba(167, 70, 224, 0.3);
    transition: right 0.3s ease;
    z-index: 1000;
    overflow-y: auto;
  }

  .navigator-drawer.open { right: 0; }

  .navigator-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 999;
  }

  .navigator-overlay.visible {
    opacity: 1;
    pointer-events: auto;
  }

  /* ---------- Animations ---------- */
  .fade-in { animation: fadeIn 0.4s ease-out; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .timer-warning { animation: pulse 2s infinite; }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .hint-reveal { animation: highlightPulse 2s ease-out; }

  @keyframes highlightPulse {
    0% { background: rgba(167, 70, 224, 0.4); transform: scale(1.02); }
    100% { background: rgba(30, 15, 50, 0.4); transform: scale(1); }
  }

  /* ---------- Red Pulsing Badge (Needs Work) ---------- */
  @keyframes redPulseGlow {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 0 0 rgba(239, 68, 68, 0);
      opacity: 1;
    }
    50% {
      transform: scale(1.04);
      box-shadow: 0 0 28px rgba(239, 68, 68, 0.45);
      opacity: 0.95;
    }
  }

  .pulse-red-badge {
    animation: redPulseGlow 1.3s ease-in-out infinite;
  }
</style>





  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="main-wrapper gradient-bg">
   <div id="particles"></div>
   <div id="navigator-overlay" class="navigator-overlay" onclick="closeNavigator()"></div>
   <div id="navigator-drawer" class="navigator-drawer">
    <div class="p-6">
     <div class="flex items-center justify-between mb-6">
      <h2 class="text-white text-xl font-bold flex items-center gap-2"><i data-lucide="grid-3x3" class="w-5 h-5"></i> Station Navigator</h2><button onclick="closeNavigator()" class="text-slate-400 hover:text-white"> <i data-lucide="x" class="w-6 h-6"></i> </button>
     </div>
     <div id="navigator-content"></div>
    </div>
   </div>
   <main id="main-content" class="relative p-4 md:p-6 lg:p-8 min-h-screen"></main>
  </div>
  <script>
    // ==================== CONFIGURATION ====================
    const defaultConfig = {
      app_title: "BIG Children's Nursing OSCE",
      app_subtitle: "Year 1 Revision Tool",
      primary_color: "#a746e0",
      secondary_color: "#f472b6",
      background_color: "#1a0b2e",
      text_color: "#f1f5f9",
      accent_color: "#22c55e",
      font_family: "Outfit",
      font_size: 16
    };
    
    let config = { ...defaultConfig };

    // ==================== TOPIC DEFINITIONS ====================
    // NOTE: This dictates the categories available
    const topics = [
      { id: 'handwashing', name: 'Handwashing & IPC', icon: 'droplets', color: '#10b981' },
      { id: 'personalcare', name: 'Personal Care', icon: 'heart-handshake', color: '#f97316' },
      { id: 'safety', name: 'Patient Safety', icon: 'shield-check', color: '#f59e0b' },
      { id: 'communication', name: 'Communication', icon: 'message-circle', color: '#06b6d4' },
      { id: 'respiratory', name: 'Airway & Breathing', icon: 'wind', color: '#a746e0' },
      { id: 'circulation', name: 'Circulation', icon: 'heart', color: '#ef4444' },
      { id: 'pain', name: 'Pain Assessment', icon: 'thermometer', color: '#f472b6' },
      { id: 'medication', name: 'Medication Management', icon: 'pill', color: '#8b5cf6' },
      { id: 'injection', name: 'Injection Technique', icon: 'syringe', color: '#ec4899' },
      { id: 'perioperative', name: 'Pre & Post-Op Care', icon: 'clipboard-list', color: '#14b8a6' },
      { id: 'positioning', name: 'Holding & Positioning', icon: 'move', color: '#84cc16' },
      { id: 'deteriorating', name: 'Deteriorating Child', icon: 'activity', color: '#dc2626' },
      { id: 'ngtubes', name: 'NG Tubes', icon: 'cable', color: '#06b6d4' },
      { id: 'antt', name: 'ANTT', icon: 'sparkles', color: '#a855f7' },
      { id: 'lines', name: 'Securing Lines/Tapes', icon: 'wrench', color: '#64748b' }
    ];

    // ==================== STATE MANAGEMENT ====================
    let currentView = 'selection';
    let selectedTopics = [];
    let sessionQuestions = [];
    let sessionStations = [];
    let currentIndex = 0;
    let sessionAnswers = [];
    let sessionMode = 'quiz';
    let oscePracticeMode = 'practice';
    let stationCount = 3;
    let timedMode = false;
    let timeRemaining = 0;
    let stationTimeRemaining = 0;
    let timerInterval = null;
    let timerPaused = false;
    let currentStationChecklist = {};
    let stationNotes = {};
    let flaggedStations = [];
    let currentTab = 'brief';
    let navigatorOpen = false;
    let hintRevealed = {};
    let medicationQuestions = []; // Track calculation questions specifically

    // ==================== UTILITY FUNCTIONS ====================
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // UPGRADE 1 & 2: Helper to shuffle and pick N items from an array
    function shuffleAndPickN(array, n) {
      const shuffled = shuffleArray(array);
      return shuffled.slice(0, n);
    }

    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      if (!particlesContainer) return;
      
      particlesContainer.innerHTML = '';
      const particleCount = 20;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.top = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (15 + Math.random() * 10) + 's';
        particlesContainer.appendChild(particle);
      }
    }


    // ==================== QUIZ QUESTIONS BANK ====================
    const quizBank = [
      // HANDWASHING & IPC
      {
        id: 'q1',
        topic: 'handwashing',
        question: 'What is the minimum duration for the WHO 6-step hand hygiene technique?',
        options: ['10 seconds', '15 seconds', '20 seconds', '30 seconds'],
        correct: 1,
        explanation: 'Hand hygiene should be performed for a minimum of 15-20 seconds to be effective.'
      },
      {
        id: 'q2',
        topic: 'handwashing',
        question: 'Which organisms require soap and water instead of alcohol-based hand rub?',
        options: ['MRSA only', 'C.difficile and norovirus', 'All gram-positive bacteria', 'Respiratory viruses'],
        correct: 1,
        explanation: 'C.difficile spores and norovirus are not effectively killed by ABHR - soap and water mandatory.'
      },
      {
        id: 'q3',
        topic: 'handwashing',
        question: 'What are the WHO 5 Moments for hand hygiene?',
        options: [
          'Before meals, after toileting, after procedures, before shift, after shift',
          'Before patient contact, before aseptic procedure, after body fluid exposure, after patient contact, after contact with surroundings',
          'On arrival, before break, after break, before leaving, during procedures',
          'Before gloves, after gloves, before PPE, after PPE, end of shift'
        ],
        correct: 1,
        explanation: '5 Moments: 1) Before patient contact 2) Before aseptic procedure 3) After body fluid exposure 4) After patient contact 5) After contact with patient surroundings.'
      },
      {
        id: 'q4',
        topic: 'handwashing',
        question: 'In what order should PPE be donned (put on)?',
        options: ['Gloves, Apron, Mask, Eyes', 'Apron, Mask, Eyes, Gloves', 'Mask, Eyes, Apron, Gloves', 'Apron, Gloves, Mask, Eyes'],
        correct: 1,
        explanation: 'Correct donning sequence: Apron, Mask, Eyes, Gloves (AMEG mnemonic).'
      },
      {
        id: 'q5',
        topic: 'handwashing',
        question: 'Which item should be removed FIRST when doffing PPE?',
        options: ['Apron', 'Gloves', 'Mask', 'Eye protection'],
        correct: 1,
        explanation: 'Gloves are most contaminated and should be removed first, followed by apron, then mask, then hand hygiene.'
      },
      
      // RESPIRATORY
      {
        id: 'q6',
        topic: 'respiratory',
        question: 'What is the normal respiratory rate for a 2-year-old child?',
        options: ['12-20 breaths/min', '20-30 breaths/min', '30-40 breaths/min', '40-60 breaths/min'],
        correct: 1,
        explanation: 'Normal RR for toddlers (1-3 years) is 20-30 breaths per minute.'
      },
      {
        id: 'q7',
        topic: 'respiratory',
        question: 'What does grunting respirations indicate in a child?',
        options: [
          'Normal variation in infants',
          'Attempt to maintain airway patency - serious sign',
          'Common with viral URTI',
          'Sign of mild respiratory distress'
        ],
        correct: 1,
        explanation: 'Grunting is an attempt to keep airways open by exhaling against a partially closed glottis - it indicates significant respiratory distress and should be escalated immediately.'
      },
      {
        id: 'q8',
        topic: 'respiratory',
        question: 'What is the target SpO2 for most children on room air?',
        options: ['≥88%', '≥92%', '≥94%', '100%'],
        correct: 2,
        explanation: 'Target SpO2 is ≥94% for most children (some chronic conditions have lower targets - always check orders).'
      },
      {
        id: 'q9',
        topic: 'respiratory',
        question: 'How long should you count respiratory rate in children?',
        options: ['15 seconds and multiply by 4', '30 seconds and multiply by 2', 'Full 60 seconds', 'Until you get consistent pattern'],
        correct: 2,
        explanation: 'Always count for a full 60 seconds in children as respiratory patterns can be irregular - never estimate.'
      },
      {
        id: 'q10',
        topic: 'respiratory',
        question: 'Which is the most serious sign of respiratory distress?',
        options: ['Nasal flaring', 'Intercostal recession', 'Silent chest', 'Tachypnoea'],
        correct: 2,
        explanation: 'Silent chest indicates minimal air movement and is a pre-arrest sign - more serious than wheeze. Requires immediate escalation.'
      },
      
      // CIRCULATION
      {
        id: 'q11',
        topic: 'circulation',
        question: 'What is the normal capillary refill time in children?',
        options: ['<1 second', '<2 seconds', '<3 seconds', '<5 seconds'],
        correct: 1,
        explanation: 'Normal CRT is less than 2 seconds. Prolonged CRT (>2 secs) suggests poor perfusion or shock.'
      },
      {
        id: 'q12',
        topic: 'circulation',
        question: 'Why should you never use your thumb to palpate a pulse?',
        options: [
          'Thumb is too insensitive',
          'Thumb has its own pulse which can be mistaken for patient pulse',
          'Thumb cannot detect weak pulses',
          'Thumb is too large for children'
        ],
        correct: 1,
        explanation: 'The thumb has its own strong pulse which can be mistaken for the patient\'s pulse, leading to inaccurate assessment.'
      },
      {
        id: 'q13',
        topic: 'circulation',
        question: 'What is the preferred pulse site for infants under 1 year?',
        options: ['Radial', 'Carotid', 'Brachial or femoral', 'Dorsalis pedis'],
        correct: 2,
        explanation: 'Brachial or femoral pulses are preferred in infants as the neck is short making carotid difficult, and radial may be hard to palpate.'
      },
      {
        id: 'q14',
        topic: 'circulation',
        question: 'When does hypotension typically occur in paediatric shock?',
        options: ['Early - first sign', 'Mid-stage - reliable indicator', 'Late - decompensated shock', 'Hypotension does not occur in children'],
        correct: 2,
        explanation: 'Children compensate well in shock - hypotension is a LATE sign indicating decompensated shock. Do not wait for low BP to identify shock.'
      },
      {
        id: 'q15',
        topic: 'circulation',
        question: 'What is the correct BP cuff bladder width for children?',
        options: ['40% of arm circumference', '60% of arm circumference', '80% of arm circumference', '100% of arm circumference'],
        correct: 2,
        explanation: 'BP cuff bladder should cover 80% of arm circumference. Too small gives falsely high readings; too large gives falsely low readings.'
      },
      
      // MEDICATION
      {
        id: 'q16',
        topic: 'medication',
        question: 'How many Rights of Medication Administration are there?',
        options: ['5', '7', '9', '10'],
        correct: 2,
        explanation: 'There are 9 Rights: Patient, Drug, Dose, Route, Time, Documentation, Reason, Response, and Right to Refuse.'
      },
      {
        id: 'q17',
        topic: 'medication',
        question: 'When should you sign the prescription chart for a medication?',
        options: ['Before drawing up to confirm you will give it', 'After drawing up but before giving', 'Immediately AFTER administering to patient', 'At end of shift for all medications given'],
        correct: 2,
        explanation: 'NEVER sign before administration - only sign AFTER the medication has been given. Signing early is falsification of records.'
      },
      {
        id: 'q18',
        topic: 'medication',
        question: 'What is the maximum number of paracetamol doses in 24 hours?',
        options: ['3 doses', '4 doses', '6 doses', '8 doses'],
        correct: 1,
        explanation: 'Maximum 4 doses of paracetamol in 24 hours. Overdose causes liver failure. Always check when last dose was given.'
      },
      {
        id: 'q19',
        topic: 'medication',
        question: 'Which of the following is a critical fail in medication administration?',
        options: [
          'Not explaining medication to parent',
          'Not checking patient wristband',
          'Not documenting immediately',
          'Not having BNFc available'
        ],
        correct: 1,
        explanation: 'Not checking patient wristband is a critical fail - can result in wrong patient medication error which can be fatal.'
      },
      {
        id: 'q20',
        topic: 'medication',
        question: 'How many nurses are required for controlled drug administration?',
        options: ['1 (RN only)', '2 (both must witness all steps)', '2 (one to give, one to check)', '3 (for safety)'],
        correct: 1,
        explanation: 'Two nurses required throughout entire process - both must witness drawing up, administration, and sign CD register.'
      },
      
      // SAFETY
      {
        id: 'q21',
        topic: 'safety',
        question: 'Which framework is used for structured clinical communication and handover?',
        options: ['ABCDE', 'SBAR', 'PEWS', 'NEWS'],
        correct: 1,
        explanation: 'SBAR (Situation, Background, Assessment, Recommendation) is the standard framework for clinical handover.'
      },
      {
        id: 'q22',
        topic: 'safety',
        question: 'What does the "S" in SBAR stand for and what should it include?',
        options: [
          'Safety - list all safety concerns',
          'Situation - state patient details and concern clearly in one sentence',
          'Summary - brief overview of patient history',
          'Status - current patient condition'
        ],
        correct: 1,
        explanation: 'Situation should state WHO you are, WHO the patient is, and WHAT the problem is - clearly and concisely in opening sentence.'
      },
      {
        id: 'q23',
        topic: 'safety',
        question: 'How many patient identifiers should be checked before any procedure?',
        options: ['1 (name)', '2 (name and DOB)', '3 (name, DOB, and NHS number)', '4 (name, DOB, NHS number, and address)'],
        correct: 2,
        explanation: 'Three-point identification: 1) Ask patient to state name/DOB 2) Check wristband 3) Cross-check with prescription/notes.'
      },
      {
        id: 'q24',
        topic: 'safety',
        question: 'Which is a red flag for non-accidental injury in bruising patterns?',
        options: [
          'Bruising over shins in mobile toddler',
          'Bruising to soft tissue areas (face, abdomen, inner thighs) in non-mobile infant',
          'Single bruise on forehead after reported fall',
          'Bruising to knees in active 5-year-old'
        ],
        correct: 1,
        explanation: '"Babies don\'t cruise, they don\'t bruise" - bruising in non-mobile infants or to soft tissue areas (TED: Trunk, Ears, Neck) highly concerning for NAI.'
      },
      {
        id: 'q25',
        topic: 'safety',
        question: 'What should you do if you suspect non-accidental injury?',
        options: [
          'Confront the parents immediately',
          'Investigate by asking detailed questions to the child',
          'Document findings and immediately inform senior nurse/safeguarding lead',
          'Wait to gather more evidence over next few days'
        ],
        correct: 2,
        explanation: 'Do NOT investigate yourself or confront parents. Document factually and immediately inform senior/Named Nurse for Safeguarding. Never delay.'
      },
      
      // PAIN
      {
        id: 'q26',
        topic: 'pain',
        question: 'Which pain assessment tool is appropriate for a 2-year-old?',
        options: ['Numerical Rating Scale 0-10', 'Visual Analogue Scale', 'FLACC', 'McGill Pain Questionnaire'],
        correct: 2,
        explanation: 'FLACC (Face, Legs, Activity, Cry, Consolability) is used for children under 3 years or non-verbal children of any age.'
      },
      {
        id: 'q27',
        topic: 'pain',
        question: 'Which pain scale is appropriate for a 5-year-old?',
        options: ['FLACC', 'Wong-Baker FACES', 'Numerical 0-10', 'PEWS'],
        correct: 1,
        explanation: 'Wong-Baker FACES scale is appropriate for ages 3-7 years. Shows faces ranging from happy to crying for child to point to.'
      },
      {
        id: 'q28',
        topic: 'pain',
        question: 'At what age can children typically use a numerical rating scale (0-10) for pain?',
        options: ['3 years', '5 years', '7+ years', '10+ years'],
        correct: 2,
        explanation: 'Numerical rating scales can typically be used from age 7+ when children understand number concepts and scaling.'
      },
      {
        id: 'q29',
        topic: 'pain',
        question: 'What does FLACC stand for?',
        options: [
          'Frequency, Location, Activity, Character, Crying',
          'Face, Legs, Activity, Cry, Consolability',
          'Facial expression, Level, Assessment, Care, Comfort',
          'Fear, Loss, Anxiety, Crying, Coping'
        ],
        correct: 1,
        explanation: 'FLACC: Face, Legs, Activity, Cry, Consolability. Each scored 0-2 for total score of 0-10.'
      },
      {
        id: 'q30',
        topic: 'pain',
        question: 'What is the most important principle in paediatric pain assessment?',
        options: [
          'Use the same tool for all ages',
          'Always believe the child\'s pain report',
          'Only assess pain if child complains',
          'Focus on objective signs only'
        ],
        correct: 1,
        explanation: 'Pain is subjective - always believe the child\'s pain report. Never dismiss or minimize their pain experience.'
      },
      
      // COMMUNICATION
      {
        id: 'q31',
        topic: 'communication',
        question: 'When introducing yourself to a 6-year-old and parent, who should you speak to first?',
        options: ['Always parent as they give consent', 'Always child as they are your patient', 'Child first, then parent', 'Parent first, then child'],
        correct: 2,
        explanation: 'Speak to the child first as they are your patient - this builds rapport and shows respect. Then include parent appropriately.'
      },
      {
        id: 'q32',
        topic: 'communication',
        question: 'What is the difference between consent and assent in children?',
        options: [
          'They are the same thing',
          'Consent from parent (legal), assent from child (agreement)',
          'Consent for procedures, assent for medications',
          'Consent is verbal, assent is written'
        ],
        correct: 1,
        explanation: 'Consent is legal permission from parent/guardian. Assent is the child\'s agreement to participate - both are needed where developmentally appropriate.'
      },
      {
        id: 'q33',
        topic: 'communication',
        question: 'What should you NEVER say to a child before a painful procedure?',
        options: [
          '"This might feel uncomfortable"',
          '"It won\'t hurt at all"',
          '"It will feel like a sharp scratch"',
          '"It will hurt for a moment but will be quick"'
        ],
        correct: 1,
        explanation: 'NEVER lie to children. Saying "it won\'t hurt" when it will destroys trust permanently. Be honest: "It will hurt for a moment like a scratch, but it will be quick."'
      },
      {
        id: 'q34',
        topic: 'communication',
        question: 'What does SPIKES framework stand for in breaking bad news?',
        options: [
          'Situation, Patient, Information, Knowledge, Explanation, Summary',
          'Setting, Perception, Invitation, Knowledge, Emotions, Strategy',
          'Safety, Privacy, Information, Kindness, Empathy, Support',
          'Space, Prepare, Inform, Keep calm, Explain, Summarize'
        ],
        correct: 1,
        explanation: 'SPIKES: Setting (private), Perception (what they know), Invitation (want information?), Knowledge (share info), Emotions (respond), Strategy (next steps).'
      },
      {
        id: 'q35',
        topic: 'communication',
        question: 'What is the correct way to document in patient notes?',
        options: [
          'Black ink, signed, printed name, dated and timed',
          'Any color ink, signed at end of shift',
          'Blue ink, signed, dated',
          'Black ink, initialed, dated'
        ],
        correct: 0,
        explanation: 'Always use black indelible ink, sign with full signature, print name, include designation, date and time every entry.'
      },
      
      // PERSONAL CARE
      {
        id: 'q36',
        topic: 'personalcare',
        question: 'What is the mnemonic for assessing pressure areas in children?',
        options: ['ABCDE', 'HEADS', 'SHEOE', 'PQRST'],
        correct: 2,
        explanation: 'SHEOE: Sacrum, Heels, Elbows, Occiput (back of head), Ears - key pressure areas in children that differ from adults.'
      },
      {
        id: 'q37',
        topic: 'personalcare',
        question: 'How often should oral hygiene be performed in NBM (nil by mouth) patients?',
        options: ['Once daily', 'Twice daily', 'Every 4-6 hours', 'Every 8 hours'],
        correct: 2,
        explanation: 'NBM patients need oral hygiene every 4-6 hours minimum to prevent dry mouth, oral thrush, and mucositis.'
      },
      {
        id: 'q38',
        topic: 'personalcare',
        question: 'When performing a bed bath, what is the correct washing order?',
        options: [
          'Feet to head',
          'Clean to dirty (face -> upper body -> lower body -> perineum)',
          'Dirty to clean',
          'Random order as preferred'
        ],
        correct: 1,
        explanation: 'Always wash clean to dirty: face (water only, no soap) -> neck -> arms -> chest -> abdomen -> legs -> back -> perineum (fresh water).'
      },
      {
        id: 'q39',
        topic: 'personalcare',
        question: 'What position should a child be in during oral hygiene if they have reduced consciousness?',
        options: ['Flat on back', 'Sitting upright 90 degrees', 'Semi-upright or on side', 'Head down'],
        correct: 2,
        explanation: 'Semi-upright or side-lying position to prevent aspiration. NEVER flat - high aspiration risk. Suction must be available.'
      },
      {
        id: 'q40',
        topic: 'personalcare',
        question: 'For girls, which direction should you clean during nappy change?',
        options: ['Back to front', 'Front to back', 'Side to side', 'Direction does not matter'],
        correct: 1,
        explanation: 'Always clean front to back for girls to prevent UTI by avoiding fecal contamination of urethra.'
      },
      
      // INJECTION
      {
        id: 'q41',
        topic: 'injection',
        question: 'What is the preferred IM injection site for children under 3 years?',
        options: ['Deltoid', 'Vastus lateralis (thigh)', 'Gluteal', 'Dorsogluteal'],
        correct: 1,
        explanation: 'Vastus lateralis (outer thigh) is preferred in children under 3 years. Deltoid muscle too small, gluteal risk of sciatic nerve damage.'
      },
      {
        id: 'q42',
        topic: 'injection',
        question: 'At what angle should IM injections be administered?',
        options: ['15 degrees', '45 degrees', '90 degrees', '180 degrees'],
        correct: 2,
        explanation: 'IM injections given at 90-degree angle to ensure medication reaches muscle. SC injections are 45 degrees.'
      },
      {
        id: 'q43',
        topic: 'injection',
        question: 'What should you do with a needle after use?',
        options: [
          'Resheath and dispose',
          'Place on work surface and dispose later',
          'Immediately dispose in sharps bin without resheathing',
          'Break off needle before disposal'
        ],
        correct: 2,
        explanation: 'NEVER resheath needles - immediate disposal in sharps bin at point of use. Never leave needles on surfaces - needlestick injury risk.'
      },
      {
        id: 'q44',
        topic: 'injection',
        question: 'What size needle is typically used for IM injection in children?',
        options: ['19-21G', '23-25G', '27-29G', '30-32G'],
        correct: 1,
        explanation: '23-25G needle appropriate for paediatric IM injections. Length 16-25mm depending on age and site.'
      },
      {
        id: 'q45',
        topic: 'injection',
        question: 'Where is the vastus lateralis muscle located?',
        options: [
          'Upper arm',
          'Outer thigh - middle third between hip and knee',
          'Buttocks',
          'Inner thigh'
        ],
        correct: 1,
        explanation: 'Vastus lateralis is outer aspect of thigh, middle third between hip and knee. Large muscle suitable for IM injections in children.'
      },
      
      // PERIOPERATIVE
      {
        id: 'q46',
        topic: 'perioperative',
        question: 'What does NPO (nil per os) mean?',
        options: ['No pain observed', 'Nothing by mouth', 'Normal post-op', 'Nurse present only'],
        correct: 1,
        explanation: 'NPO means nothing by mouth - important pre-operative instruction to reduce aspiration risk during anaesthesia.'
      },
      {
        id: 'q47',
        topic: 'perioperative',
        question: 'What are the standard pre-operative fasting times for clear fluids in children over 6 months?',
        options: ['1 hour', '2 hours', '4 hours', '6 hours'],
        correct: 1,
        explanation: 'Clear fluids can be given up to 2 hours pre-op. Breast milk 4 hours, formula/food 6 hours (2-4-6 rule).'
      },
      {
        id: 'q48',
        topic: 'perioperative',
        question: 'What position should a child be in immediately post-operatively?',
        options: ['Flat on back', 'Recovery position if unconscious', 'Sitting upright', 'Prone position'],
        correct: 1,
        explanation: 'Recovery position (lateral) if unconscious to maintain airway and prevent aspiration. Once awake, semi-upright if tolerated.'
      },
      {
        id: 'q49',
        topic: 'perioperative',
        question: 'What is the most important post-operative observation?',
        options: ['Temperature', 'Airway and breathing', 'Pain score', 'Wound site'],
        correct: 1,
        explanation: 'AIRWAY is always priority. Use ABCDE approach: Airway, Breathing, Circulation, Disability, Exposure.'
      },
      {
        id: 'q50',
        topic: 'perioperative',
        question: 'How often should post-operative observations be recorded initially?',
        options: ['Every 5 minutes', 'Every 15 minutes', 'Every 30 minutes', 'Every hour'],
        correct: 1,
        explanation: 'Every 15 minutes initially until stable, then reduce frequency as per protocol (usually every 30 min, then hourly).'
      },
      
      // POSITIONING
      {
        id: 'q51',
        topic: 'positioning',
        question: 'What is therapeutic holding?',
        options: [
          'Restraining child against their will',
          'Minimal restriction to facilitate procedure while maintaining dignity',
          'Sedating child before procedures',
          'Having parents hold child down'
        ],
        correct: 1,
        explanation: 'Therapeutic holding uses minimal necessary restriction to safely complete procedure while maintaining child dignity and minimizing distress.'
      },
      {
        id: 'q52',
        topic: 'positioning',
        question: 'Who should NOT hold a child during a distressing procedure?',
        options: ['Experienced nurse', 'Healthcare assistant', 'Parent/carer', 'Play specialist'],
        correct: 2,
        explanation: 'Parents should comfort, not restrain. Holding can damage trust relationship. Staff should hold while parent comforts.'
      },
      {
        id: 'q53',
        topic: 'positioning',
        question: 'What is the correct position for lumbar puncture in infants?',
        options: [
          'Prone with pillow under abdomen',
          'Lateral position with knees to chest and head flexed',
          'Sitting upright',
          'Supine with legs extended'
        ],
        correct: 1,
        explanation: 'Lateral fetal position: on side, knees drawn up to chest, head flexed forward to open vertebral spaces. NEVER over-flex neck (airway risk).'
      },
      {
        id: 'q54',
        topic: 'positioning',
        question: 'When is therapeutic holding considered restraint?',
        options: [
          'Anytime you hold a child',
          'When used without consent or for staff convenience',
          'During any clinical procedure',
          'When child is crying'
        ],
        correct: 1,
        explanation: 'Becomes restraint if: no consent, not in child best interest, for staff convenience, or excessive force. Must be last resort and documented.'
      },
      {
        id: 'q55',
        topic: 'positioning',
        question: 'What should be considered before therapeutic holding?',
        options: [
          'Staff convenience only',
          'Distraction, preparation, play therapy, topical anaesthesia',
          'Whether parents are present',
          'Time of day'
        ],
        correct: 1,
        explanation: 'Therapeutic holding is LAST resort. Try: preparation, distraction, play therapy, topical anaesthesia, developmentally appropriate explanation.'
      },
      
      // DETERIORATING CHILD
      {
        id: 'q56',
        topic: 'deteriorating',
        question: 'What does PEWS stand for?',
        options: [
          'Paediatric Early Warning Score',
          'Potential Emergency Warning System',
          'Pre-Emergency Ward Safety',
          'Patient Evaluation Warning Score'
        ],
        correct: 0,
        explanation: 'Paediatric Early Warning Score - objective tool to identify deteriorating children and trigger appropriate escalation.'
      },
      {
        id: 'q57',
        topic: 'deteriorating',
        question: 'What should you do if a child triggers PEWS escalation criteria?',
        options: [
          'Document and continue observations',
          'Immediately inform senior nurse/doctor as per protocol',
          'Wait until end of shift',
          'Increase observation frequency only'
        ],
        correct: 1,
        explanation: 'PEWS triggers require immediate escalation to senior staff. Never delay. Increasing observations alone is insufficient.'
      },
      {
        id: 'q58',
        topic: 'deteriorating',
        question: 'Which is a red flag sign in a deteriorating child?',
        options: [
          'Temperature 38.5°C',
          'Appears unwell to healthcare professional',
          'Mild tachycardia',
          'Slight pallor'
        ],
        correct: 1,
        explanation: '"Appears unwell to healthcare professional" is a red flag in NICE guidance - trust clinical instinct and escalate immediately.'
      },
      {
        id: 'q59',
        topic: 'deteriorating',
        question: 'What is the correct order of the ABCDE assessment?',
        options: [
          'Assessment, Breathing, Circulation, Disability, Examination',
          'Airway, Breathing, Circulation, Disability, Exposure',
          'Airway, Blood pressure, Cardiac, Drugs, ECG',
          'Alert, Breathing, Conscious, Danger, Emergency'
        ],
        correct: 1,
        explanation: 'ABCDE: Airway, Breathing, Circulation, Disability (neuro), Exposure (temp/rash). Systematic approach to assessment and treatment.'
      },
      {
        id: 'q60',
        topic: 'deteriorating',
        question: 'In ABCDE approach, what should you do at each step?',
        options: [
          'Assess all steps then treat',
          'Assess and treat problems before moving to next step',
          'Assess quickly and call for help',
          'Document findings at each step'
        ],
        correct: 1,
        explanation: 'Treat life-threatening problems as you find them before moving to next step. E.g., open airway before assessing breathing.'
      },
      
      // NG TUBES
      {
        id: 'q61',
        topic: 'ngtubes',
        question: 'What are the two safe methods to confirm NG tube position?',
        options: [
          'Aspirate testing and auscultation',
          'pH testing of aspirate and X-ray',
          'X-ray and auscultation',
          'Visual inspection and pH testing'
        ],
        correct: 1,
        explanation: 'ONLY pH ≤5.5 of aspirate OR X-ray are safe. Auscultation (whoosh test) is NOT safe and should never be used.'
      },
      {
        id: 'q62',
        topic: 'ngtubes',
        question: 'What pH indicates safe NG tube placement in the stomach?',
        options: ['pH ≤4', 'pH ≤5.5', 'pH ≤7', 'Any acidic pH'],
        correct: 1,
        explanation: 'pH must be ≤5.5 to confirm gastric placement. If pH >5.5, do NOT use tube - reposition and retest or get X-ray.'
      },
      {
        id: 'q63',
        topic: 'ngtubes',
        question: 'Why is the whoosh test (auscultation method) dangerous?',
        options: [
          'It is time consuming',
          'It cannot differentiate between stomach and lung placement',
          'It requires too much equipment',
          'It is uncomfortable for child'
        ],
        correct: 1,
        explanation: 'Whoosh test cannot distinguish stomach from lung/oesophagus. Has caused deaths from feeding into lungs. NEVER use this method.'
      },
      {
        id: 'q64',
        topic: 'ngtubes',
        question: 'When should NG tube position be checked?',
        options: [
          'Once at insertion only',
          'Before EVERY feed or medication and if displaced',
          'Once per shift',
          'Only if child vomits'
        ],
        correct: 1,
        explanation: 'Check before EVERY use (feed/meds) and after vomiting, retching, coughing fits. Tubes can migrate - never assume position.'
      },
      {
        id: 'q65',
        topic: 'ngtubes',
        question: 'What should you do if you cannot obtain NG aspirate?',
        options: [
          'Proceed with feeding anyway',
          'Use whoosh test instead',
          'Try repositioning child, advance/withdraw tube 10cm, wait 15-30 min, or get X-ray',
          'Remove tube and reinsert'
        ],
        correct: 2,
        explanation: 'Try: turn child on left side, advance/withdraw 10-20cm, give time, flush with air. If still no aspirate - X-ray required. DO NOT feed.'
      },
      
      // ANTT
      {
        id: 'q66',
        topic: 'antt',
        question: 'What does ANTT stand for?',
        options: [
          'Always Note Technique Training',
          'Aseptic Non-Touch Technique',
          'Antibacterial Nursing Treatment Technique',
          'Advanced Nursing Technical Training'
        ],
        correct: 1,
        explanation: 'Aseptic Non-Touch Technique - standardized approach to aseptic procedures to prevent infection.'
      },
      {
        id: 'q67',
        topic: 'antt',
        question: 'What are Key Parts in ANTT?',
        options: [
          'The most expensive equipment',
          'Parts that if contaminated could cause infection',
          'Parts that need sterilizing',
          'The main steps of procedure'
        ],
        correct: 1,
        explanation: 'Key Parts: must remain sterile as direct contact with patient or sterile fluids (e.g., syringe tip, IV hub, wound). Protected by Key Sites.'
      },
      {
        id: 'q68',
        topic: 'antt',
        question: 'What is a Key Site in ANTT?',
        options: [
          'The location where procedure performed',
          'The site that must be kept sterile to protect Key Parts',
          'The patient vulnerable area',
          'The place equipment is stored'
        ],
        correct: 1,
        explanation: 'Key Site: area that Key Part enters (e.g., IV insertion site, wound bed). Must protect from contamination.'
      },
      {
        id: 'q69',
        topic: 'antt',
        question: 'What is the difference between Standard and Surgical ANTT?',
        options: [
          'No real difference',
          'Standard for simple/short procedures, Surgical for complex/longer procedures requiring larger sterile field',
          'Standard for nurses, Surgical for doctors',
          'Standard for wards, Surgical for theatre'
        ],
        correct: 1,
        explanation: 'Standard ANTT: <20 min, small Key Parts (e.g., IV access). Surgical ANTT: >20 min, large/multiple Key Parts (e.g., central line, wound dressing).'
      },
      {
        id: 'q70',
        topic: 'antt',
        question: 'When must Key Parts be protected in ANTT?',
        options: [
          'Only during actual procedure',
          'From point of preparation through entire procedure until secured',
          'Only when touching patient',
          'Just during insertion'
        ],
        correct: 1,
        explanation: 'Key Parts must be protected from preparation (opening packaging) through entire procedure until safely secured/disposed. Continuous protection essential.'
      },
      
      // LINES & TAPES
      {
        id: 'q71',
        topic: 'lines',
        question: 'Why is securing IV cannulas properly critical in children?',
        options: [
          'For aesthetics',
          'Prevents dislodgement, extravasation injury, and infection',
          'To make parents happy',
          'Hospital policy requirement'
        ],
        correct: 1,
        explanation: 'Proper securing prevents: accidental removal, extravasation (tissue damage from IV fluids leaking), infection, and need for re-siting.'
      },
      {
        id: 'q72',
        topic: 'lines',
        question: 'What should be visible after securing an IV cannula?',
        options: [
          'Nothing - fully covered for protection',
          'Insertion site must be visible for monitoring',
          'Only the hub',
          'The entire cannula'
        ],
        correct: 1,
        explanation: 'Insertion site MUST be visible to observe for signs of extravasation, phlebitis, or infection (redness, swelling, blanching).'
      },
      {
        id: 'q73',
        topic: 'lines',
        question: 'What are early signs of IV extravasation?',
        options: [
          'Pyrexia and tachycardia',
          'Swelling, blanching, coolness, pain at site',
          'Bleeding from site',
          'Redness only'
        ],
        correct: 1,
        explanation: 'Extravasation signs: swelling, blanching/tightness, coolness, pain, slowed infusion. STOP infusion immediately and inform senior - can cause tissue necrosis.'
      },
      {
        id: 'q74',
        topic: 'lines',
        question: 'How should an NG tube be secured in children?',
        options: [
          'Tape to forehead',
          'Tape to cheek avoiding pressure on nostril',
          'Not secured to allow movement',
          'Tape wrapped around head'
        ],
        correct: 1,
        explanation: 'Secure to cheek with hypoallergenic tape, avoiding pressure on nostril (can cause necrosis). Never tape to forehead. Check skin integrity regularly.'
      },
      {
        id: 'q75',
        topic: 'lines',
        question: 'What is the purpose of a Broviack or Hickman line?',
        options: [
          'Short-term IV access',
          'Long-term central venous access for chemotherapy/TPN',
          'Arterial blood gas monitoring',
          'Emergency venous access'
        ],
        correct: 1,
        explanation: 'Central venous catheters (CVC) for long-term use: chemotherapy, TPN, frequent blood sampling. Require strict ANTT and exit site care to prevent infection.'
      }
    ];

    // ==================== OSCE STATION BANK ====================
    const stationBank = [
      // ========== HANDWASHING & IPC STATIONS ==========
      {
        id: 'hand-1',
        topic: 'handwashing',
        title: 'WHO 6-Step Hand Hygiene Technique',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Demonstrate the WHO 6-step hand hygiene technique using soap and water. Explain when to use soap vs alcohol gel.',
        equipment: ['Sink with running water', 'Liquid soap', 'Paper towels', 'Alcohol hand gel', 'Clinical waste bin'],
        checklist: {
          preparation: [
            'Remove all hand jewellery',
            'Ensure nails short and clean',
            'Bare below elbows',
            'Check water temperature'
          ],
          assessment: [
            'Identify need for hand hygiene',
            'Determine if soap or ABHR appropriate'
          ],
          interventions: [
            'Wet hands thoroughly',
            'Apply sufficient soap',
            'Step 1: Rub palms together',
            'Step 2: Right palm over left dorsum and vice versa',
            'Step 3: Palm to palm with fingers interlaced',
            'Step 4: Backs of fingers to opposing palms',
            'Step 5: Rotational rubbing of thumbs',
            'Step 6: Rotational rubbing with clasped fingers',
            'Continue for 15-20 seconds',
            'Rinse thoroughly',
            'Dry completely with paper towel',
            'Use paper towel to turn off tap'
          ],
          communication: [
            'Explain importance to parent',
            'Describe 5 Moments for hand hygiene',
            'Discuss when soap mandatory vs ABHR'
          ],
          safetyRedFlags: [
            'Duration less than 15 seconds',
            'Steps missed',
            'Wearing hand jewellery'
          ],
          documentation: [
            'Report hand skin issues to senior',
            'Follow local audit policy'
          ]
        },
        tips: [
          'C.diff and norovirus require soap and water',
          'Most missed areas: thumbs, fingertips, backs of fingers',
          'WHO 5 Moments: Before patient, Before aseptic, After body fluid, After patient, After surroundings'
        ],
        warnings: [
          'Never use ABHR on visibly soiled hands',
          'Hand hygiene is single most important IPC measure',
          'False nails not permitted in clinical practice'
        ],
        mnemonics: [
          '5 Moments: Before patient, Before aseptic, After body fluid, After patient, After surroundings'
        ],
        scoring: {
          criticalFails: [
            'Did not complete all 6 steps',
            'Duration less than 15 seconds'
          ],
          marks: [
            { item: 'Preparation (jewellery removal, bare below elbows)', points: 2, domain: 'preparation' },
            { item: 'All 6 steps performed correctly', points: 6, domain: 'interventions' },
            { item: 'Adequate duration (15-20 seconds)', points: 2, domain: 'interventions' }
          ]
        }
      },

      // ========== RESPIRATORY STATIONS ==========
      {
        id: 'resp-1',
        topic: 'respiratory',
        title: 'Respiratory Assessment in Child',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Perform a complete respiratory assessment on this 4-year-old child with suspected respiratory distress. Report findings using SBAR.',
        equipment: ['Stethoscope', 'Pulse oximeter', 'Watch with second hand', 'Observation chart'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure in age-appropriate language',
            'Gain consent from parent and assent from child',
            'Wash hands',
            'Ensure child comfort and privacy'
          ],
          assessment: [
            'Observe work of breathing BEFORE touching',
            'Count respiratory rate for full 60 seconds',
            'Assess respiratory pattern (regular/irregular)',
            'Look for nasal flaring',
            'Check for head bobbing',
            'Observe for intercostal recession',
            'Check for subcostal recession',
            'Look for tracheal tug',
            'Listen for grunting, stridor, wheeze',
            'Assess color (cyanosis, pallor)',
            'Apply pulse oximeter',
            'Auscultate chest (anterior and posterior)',
            'Check capillary refill time'
          ],
          interventions: [
            'Document all findings accurately',
            'Calculate PEWS score if applicable',
            'Position child for comfort (upright if distressed)'
          ],
          communication: [
            'Explain findings to parent',
            'Use SBAR to handover to senior',
            'Reassure child throughout'
          ],
          safetyRedFlags: [
            'Silent chest - immediate escalation',
            'Grunting - severe distress sign',
            'SpO2 <92% - requires oxygen',
            'Severe recession - impending respiratory failure'
          ],
          documentation: [
            'Record all observations on chart',
            'Document PEWS score',
            'Note time and escalation actions'
          ]
        },
        tips: [
          'Always count RR for full 60 seconds in children',
          'Observe BEFORE touching - child may cry when touched',
          'Normal RR varies by age: Infant 30-60, Toddler 20-30, School age 18-25'
        ],
        warnings: [
          'Silent chest more serious than wheeze',
          'Grunting = serious sign - escalate immediately'
        ],
        mnemonics: [
          'TINS: Tracheal tug, Intercostal recession, Nasal flaring, Subcostal recession'
        ],
        scoring: {
          criticalFails: [
            'Did not count RR for full 60 seconds',
            'Did not assess before touching child',
            'Failed to recognize red flags'
          ],
          marks: [
            { item: 'Introduction and consent', points: 2, domain: 'preparation' },
            { item: 'Systematic respiratory assessment', points: 4, domain: 'assessment' },
            { item: 'SBAR handover', points: 2, domain: 'communication' }
          ]
        }
      },

      // ========== CIRCULATION STATIONS ==========
      {
        id: 'circ-1',
        topic: 'circulation',
        title: 'Pulse Assessment in Infant',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Assess the pulse of this 8-month-old infant. Demonstrate correct technique and interpret findings.',
        equipment: ['Watch with second hand', 'Observation chart', 'Hand sanitizer'],
        checklist: {
          preparation: [
            'Introduce self to parent',
            'Explain procedure to parent',
            'Wash hands thoroughly',
            'Ensure infant calm (not crying)',
            'Position infant comfortably'
          ],
          assessment: [
            'Select appropriate pulse site (brachial or femoral)',
            'Use pads of index and middle fingers (NOT thumb)',
            'Palpate pulse gently',
            'Count for full 60 seconds',
            'Assess pulse rate',
            'Assess pulse rhythm (regular/irregular)',
            'Assess pulse volume/strength',
            'Compare both sides if appropriate',
            'Note skin temperature and color'
          ],
          interventions: [
            'Document pulse rate accurately',
            'Record pulse quality and rhythm',
            'Compare to age-appropriate norms'
          ],
          communication: [
            'Explain findings to parent',
            'Discuss normal ranges for infant age',
            'Report concerns to senior nurse'
          ],
          safetyRedFlags: [
            'Weak/thready pulse - signs of shock',
            'Bounding pulse - possible sepsis/fever',
            'Irregular rhythm - requires medical review',
            'Unable to palpate pulse - emergency'
          ],
          documentation: [
            'Record rate, rhythm, and volume',
            'Note time of assessment',
            'Document site used',
            'Include any escalation actions'
          ]
        },
        tips: [
          'Brachial pulse: inner aspect of upper arm between bicep and tricep',
          'Femoral pulse: groin crease, halfway between hip and pubic bone',
          'Normal infant HR: 100-160 bpm (awake), 80-140 bpm (sleeping)',
          'Never use your thumb - it has its own pulse!'
        ],
        warnings: [
          'Crying infant will have elevated HR - wait until calm',
          'Never use carotid in infants - short neck makes it difficult',
          'Weak pulse with tachycardia = shock until proven otherwise'
        ],
        mnemonics: [
          'RRV: Rate, Rhythm, Volume - assess all three components'
        ],
        scoring: {
          criticalFails: [
            'Used thumb instead of fingers',
            'Did not count for full 60 seconds',
            'Failed to identify abnormal pulse'
          ],
          marks: [
            { item: 'Correct pulse site selection', points: 2, domain: 'assessment' },
            { item: 'Proper technique (fingers, not thumb)', points: 2, domain: 'assessment' },
            { item: 'Counted for full 60 seconds', points: 2, domain: 'assessment' },
            { item: 'Assessed rate, rhythm, and volume', points: 2, domain: 'assessment' }
          ]
        }
      },

      {
        id: 'circ-2',
        topic: 'circulation',
        title: 'Blood Pressure Measurement in Child',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Measure the blood pressure of this 6-year-old child. Use correct equipment and technique.',
        equipment: ['Appropriately sized BP cuff', 'Sphygmomanometer or automated BP machine', 'Stethoscope (manual method)', 'Observation chart'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure in child-friendly terms',
            'Wash hands',
            'Ensure child has rested for 5 minutes',
            'Position child seated or lying comfortably',
            'Ensure arm supported at heart level',
            'Remove tight clothing from arm'
          ],
          assessment: [
            'Select correct cuff size (bladder 80% of arm circumference)',
            'Locate brachial artery',
            'Apply cuff 2-3cm above antecubital fossa',
            'Ensure cuff snug but not tight',
            'Position cuff bladder over brachial artery',
            'Verify arm at heart level',
            'Allow child to relax (distraction if needed)',
            'Take measurement (manual or automated)',
            'Record systolic and diastolic pressure',
            'Repeat if reading abnormal or unclear'
          ],
          interventions: [
            'Document BP reading accurately',
            'Compare to age/height percentile charts',
            'Calculate mean arterial pressure if needed',
            'Note any difficulty obtaining reading'
          ],
          communication: [
            'Warn child about squeezing sensation',
            'Praise child for cooperation',
            'Explain findings to parent',
            'Report abnormal readings to senior'
          ],
          safetyRedFlags: [
            'Hypotension in child - late sign of shock',
            'Hypertension - may indicate renal/cardiac issues',
            'Wide pulse pressure - potential increased ICP',
            'Unable to obtain reading - may indicate poor perfusion'
          ],
          documentation: [
            'Record systolic/diastolic pressures',
            'Note cuff size used',
            'Document arm used (left/right)',
            'Record time and patient position'
          ]
        },
        tips: [
          'Cuff too small = falsely high reading',
          'Cuff too large = falsely low reading',
          'Normal pediatric BP varies by age, height, and sex - use charts',
          'Hypotension is a LATE sign in pediatric shock'
        ],
        warnings: [
          'Never assume child is normotensive based on BP alone',
          'Children compensate well in shock - normal BP does NOT rule out shock',
          'Always use age-appropriate cuff size'
        ],
        mnemonics: [
          'Cuff size rule: Width = 80% of arm circumference, Length = covers 80-100% of arm'
        ],
        scoring: {
          criticalFails: [
            'Used incorrect cuff size',
            'Did not position arm at heart level',
            'Failed to recognize abnormal reading'
          ],
          marks: [
            { item: 'Correct cuff size selection', points: 2, domain: 'preparation' },
            { item: 'Proper cuff placement and positioning', points: 2, domain: 'assessment' },
            { item: 'Accurate measurement technique', points: 2, domain: 'assessment' },
            { item: 'Interpretation and documentation', points: 2, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'circ-3',
        topic: 'circulation',
        title: 'Capillary Refill Time Assessment',
        difficulty: 'easy',
        estimatedMinutes: 5,
        candidateInstructions: 'Assess capillary refill time in this 3-year-old child. Demonstrate technique and interpret findings.',
        equipment: ['Watch with second hand', 'Observation chart', 'Hand sanitizer'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure simply to child',
            'Wash hands',
            'Ensure child in warm environment',
            'Ensure adequate lighting',
            'Position child comfortably'
          ],
          assessment: [
            'Select appropriate site (fingertip or sternum)',
            'Apply firm pressure for 5 seconds',
            'Press until area blanches (turns white)',
            'Release pressure completely',
            'Start timing immediately upon release',
            'Observe color return',
            'Count seconds until normal color returns',
            'Assess if CRT <2 seconds or >2 seconds',
            'Check centrally AND peripherally',
            'Note skin temperature'
          ],
          interventions: [
            'Document CRT in seconds',
            'Assess for signs of poor perfusion',
            'Consider other circulatory markers'
          ],
          communication: [
            'Make it playful for child ("magic trick")',
            'Explain findings to parent',
            'Report prolonged CRT immediately',
            'Use SBAR if escalation needed'
          ],
          safetyRedFlags: [
            'CRT >2 seconds - poor perfusion/shock',
            'CRT >5 seconds - severe shock',
            'Mottled skin - serious perfusion issue',
            'Cool peripheries - circulatory compromise'
          ],
          documentation: [
            'Record CRT in seconds',
            'Note site assessed (central/peripheral)',
            'Document skin temperature and color',
            'Record time and escalation if needed'
          ]
        },
        tips: [
          'Normal CRT: <2 seconds',
          'Central CRT (sternum) more reliable than peripheral',
          'Cold environment can prolong CRT - consider this',
          'Combine with other circulatory signs (HR, BP, pulse, urine output)'
        ],
        warnings: [
          'CRT >2 seconds suggests shock - assess other signs urgently',
          'CRT can be normal in early compensated shock',
          'Never rely on CRT alone - use ABCDE approach'
        ],
        mnemonics: [
          'CRT mnemonic: "2 to trouble" - >2 seconds is prolonged and worrying'
        ],
        scoring: {
          criticalFails: [
            'Did not apply adequate pressure to blanch',
            'Failed to time accurately',
            'Did not recognize prolonged CRT as abnormal'
          ],
          marks: [
            { item: 'Correct technique (pressure and timing)', points: 3, domain: 'assessment' },
            { item: 'Accurate interpretation of CRT', points: 2, domain: 'assessment' },
            { item: 'Appropriate escalation if prolonged', points: 2, domain: 'communication' }
          ]
        }
      },

      // ========== SAFETY STATIONS ==========
      {
        id: 'safe-1',
        topic: 'safety',
        title: 'SBAR Handover Communication',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'You are concerned about a 3-year-old patient with increasing respiratory distress. Use SBAR to hand over to the senior nurse. You will be assessed on structure and content.',
        equipment: ['Patient notes/observation chart', 'Pen', 'SBAR prompt sheet (if needed)'],
        checklist: {
          preparation: [
            'Gather all relevant patient information',
            'Review recent observations',
            'Check medication chart',
            'Have patient notes available',
            'Prepare clear, concise handover'
          ],
          assessment: [
            'Review ABCDE assessment findings',
            'Note trend in observations',
            'Identify concerning signs',
            'Consider PEWS score if applicable'
          ],
          interventions: [
            'SITUATION: State name, role, patient details, and concern clearly',
            'SITUATION: State the problem in one clear sentence',
            'BACKGROUND: Provide relevant history (admission reason, diagnosis)',
            'BACKGROUND: State relevant medications and allergies',
            'BACKGROUND: Mention recent treatments/interventions',
            'ASSESSMENT: Present current observations systematically',
            'ASSESSMENT: State clinical findings (ABCDE)',
            'ASSESSMENT: Give your assessment of severity',
            'RECOMMENDATION: State what you think is needed',
            'RECOMMENDATION: Ask for specific action/review',
            'RECOMMENDATION: State urgency clearly'
          ],
          communication: [
            'Speak clearly and confidently',
            'Use structured approach throughout',
            'Avoid jargon or unclear abbreviations',
            'Listen to questions and respond appropriately',
            'Confirm understanding and actions',
            'Repeat back instructions if given'
          ],
          safetyRedFlags: [
            'Vague or unclear communication',
            'Missing critical information',
            'No clear recommendation',
            'Downplaying severity of situation',
            'Not stating urgency'
          ],
          documentation: [
            'Document handover in notes',
            'Record time and person handed over to',
            'Note instructions received',
            'Sign and date entry'
          ]
        },
        tips: [
          'SBAR keeps communication structured and complete',
          'Situation should be one clear sentence: "I am worried about..."',
          'Background gives context - keep it relevant and concise',
          'Assessment is your findings - be objective',
          'Recommendation - don\'t be afraid to suggest what you think is needed'
        ],
        warnings: [
          'Never assume senior knows the patient - give full context',
          'Don\'t minimize concerns - if worried, say so clearly',
          'Always state urgency - "I need you to see them now/within the hour"',
          'Missing SBAR components = incomplete handover = patient safety risk'
        ],
        mnemonics: [
          'SBAR: Situation, Background, Assessment, Recommendation',
          'Situation opener: "I\'m [name], [role], calling about [patient] in [location]. I\'m concerned because [problem]"'
        ],
        scoring: {
          criticalFails: [
            'Did not identify themselves and patient',
            'Failed to state clear concern',
            'No recommendation made',
            'Missing entire SBAR component'
          ],
          marks: [
            { item: 'Clear SITUATION statement with concern', points: 2, domain: 'interventions' },
            { item: 'Relevant BACKGROUND information', points: 2, domain: 'interventions' },
            { item: 'Systematic ASSESSMENT with findings', points: 2, domain: 'interventions' },
            { item: 'Clear RECOMMENDATION with urgency', points: 2, domain: 'interventions' },
            { item: 'Professional communication throughout', points: 1, domain: 'communication' },
            { item: 'Documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'safe-2',
        topic: 'safety',
        title: 'Patient Identification Check',
        difficulty: 'easy',
        estimatedMinutes: 5,
        candidateInstructions: 'Demonstrate the three-point patient identification check before administering medication to this 5-year-old child. Explain each step clearly.',
        equipment: ['Patient wristband (on manikin/actor)', 'Medication chart', 'Patient notes'],
        checklist: {
          preparation: [
            'Introduce yourself to child and parent',
            'Explain you will check identity',
            'Wash hands',
            'Have medication chart ready'
          ],
          assessment: [
            'Check patient wristband is present',
            'Verify wristband is intact and legible',
            'Assess if child able to state details (age appropriate)'
          ],
          interventions: [
            'POINT 1: Ask patient to state name and DOB (or ask parent)',
            'POINT 2: Check wristband details match (name, DOB, NHS number)',
            'POINT 3: Cross-check medication chart matches patient',
            'Verify all three identifiers match',
            'Do NOT proceed if any discrepancy found',
            'Check allergy status on wristband and chart'
          ],
          communication: [
            'Explain process to parent in friendly manner',
            'Use age-appropriate language for child',
            'Thank patient and parent for cooperation',
            'If discrepancy found, explain calmly and escalate'
          ],
          safetyRedFlags: [
            'No wristband present - do NOT proceed',
            'Wristband illegible - must replace before proceeding',
            'Details do not match - STOP and escalate immediately',
            'Skipping any of the three checks - critical fail'
          ],
          documentation: [
            'Document ID check completed',
            'Note any issues with wristband',
            'Report missing/illegible wristbands immediately'
          ]
        },
        tips: [
          'Three-point check: 1) Ask patient 2) Check wristband 3) Check chart',
          'NEVER skip ID check - even for familiar patients',
          'If child too young to state details, ask parent AND check wristband',
          'Always check allergy status as part of ID check'
        ],
        warnings: [
          'Wrong patient medication errors can be fatal',
          'Never rely on bed number or parent confirmation alone',
          'Missing wristband = DO NOT proceed with any procedure',
          'Never assume - always verify'
        ],
        mnemonics: [
          'Three-point ID: ASK (patient), SEE (wristband), CHECK (chart)'
        ],
        scoring: {
          criticalFails: [
            'Did not complete all three identification checks',
            'Proceeded despite discrepancy',
            'Did not check wristband'
          ],
          marks: [
            { item: 'Asked patient/parent to state name and DOB', points: 2, domain: 'interventions' },
            { item: 'Checked wristband matches', points: 2, domain: 'interventions' },
            { item: 'Cross-checked with medication chart', points: 2, domain: 'interventions' },
            { item: 'Checked allergy status', points: 1, domain: 'interventions' },
            { item: 'Clear communication throughout', points: 1, domain: 'communication' }
          ]
        }
      },

      // ========== PAIN ASSESSMENT STATIONS ==========
      {
        id: 'pain-1',
        topic: 'pain',
        title: 'Pain Assessment Using FLACC Scale',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Assess pain in this 18-month-old infant who is post-operative. Use the FLACC scale and document your findings.',
        equipment: ['FLACC pain assessment tool', 'Observation chart', 'Pen', 'Watch'],
        checklist: {
          preparation: [
            'Introduce self to parent',
            'Explain pain assessment to parent',
            'Wash hands',
            'Ensure adequate lighting',
            'Position self to observe infant clearly'
          ],
          assessment: [
            'Assess FACE: relaxed vs grimacing/frowning',
            'Score Face 0-2',
            'Assess LEGS: normal vs tense/restless/kicking',
            'Score Legs 0-2',
            'Assess ACTIVITY: normal vs squirming/arched/rigid',
            'Score Activity 0-2',
            'Assess CRY: no cry vs moans/whimpers or screaming',
            'Score Cry 0-2',
            'Assess CONSOLABILITY: content vs difficult to console',
            'Score Consolability 0-2',
            'Calculate total FLACC score (0-10)',
            'Observe infant for at least 2-5 minutes'
          ],
          interventions: [
            'Document FLACC score accurately',
            'Interpret score (0=relaxed, 1-3=mild, 4-6=moderate, 7-10=severe)',
            'Plan pain management based on score',
            'Consider non-pharmacological comfort measures'
          ],
          communication: [
            'Explain findings to parent',
            'Ask parent about infant usual pain behaviors',
            'Discuss pain management plan',
            'Report significant pain to prescriber'
          ],
          safetyRedFlags: [
            'FLACC score ≥7 - severe pain requiring immediate analgesia',
            'Rigid/arched posturing - severe distress',
            'Inconsolable crying - requires urgent review',
            'Changed behavior from baseline - may indicate pain'
          ],
          documentation: [
            'Record FLACC score on pain chart',
            'Document all 5 component scores',
            'Note time of assessment',
            'Record parent concerns',
            'Document interventions planned'
          ]
        },
        tips: [
          'FLACC: Face, Legs, Activity, Cry, Consolability',
          'Each component scored 0-2, total 0-10',
          'FLACC used for children <3 years or non-verbal of any age',
          'Observe for 2-5 minutes before scoring',
          'Consider baseline behavior - ask parent what\'s normal'
        ],
        warnings: [
          'Never assume non-verbal children don\'t have pain',
          'Score 0 doesn\'t always mean no pain - consider other factors',
          'Sedation can mask pain behaviors - be cautious',
          'Always believe parent concerns about child pain'
        ],
        mnemonics: [
          'FLACC: Face, Legs, Activity, Cry, Consolability'
        ],
        scoring: {
          criticalFails: [
            'Did not assess all 5 FLACC components',
            'Incorrect calculation of total score',
            'Failed to escalate severe pain (score ≥7)'
          ],
          marks: [
            { item: 'Assessed all 5 FLACC components correctly', points: 3, domain: 'assessment' },
            { item: 'Accurate scoring (0-2 for each component)', points: 2, domain: 'assessment' },
            { item: 'Correct interpretation of total score', points: 2, domain: 'interventions' },
            { item: 'Appropriate pain management plan', points: 2, domain: 'interventions' },
            { item: 'Clear documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'pain-2',
        topic: 'pain',
        title: 'Pain Assessment Using Wong-Baker FACES',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Assess pain in this 5-year-old child who has fallen and injured their arm. Use the Wong-Baker FACES scale appropriately.',
        equipment: ['Wong-Baker FACES pain scale (visual chart)', 'Pain assessment documentation', 'Pen'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain you will check how much pain child has',
            'Wash hands',
            'Position at child eye level',
            'Ensure child can see FACES chart clearly'
          ],
          assessment: [
            'Show child the FACES scale',
            'Explain each face in age-appropriate language',
            'Start from happy face (0 - no hurt)',
            'Progress to sad faces (2, 4, 6, 8)',
            'End with crying face (10 - hurts worst)',
            'Ask child to point to face that matches their pain NOW',
            'Confirm child understanding by asking them to explain choice',
            'Note non-verbal cues (facial expression, guarding, posture)',
            'Assess location of pain',
            'Ask when pain started and what makes it better/worse'
          ],
          interventions: [
            'Document pain score accurately',
            'Record pain location',
            'Plan appropriate pain relief',
            'Consider non-pharmacological strategies (distraction, comfort positioning)'
          ],
          communication: [
            'Use simple, child-friendly language',
            'Avoid leading questions',
            'Praise child for helping',
            'Explain findings to parent',
            'Discuss pain management options with child and parent',
            'Reassure child that help is available'
          ],
          safetyRedFlags: [
            'Pain score ≥7 - severe pain requiring analgesia',
            'Child pointing to worst face but appearing calm - may not understand',
            'Mismatch between score and behavior - needs clarification',
            'Pain affecting function (won\'t move limb, won\'t play)'
          ],
          documentation: [
            'Record numeric pain score (0-10)',
            'Document pain location',
            'Note pain characteristics (sharp, dull, constant, intermittent)',
            'Record child exact words about pain',
            'Document interventions provided'
          ]
        },
        tips: [
          'Wong-Baker FACES appropriate for ages 3-7 years',
          'Always explain ALL faces before asking child to choose',
          'Use words child understands: "hurt" better than "pain"',
          'Some children always point to crying face - check understanding',
          'Behavioral cues should match reported score'
        ],
        warnings: [
          'Never suggest which face to point to',
          'Don\'t ask "Does it hurt?" - ask "How much does it hurt?"',
          'Some children minimize pain to avoid medication/procedures',
          'Cultural differences affect pain expression - consider context'
        ],
        mnemonics: [
          'FACES scale: 0, 2, 4, 6, 8, 10 (even numbers only)',
          'Wong-Baker: Widely Observed for Noting Great pain - Brings Assessment of Kids\' Experience to Reality'
        ],
        scoring: {
          criticalFails: [
            'Did not explain all faces to child',
            'Led child to specific answer',
            'Dismissed child reported pain score'
          ],
          marks: [
            { item: 'Appropriate introduction and positioning', points: 2, domain: 'preparation' },
            { item: 'Explained all FACES to child clearly', points: 2, domain: 'assessment' },
            { item: 'Child-friendly communication throughout', points: 2, domain: 'communication' },
            { item: 'Accurate documentation', points: 2, domain: 'documentation' },
            { item: 'Appropriate pain management plan', points: 2, domain: 'interventions' }
          ]
        }
      },

      {
        id: 'pain-3',
        topic: 'pain',
        title: 'Comprehensive Pain Assessment in School-Age Child',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Perform a comprehensive pain assessment on this 9-year-old with abdominal pain. Use the numerical rating scale (0-10) and gather complete pain history.',
        equipment: ['Numerical rating scale (0-10)', 'Pain assessment chart', 'Body diagram', 'Pen'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain pain assessment process',
            'Gain consent and assent',
            'Wash hands',
            'Ensure privacy and comfort',
            'Position at child eye level'
          ],
          assessment: [
            'Use numerical scale 0-10 (0=no pain, 10=worst pain)',
            'Ask child current pain score',
            'PQRST assessment:',
            'P - Provokes: What makes pain worse/better?',
            'Q - Quality: Describe pain (sharp, dull, burning, aching)',
            'R - Radiates: Does pain spread anywhere?',
            'S - Severity: Rate 0-10, and at best/worst times',
            'T - Time: When started? Constant or comes and goes?',
            'Use body diagram for child to show pain location',
            'Assess impact on daily activities (eating, sleeping, playing)',
            'Observe for non-verbal pain cues',
            'Check vital signs if appropriate',
            'Ask about previous pain episodes',
            'Identify current pain relief measures tried'
          ],
          interventions: [
            'Document comprehensive pain assessment',
            'Interpret findings systematically',
            'Develop individualized pain management plan',
            'Consider pharmacological and non-pharmacological options',
            'Set realistic pain management goals with child'
          ],
          communication: [
            'Use age-appropriate language',
            'Allow child to describe pain in own words',
            'Ask open-ended questions',
            'Involve child in pain management decisions',
            'Explain pain management plan clearly',
            'Reassure child that pain is believed and will be addressed',
            'Educate about realistic pain expectations'
          ],
          safetyRedFlags: [
            'Severe pain (8-10/10) - urgent analgesia needed',
            'Acute abdominal pain with guarding - surgical emergency?',
            'Pain preventing sleep or eating - significant impact',
            'Changed behavior (withdrawn, irritable) - inadequate pain control',
            'Red flag symptoms (fever, vomiting, severe location-specific pain)'
          ],
          documentation: [
            'Record pain score (0-10)',
            'Complete PQRST documentation',
            'Document pain location on body diagram',
            'Note impact on activities of daily living',
            'Record child exact description of pain',
            'Document pain management plan',
            'Note reassessment time planned'
          ]
        },
        tips: [
          'PQRST: Provokes, Quality, Radiates, Severity, Time',
          'School-age children (7+) can use 0-10 scale reliably',
          'Always ask child FIRST before asking parent',
          'Pain is what child says it is - always believe them',
          'Assess pain regularly - "5th vital sign"'
        ],
        warnings: [
          'Never dismiss child pain as "attention-seeking"',
          'Abdominal pain in children can indicate serious pathology',
          'Inadequate pain control affects healing and psychological wellbeing',
          'Some children stoic/minimize pain - observe behavior too'
        ],
        mnemonics: [
          'PQRST: Provokes/Palliates, Quality, Radiates/Region, Severity, Time/Timing',
          'OLDCARTS: Onset, Location, Duration, Character, Aggravating factors, Relieving factors, Timing, Severity'
        ],
        scoring: {
          criticalFails: [
            'Did not use numerical scale appropriately',
            'Incomplete PQRST assessment (missing ≥2 components)',
            'Failed to identify red flag symptoms'
          ],
          marks: [
            { item: 'Appropriate pain scale for age', points: 1, domain: 'assessment' },
            { item: 'Complete PQRST assessment', points: 3, domain: 'assessment' },
            { item: 'Body diagram documentation', points: 1, domain: 'assessment' },
            { item: 'Child-centered communication', points: 2, domain: 'communication' },
            { item: 'Comprehensive pain management plan', points: 2, domain: 'interventions' },
            { item: 'Thorough documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'comm-1',
        topic: 'communication',
        title: 'Gaining Consent and Assent',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'You need to perform venepuncture on this 6-year-old child. Gain consent from the parent and assent from the child. Explain the difference between consent and assent.',
        equipment: ['Procedure information leaflet', 'Age-appropriate resources (e.g., visual aids, dolls)', 'Pen for consent documentation'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Create child-friendly environment',
            'Ensure privacy for discussion',
            'Have visual aids/resources ready',
            'Allow time for questions'
          ],
          assessment: [
            'Assess child\'s developmental level',
            'Determine child\'s understanding ability',
            'Check parent understanding of procedure',
            'Identify any previous experiences',
            'Note any fears or anxieties'
          ],
          interventions: [
            'Explain procedure to CHILD first in simple terms',
            'Use age-appropriate language (no jargon)',
            'Be honest - "It will hurt like a scratch but be quick"',
            'Show equipment if appropriate',
            'Use play/visual aids to demonstrate',
            'Ask child if they agree to procedure (assent)',
            'Explain procedure to PARENT with detail',
            'Discuss risks, benefits, alternatives',
            'Answer parent questions fully',
            'Gain formal CONSENT from parent',
            'Document both consent and assent',
            'Respect if child refuses (discuss with parent)'
          ],
          communication: [
            'Speak to child at eye level',
            'NEVER lie about pain or duration',
            'Use positive language ("Help us" not "Let us")',
            'Praise child for listening and being brave',
            'Allow child to ask questions',
            'Check understanding by asking child to explain back',
            'Involve child in choices (which arm, sit vs lie)',
            'Thank both child and parent'
          ],
          safetyRedFlags: [
            'Lying to child - destroys trust permanently',
            'Not gaining assent from child (if able)',
            'Proceeding without parental consent',
            'Forcing procedure on distressed child without discussion',
            'Using threatening language'
          ],
          documentation: [
            'Document consent obtained from parent',
            'Record assent obtained from child',
            'Note who gave consent and their relationship',
            'Document explanation given',
            'Note any refusal and actions taken'
          ]
        },
        tips: [
          'Consent = legal permission from parent. Assent = child\'s agreement',
          'Speak to child FIRST - they are your patient',
          'Never say "It won\'t hurt" - always be honest',
          'Give child some control - reduces anxiety',
          'If child refuses, explore why - can often resolve fears'
        ],
        warnings: [
          'Children under 16 cannot usually give legal consent (parent needed)',
          'Gillick competence applies to some older children - seek senior advice',
          'Never proceed without consent from person with parental responsibility',
          'Assent important for cooperation and trust - don\'t ignore it'
        ],
        mnemonics: [
          'CARE for consent: Competent person, All information given, Recorded in notes, Explicit permission',
          'Child communication: HONEST, Eye level, Age-appropriate, Respect refusal, Truth about pain'
        ],
        scoring: {
          criticalFails: [
            'Lied about pain ("won\'t hurt at all")',
            'Did not gain parental consent',
            'Ignored child completely',
            'Did not explain procedure'
          ],
          marks: [
            { item: 'Age-appropriate explanation to child', points: 2, domain: 'interventions' },
            { item: 'Honest about discomfort', points: 2, domain: 'communication' },
            { item: 'Gained child\'s assent', points: 2, domain: 'interventions' },
            { item: 'Full explanation to parent', points: 1, domain: 'interventions' },
            { item: 'Gained formal parental consent', points: 2, domain: 'interventions' },
            { item: 'Documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      // ========== PERSONAL CARE STATIONS ==========
      {
        id: 'care-1',
        topic: 'personalcare',
        title: 'Pressure Area Assessment in Child',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Perform a pressure area assessment on this 8-year-old child who has been bedbound for 3 days. Identify at-risk areas and document findings.',
        equipment: ['Observation chart', 'Pressure area assessment tool', 'Hand sanitizer', 'Good lighting'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure in age-appropriate language',
            'Gain consent from parent and assent from child',
            'Wash hands thoroughly',
            'Ensure privacy (close curtains/door)',
            'Position child comfortably',
            'Ensure adequate lighting'
          ],
          assessment: [
            'Assess Sacrum for redness/breakdown',
            'Assess Heels (both) for pressure damage',
            'Assess Elbows (both) for skin changes',
            'Assess Occiput (back of head) for pressure',
            'Assess Ears for redness or damage',
            'Check skin integrity at each site',
            'Look for blanching/non-blanching erythema',
            'Assess for skin discoloration',
            'Check for warmth or coolness',
            'Note any moisture or maceration',
            'Assess pain or tenderness at sites',
            'Grade any pressure damage found'
          ],
          interventions: [
            'Document all findings accurately',
            'Complete pressure ulcer risk assessment tool',
            'Plan repositioning schedule',
            'Consider pressure-relieving equipment needs'
          ],
          communication: [
            'Explain findings to parent',
            'Discuss prevention strategies',
            'Educate on repositioning importance',
            'Report concerns to senior nurse'
          ],
          safetyRedFlags: [
            'Non-blanching erythema - Grade 2+ pressure damage',
            'Broken skin - requires urgent management',
            'Deep tissue injury - purple/maroon discoloration',
            'Signs of infection at pressure site'
          ],
          documentation: [
            'Record assessment of all SHEOE areas',
            'Document grade of any pressure damage',
            'Note risk assessment score',
            'Record prevention plan implemented'
          ]
        },
        tips: [
          'SHEOE mnemonic: Sacrum, Heels, Elbows, Occiput, Ears',
          'Children have different pressure points than adults - occiput is major risk',
          'Blanching erythema = Grade 1 (reversible), Non-blanching = Grade 2+',
          'Prevention is key - repositioning every 2 hours minimum'
        ],
        warnings: [
          'Never massage reddened areas - can worsen tissue damage',
          'Occipital pressure ulcers in infants can develop rapidly',
          'Medical devices (O2 masks, NG tubes) can cause pressure damage'
        ],
        mnemonics: [
          'SHEOE: Sacrum, Heels, Elbows, Occiput (back of head), Ears'
        ],
        scoring: {
          criticalFails: [
            'Did not assess all SHEOE pressure points',
            'Failed to gain consent/assent',
            'Did not document findings'
          ],
          marks: [
            { item: 'Assessed all 5 SHEOE areas systematically', points: 3, domain: 'assessment' },
            { item: 'Correct grading of pressure damage', points: 2, domain: 'assessment' },
            { item: 'Appropriate prevention plan', points: 2, domain: 'interventions' },
            { item: 'Clear documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'care-2',
        topic: 'personalcare',
        title: 'Oral Hygiene in NBM Patient',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'Provide oral hygiene care for this 5-year-old who has been nil by mouth for 12 hours post-operatively. The child is drowsy but rousable.',
        equipment: ['Small soft toothbrush or foam sticks', 'Toothpaste or mouthwash', 'Water', 'Bowl/kidney dish', 'Gauze', 'Lip balm', 'Suction (available)', 'Gloves', 'Apron', 'Towel'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure to parent and child',
            'Gain consent from parent',
            'Wash hands',
            'Put on gloves and apron',
            'Gather all equipment',
            'Ensure suction available at bedside',
            'Position child semi-upright or on side (NEVER flat)'
          ],
          assessment: [
            'Assess level of consciousness',
            'Check gag reflex present',
            'Inspect oral cavity for dryness',
            'Look for oral thrush (white patches)',
            'Check lips for cracking or bleeding',
            'Assess mucous membranes',
            'Note any foul odor'
          ],
          interventions: [
            'Place towel to protect clothing',
            'Moisten toothbrush/foam stick',
            'Apply small amount toothpaste',
            'Gently brush teeth and gums',
            'Clean tongue gently',
            'Clean inside of cheeks',
            'Use gauze to wipe away debris',
            'Rinse mouth with small amounts of water',
            'Use suction if needed to clear secretions',
            'Pat dry around mouth',
            'Apply lip balm to lips',
            'Dispose of equipment safely',
            'Remove gloves and apron',
            'Wash hands'
          ],
          communication: [
            'Talk to child throughout (even if drowsy)',
            'Explain each step before doing it',
            'Reassure and comfort child',
            'Praise child for cooperation',
            'Update parent on oral condition'
          ],
          safetyRedFlags: [
            'Absent gag reflex - high aspiration risk',
            'Child unable to protect airway',
            'Signs of oral thrush - requires treatment',
            'Bleeding gums - may indicate clotting issues'
          ],
          documentation: [
            'Record oral hygiene performed',
            'Document oral cavity condition',
            'Note any abnormalities found',
            'Record time performed',
            'Plan next oral hygiene time (4-6 hours)'
          ]
        },
        tips: [
          'NBM patients need oral care every 4-6 hours minimum',
          'Position is critical - NEVER flat (aspiration risk)',
          'Foam sticks better for very dry/sore mouths',
          'Small frequent mouth care better than infrequent thorough care'
        ],
        warnings: [
          'NEVER perform oral care on flat patient - aspiration risk',
          'Ensure suction available before starting',
          'Reduced consciousness = increased aspiration risk',
          'Oral thrush common in NBM patients - check carefully'
        ],
        mnemonics: [
          'NBM oral care frequency: "4 to 6 to avoid the fix" (every 4-6 hours prevents problems)'
        ],
        scoring: {
          criticalFails: [
            'Positioned child flat during procedure',
            'Did not check gag reflex/level of consciousness',
            'No suction available for drowsy patient'
          ],
          marks: [
            { item: 'Safe positioning (semi-upright or side)', points: 2, domain: 'preparation' },
            { item: 'Thorough oral assessment', points: 2, domain: 'assessment' },
            { item: 'Systematic cleaning technique', points: 3, domain: 'interventions' },
            { item: 'Documentation and care plan', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'care-3',
        topic: 'personalcare',
        title: 'Bed Bath for Child',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Perform a bed bath for this bedbound 7-year-old child. Demonstrate correct technique and maintain dignity throughout.',
        equipment: ['Bowl of warm water', 'Soap/body wash', 'Two washcloths', 'Two towels', 'Clean clothing/gown', 'Gloves', 'Apron', 'Barrier cream if needed', 'Laundry bag'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure to child',
            'Gain consent from parent and assent from child',
            'Wash hands',
            'Put on apron',
            'Ensure privacy (close curtains/door)',
            'Adjust bed to comfortable working height',
            'Ensure room warm enough',
            'Gather all equipment before starting',
            'Test water temperature (comfortably warm)'
          ],
          assessment: [
            'Assess skin integrity',
            'Check for rashes or breakdown',
            'Note any wounds or devices',
            'Assess mobility and cooperation level',
            'Identify any painful areas'
          ],
          interventions: [
            'Put on gloves',
            'Keep child covered (expose only area being washed)',
            'FACE: Wash with water only (no soap), pat dry',
            'NECK: Wash and dry thoroughly',
            'ARMS: Wash one at a time, including axilla, pat dry',
            'CHEST: Wash and dry, keep covered when not washing',
            'ABDOMEN: Wash and dry, check umbilicus if young child',
            'LEGS: Wash one at a time, pat dry',
            'BACK: Turn child on side, wash and dry back',
            'PERINEUM: Change water, put on fresh gloves',
            'PERINEUM: Wash front to back for girls, pat dry',
            'Apply barrier cream if needed',
            'Help child into clean clothing',
            'Ensure child comfortable',
            'Dispose of water and linens appropriately',
            'Remove gloves and apron',
            'Wash hands'
          ],
          communication: [
            'Talk to child throughout',
            'Maintain dignity and privacy',
            'Encourage child participation where possible',
            'Praise and reassure child',
            'Respect child modesty and preferences'
          ],
          safetyRedFlags: [
            'Skin breakdown or pressure damage',
            'Rash requiring medical review',
            'Signs of infection',
            'Child in pain during handling'
          ],
          documentation: [
            'Record bed bath completed',
            'Document skin condition',
            'Note any concerns or abnormalities',
            'Record child tolerance of procedure'
          ]
        },
        tips: [
          'Order: Clean to dirty (face to body to back to perineum)',
          'Face always washed with WATER ONLY (no soap)',
          'Change water and gloves before perineal care',
          'Keep child covered - only expose area being washed',
          'For girls: ALWAYS front to back to prevent UTI'
        ],
        warnings: [
          'Never leave child unattended during bed bath',
          'Water temperature critical - test thoroughly (not too hot)',
          'Maintain dignity - minimal exposure',
          'Fresh gloves and water for perineal care - infection prevention'
        ],
        mnemonics: [
          'Washing order: "Face Never Accepts Cheese And Lettuce Before Pasta" (Face, Neck, Arms, Chest, Abdomen, Legs, Back, Perineum)'
        ],
        scoring: {
          criticalFails: [
            'Did not maintain privacy/dignity',
            'Used soap on face',
            'Did not change water/gloves before perineal care',
            'Washed back to front on girl (UTI risk)'
          ],
          marks: [
            { item: 'Correct washing order (clean to dirty)', points: 2, domain: 'interventions' },
            { item: 'Maintained dignity and privacy throughout', points: 2, domain: 'communication' },
            { item: 'Proper perineal care (fresh water/gloves, correct direction)', points: 2, domain: 'interventions' },
            { item: 'Thorough skin assessment', points: 2, domain: 'assessment' }
          ]
        }
      },

      // ========== NG TUBE STATIONS ==========
      {
        id: 'ng-1',
        topic: 'ngtubes',
        title: 'NG Tube Position Verification - pH Testing',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Verify the position of this nasogastric tube before administering medication. Use pH testing method and demonstrate correct procedure.',
        equipment: ['pH indicator strips (range 0-6 or 1-11)', 'Clean gloves', 'Apron', '50ml syringe (catheter tip)', 'Receiver/bowl', 'Clean gauze', 'Documentation chart', 'Second nurse available if needed'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure in age-appropriate language',
            'Gain consent from parent',
            'Wash hands thoroughly',
            'Put on apron and gloves',
            'Check NG tube secured appropriately',
            'Check external length marking visible and documented',
            'Ensure child comfortable position (upright or on left side)'
          ],
          assessment: [
            'Check when NG tube last used',
            'Review when position last confirmed',
            'Verify no contraindications to aspiration',
            'Assess child tolerance and cooperation',
            'Check pH strips in date and stored correctly'
          ],
          interventions: [
            'Verify external tube length matches documented measurement',
            'If length changed - STOP and escalate immediately',
            'Remove cap/bung from NG tube',
            'Attach 50ml syringe to NG tube',
            'Gently pull back plunger to aspirate',
            'Attempt to obtain at least 0.5ml aspirate',
            'If no aspirate obtained: try repositioning strategies',
            'Turn child onto LEFT side',
            'Wait 15-30 minutes and retry',
            'Advance or withdraw tube 10-20cm and retry',
            'Give 1-2ml air and retry aspiration',
            'Once aspirate obtained: observe appearance',
            'Note color (should be grassy green, clear/colorless, or brown)',
            'Place small amount on pH strip',
            'Wait for color change (follow strip instructions)',
            'Compare to color chart on pH strip container',
            'pH less than or equal to 5.5 = SAFE to use tube (gastric placement)',
            'pH greater than 5.5 = DO NOT USE - reposition or X-ray needed',
            'Return aspirate to patient if pH ≤5.5',
            'Flush tube with water if appropriate',
            'Replace cap/bung securely'
          ],
          communication: [
            'Explain each step to parent and child',
            'Warn may feel slight tugging sensation',
            'If unable to obtain aspirate, explain options',
            'If pH >5.5, explain cannot use tube',
            'Discuss need for X-ray if position unclear',
            'Document clearly and communicate to team'
          ],
          safetyRedFlags: [
            'External tube length changed - tube may have migrated',
            'pH greater than 5.5 - DO NOT USE tube for feeding or medication',
            'Unable to obtain aspirate after all attempts - X-ray required',
            'Using auscultation (whoosh test) - NEVER do this, not safe',
            'Proceeding without position confirmation - potential fatal error',
            'Respiratory distress during aspiration - tube may be in lung'
          ],
          documentation: [
            'Record pH result',
            'Document external tube length',
            'Note appearance of aspirate',
            'Record date and time of check',
            'Document repositioning attempts if made',
            'Sign and print name',
            'If X-ray required, document request and reason'
          ]
        },
        tips: [
          'pH less than or equal to 5.5 confirms gastric placement (acidic stomach)',
          'pH greater than 5.5 could indicate respiratory tract, esophagus, or small bowel',
          'Left lateral position helps aspirate flow to greater curve of stomach',
          'Advancing/withdrawing 10-20cm can move tube into fluid pool',
          '1-2ml air can displace tube slightly to help aspiration',
          'Some medications raise gastric pH - consider timing'
        ],
        warnings: [
          'NEVER use whoosh test (auscultation) - cannot differentiate stomach from lung',
          'pH greater than 5.5 means DO NOT USE - feeding into lung can be fatal',
          'If external length changed, tube has migrated - check position',
          'Cannot aspirate? Do NOT guess position - X-ray required',
          'Respiratory aspirate can look similar to gastric - pH is essential'
        ],
        mnemonics: [
          'pH safe limit: "5.5 or Less = Safe for Gastric Access"',
          'No aspirate? Try: "LEFT side, WAIT, WIGGLE tube (advance/withdraw), puff AIR"',
          'NEVER whoosh: "Whoosh is Worthless - Will Cause Wickedness (deaths)"'
        ],
        scoring: {
          criticalFails: [
            'Did not check pH before using tube',
            'Proceeded with pH greater than 5.5',
            'Did not check external tube length',
            'Used whoosh test instead of pH'
          ],
          marks: [
            { item: 'Checked external tube length', points: 2, domain: 'assessment' },
            { item: 'Correct aspiration technique', points: 2, domain: 'interventions' },
            { item: 'Appropriate repositioning if no aspirate', points: 2, domain: 'interventions' },
            { item: 'Accurate pH interpretation (less than or equal to 5.5 safe)', points: 2, domain: 'interventions' },
            { item: 'Documentation', points: 2, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'ng-2',
        topic: 'ngtubes',
        title: 'NG Tube Medication Administration',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Administer oral medication via NG tube to this 3-year-old child. Demonstrate correct technique including position verification and flushing.',
        equipment: ['Prescribed medication', 'Prescription chart', '50ml catheter-tip syringes (×2)', 'pH indicator strips', 'Cooled boiled water or sterile water', 'Gloves', 'Apron', 'Receiver/bowl', 'Medication pot'],
        checklist: {
          preparation: [
            'Check prescription (9 Rights)',
            'Verify patient identity (3-point check)',
            'Check allergies',
            'Wash hands and put on apron/gloves',
            'Prepare medication in oral form',
            'Draw up appropriate flush volume (5-10ml for children)',
            'Gather all equipment'
          ],
          assessment: [
            'Check NG tube position BEFORE medication',
            'Verify external tube length',
            'Obtain aspirate',
            'Check pH less than or equal to 5.5',
            'Assess child position (sitting upright 30-45°)',
            'Check tube patent (not blocked)'
          ],
          interventions: [
            'Position child upright or semi-upright (30-45°)',
            'Verify tube position confirmed (pH less than or equal to 5.5)',
            'Remove cap/bung from NG tube',
            'Attach syringe to NG tube',
            'FLUSH with 5ml water BEFORE medication',
            'Ensure flush goes through easily (tube patent)',
            'Draw up prepared medication into syringe',
            'Attach medication syringe to NG tube',
            'Administer medication slowly via gravity or gentle push',
            'Do NOT force if resistance felt',
            'FLUSH with 5-10ml water AFTER medication',
            'If multiple medications: flush between each one',
            'Final flush to ensure all medication delivered',
            'Replace cap/bung securely',
            'Keep child upright for 30 minutes post-administration',
            'Dispose of equipment safely',
            'Remove gloves and wash hands'
          ],
          communication: [
            'Explain procedure to child and parent',
            'Warn child about sensations',
            'Involve child where appropriate',
            'Educate parent about why position checking essential',
            'Inform about keeping child upright after',
            'Advise when next medication due'
          ],
          safetyRedFlags: [
            'Not checking tube position before medication - fatal error',
            'pH greater than 5.5 - DO NOT give medication',
            'Tube blocked - do NOT force, may cause tube to dislodge',
            'Child lying flat - aspiration risk',
            'Not flushing between medications - drug interactions/tube blockage',
            'Multiple medications mixed together - may be incompatible'
          ],
          documentation: [
            'Record pH checked and result',
            'Sign medication chart AFTER administration',
            'Document flush volumes given',
            'Note any difficulty or issues',
            'Record child position during administration',
            'Sign and time entry'
          ]
        },
        tips: [
          'ALWAYS check position before EVERY medication or feed',
          'Flush before, between, and after medications',
          'Use liquid formulations where possible',
          'Crushed tablets must be very fine powder and dissolved',
          'Upright positioning reduces aspiration and reflux risk',
          'Never mix multiple medications together'
        ],
        warnings: [
          'Not checking position before each use has caused deaths',
          'Some tablets cannot be crushed (modified release, enteric coated)',
          'Grapefruit juice interacts with many drugs - use water',
          'Lying flat during feeds increases aspiration risk',
          'Never force flush if blocked - tube may have migrated'
        ],
        mnemonics: [
          'NG medication: "Check Position First, Flush Before medication, Flush After"',
          'Keep upright: "30 minutes at 30 degrees minimum"'
        ],
        scoring: {
          criticalFails: [
            'Did not verify tube position before medication',
            'Administered with pH >5.5',
            'Did not flush tube before and after medication',
            'Child lying flat during administration'
          ],
          marks: [
            { item: 'Tube position verified (pH ≤5.5)', points: 3, domain: 'assessment' },
            { item: 'Appropriate positioning (upright/semi-upright)', points: 1, domain: 'preparation' },
            { item: 'Flushed before, between, and after medications', points: 2, domain: 'interventions' },
            { item: 'Medication administered safely', points: 2, domain: 'interventions' },
            { item: 'Documentation and signing chart', points: 2, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'ng-3',
        topic: 'ngtubes',
        title: 'NG Tube Care and Troubleshooting',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'This child has an NG tube in situ. Assess the tube position and security. Explain troubleshooting steps if unable to obtain aspirate.',
        equipment: ['pH indicator strips', '50ml catheter-tip syringe', 'Tape/securing device', 'Scissors', 'Gloves', 'Measurement tape', 'Documentation chart'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain assessment procedure',
            'Wash hands and put on gloves',
            'Position child comfortably',
            'Have equipment ready'
          ],
          assessment: [
            'Check NG tube secured appropriately to cheek',
            'Verify tape not causing pressure or skin damage',
            'Check nostril for redness, bleeding, or necrosis',
            'Measure and document external tube length',
            'Compare to previously documented length',
            'If length changed by >2cm - STOP and escalate',
            'Check tube marking visible at nostril',
            'Assess for signs of tube displacement',
            'Ask child/parent about discomfort or tube issues',
            'Inspect mouth for tube visible in oropharynx (coiled)'
          ],
          interventions: [
            'If tube security compromised: re-secure appropriately',
            'Clean skin before applying new tape',
            'Secure tube to cheek (NOT forehead)',
            'Avoid pressure on nostril',
            'Demonstrate aspiration technique',
            'If unable to aspirate, try troubleshooting:',
            'Reposition child onto LEFT lateral position',
            'Wait 15-30 minutes for gastric contents to settle',
            'Try advancing tube 10-20cm',
            'Try withdrawing tube 10-20cm',
            'Flush with 1-2ml air and retry aspiration',
            'If still no aspirate - X-ray required before use',
            'Never proceed with feed/medication without position confirmation'
          ],
          communication: [
            'Teach parent to recognize tube displacement',
            'Explain importance of checking external length',
            'Educate about when to report concerns',
            'Discuss signs of tube problems (gagging, coughing, distress)',
            'Explain troubleshooting steps',
            'Reassure about safety checks'
          ],
          safetyRedFlags: [
            'External tube length changed >2cm - tube migrated',
            'Tube visible in mouth - coiled in esophagus/throat',
            'Child coughing/gagging when tube flushed - may be in airway',
            'Unable to aspirate after all measures - X-ray needed',
            'Nostril showing pressure necrosis - tube needs repositioning',
            'Tape causing skin breakdown - need alternative securing method'
          ],
          documentation: [
            'Record external tube length',
            'Document tube security and skin integrity',
            'Note troubleshooting attempts made',
            'Record if X-ray required',
            'Document parent education provided',
            'Sign and date entry'
          ]
        },
        tips: [
          'External tube length should be measured and documented at each shift',
          'Change in length >2cm suggests tube migration',
          'Left lateral position best for obtaining aspirate',
          'Flush with air can help dislodge tube into fluid',
          'NG tubes should be re-secured daily to check skin integrity',
          'Check nasal septum for pressure damage regularly'
        ],
        warnings: [
          'Do NOT use tube if external length changed significantly',
          'Nostril pressure can cause necrosis - needs early recognition',
          'Tube coiled in throat = choking risk and wrong position',
          'Cannot aspirate? NEVER guess - X-ray required',
          'Some children remove tubes - never reinsert yourself'
        ],
        mnemonics: [
          'Securing NG tube: "Cheek not forehead, Avoid Nostril pressure, Check skin daily"',
          'Can\'t aspirate? "LEFT, WAIT, WIGGLE, AIR, X-RAY"',
          'Tube migration signs: "Length Changed = Location Changed"'
        ],
        scoring: {
          criticalFails: [
            'Did not measure external tube length',
            'Failed to recognize significant length change',
            'Recommended using tube without position verification',
            'Did not identify pressure damage to nostril'
          ],
          marks: [
            { item: 'Measured and compared external tube length', points: 2, domain: 'assessment' },
            { item: 'Assessed tube security and skin integrity', points: 2, domain: 'assessment' },
            { item: 'Appropriate troubleshooting steps demonstrated', points: 2, domain: 'interventions' },
            { item: 'Clear parent education about tube care', points: 2, domain: 'communication' },
            { item: 'Documentation', points: 2, domain: 'documentation' }
          ]
        }
      },

      // ========== ANTT STATIONS ==========
      {
        id: 'antt-1',
        topic: 'antt',
        title: 'Standard ANTT for IV Medication Administration',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Prepare and administer IV medication using Standard ANTT technique. Identify and protect all Key Parts and Key Sites throughout the procedure.',
        equipment: ['ANTT field/sterile tray', 'IV medication vial', 'Sterile syringe and needle', 'Alcohol wipes', 'IV cannula hub (on patient/manikin)', 'Gloves', 'Apron', 'Sharps bin', 'Hand sanitizer'],
        checklist: {
          preparation: [
            'Perform hand hygiene thoroughly',
            'Put on apron',
            'Gather all equipment on clean tray',
            'Create ANTT field (clean area/sterile tray)',
            'Check medication name, dose, expiry date',
            'Identify Key Parts to be protected',
            'Identify Key Sites to be protected'
          ],
          assessment: [
            'KEY PARTS identified: Syringe tip, needle tip, IV hub connector',
            'KEY SITES identified: IV insertion site, IV hub port',
            'Verify patient identity and check allergies',
            'Assess IV cannula site for patency',
            'Check for signs of phlebitis or infiltration'
          ],
          interventions: [
            'Perform hand hygiene again before ANTT',
            'Put on non-sterile gloves',
            'Open packaging without contaminating Key Parts',
            'Protect syringe tip (do NOT touch)',
            'Clean vial top with alcohol wipe (70% alcohol)',
            'Allow alcohol to dry completely',
            'Draw up medication using non-touch technique',
            'Protect needle/syringe tip throughout',
            'Change needle if required',
            'Clean IV hub (Key Site) with alcohol wipe',
            'Allow alcohol to dry for 30 seconds',
            'Attach syringe to hub without touching Key Parts',
            'Inject medication at appropriate rate',
            'Flush cannula if required',
            'Dispose of sharps immediately',
            'Remove gloves and perform hand hygiene'
          ],
          communication: [
            'Explain procedure to patient and parent',
            'Warn about any sensations',
            'Inform if any discomfort felt they should tell you',
            'Explain Key Parts concept if teaching moment'
          ],
          safetyRedFlags: [
            'Touching Key Parts with non-sterile item - contamination',
            'Not allowing alcohol to dry - inactivates alcohol and stings',
            'Proceeding with visibly contaminated Key Part',
            'Not protecting Key Parts continuously from start to finish',
            'Hub not cleaned for 30 seconds - infection risk'
          ],
          documentation: [
            'Sign medication chart after administration',
            'Document site condition',
            'Record any complications',
            'Note batch number and expiry date'
          ]
        },
        tips: [
          'Key Parts: must stay sterile - if contaminated, causes infection',
          'Key Sites: points of entry that must be protected (e.g., IV insertion site)',
          'Standard ANTT for procedures <20 min with small Key Parts',
          'Non-touch technique: NEVER touch Key Parts, even with gloved hand',
          'Alcohol must dry for 30 seconds to be effective'
        ],
        warnings: [
          'Touching Key Part = contamination = potential bloodstream infection',
          'Wet alcohol doesn\'t kill microorganisms - must dry',
          'Once Key Part contaminated, must start again with new equipment',
          'IV line infections can lead to sepsis - technique is critical'
        ],
        mnemonics: [
          'ANTT: Aseptic Non-Touch Technique',
          'Key Parts: "Parts that if contaminated, cause infection"',
          'Key Sites: "Sites where Key Parts enter patient"',
          'Protection: "From Package to Patient - protect throughout"'
        ],
        scoring: {
          criticalFails: [
            'Touched Key Part with non-sterile item or hand',
            'Did not clean hub before access',
            'Proceeded with contaminated equipment'
          ],
          marks: [
            { item: 'Correct identification of Key Parts and Key Sites', points: 2, domain: 'assessment' },
            { item: 'Non-touch technique maintained throughout', points: 3, domain: 'interventions' },
            { item: 'Appropriate use of alcohol wipes and drying time', points: 2, domain: 'interventions' },
            { item: 'Protected Key Parts from preparation to completion', points: 2, domain: 'interventions' },
            { item: 'Hand hygiene at appropriate points', points: 1, domain: 'preparation' }
          ]
        }
      },

      {
        id: 'antt-2',
        topic: 'antt',
        title: 'Surgical ANTT for Central Line Dressing Change',
        difficulty: 'hard',
        estimatedMinutes: 12,
        candidateInstructions: 'Perform a central venous catheter (CVC) dressing change using Surgical ANTT. Maintain sterile field throughout and protect all Key Parts and Key Sites.',
        equipment: ['Sterile dressing pack', 'Sterile gloves (correct size)', 'Chlorhexidine 2% solution or wipes', 'Sterile transparent dressing', 'Sterile gauze', 'Apron', 'Mask', 'Non-sterile gloves', 'Sharps bin', 'Clinical waste bag'],
        checklist: {
          preparation: [
            'Perform hand hygiene',
            'Explain procedure to patient and parent',
            'Ensure privacy (close curtains)',
            'Position patient comfortably (supine, head turned away)',
            'Put on apron and mask',
            'Gather all equipment before starting',
            'Check sterile pack expiry date and integrity'
          ],
          assessment: [
            'Assess CVC site for signs of infection',
            'Check for redness, swelling, discharge, pain',
            'Verify CVC external length not changed',
            'Identify KEY PARTS: CVC exit site, CVC lumens, sterile gauze/dressing',
            'Identify KEY SITES: CVC insertion site, CVC hubs',
            'Note when dressing last changed'
          ],
          interventions: [
            'Perform hand hygiene',
            'Open sterile pack to create sterile field',
            'Put on non-sterile gloves',
            'Carefully remove old dressing',
            'Inspect site thoroughly',
            'Remove gloves and perform hand hygiene',
            'Put on STERILE gloves using correct technique',
            'Clean site with chlorhexidine using aseptic technique',
            'Start from center and work outward in circular motion',
            'Allow antiseptic to dry completely (30 seconds minimum)',
            'Apply new sterile dressing without touching adhesive or site',
            'Ensure dressing secure and date labeled',
            'Dispose of waste in clinical waste',
            'Remove gloves and perform hand hygiene'
          ],
          communication: [
            'Explain procedure before starting',
            'Warn patient not to touch sterile field',
            'Ask patient to keep still and turn head away',
            'Inform about any sensations during cleaning',
            'Report any concerns about site to senior immediately'
          ],
          safetyRedFlags: [
            'Contamination of sterile field - restart procedure',
            'Touching CVC exit site with non-sterile item',
            'Not wearing sterile gloves for dressing application',
            'Signs of infection at site - requires medical review',
            'CVC length changed - tube may have migrated'
          ],
          documentation: [
            'Document dressing change performed',
            'Record site condition (no redness, swelling, discharge)',
            'Note external CVC length',
            'Document any concerns or abnormalities',
            'Date dressing applied',
            'Sign and print name clearly'
          ]
        },
        tips: [
          'Surgical ANTT for procedures >20 min or with large sterile field',
          'Sterile gloves required when directly touching Key Sites',
          'CVC infections serious - meticulous technique essential',
          'If sterile field contaminated at ANY point - start again',
          'Chlorhexidine 2% is gold standard for CVC site cleaning'
        ],
        warnings: [
          'CVC-related bloodstream infections have high mortality',
          'Never touch CVC exit site or lumens with non-sterile item',
          'If site shows infection signs (redness, discharge, swelling) - escalate',
          'CVC migration can be life-threatening - always check external length',
          'Contaminated sterile field = restart entire procedure with new pack'
        ],
        mnemonics: [
          'Surgical ANTT: "Sterile gloves, Sterile field, Surgical precision"',
          'CVC site cleaning: "Center Outward, Dry completely, Dress Carefully"',
          'Sterile glove donning: "Cuff inside, finger outside" technique'
        ],
        scoring: {
          criticalFails: [
            'Contaminated sterile field and continued',
            'Touched CVC exit site without sterile gloves',
            'Did not allow antiseptic to dry'
          ],
          marks: [
            { item: 'Correct creation and maintenance of sterile field', points: 3, domain: 'interventions' },
            { item: 'Appropriate use of sterile gloves', points: 2, domain: 'interventions' },
            { item: 'Aseptic cleaning technique (center outward)', points: 2, domain: 'interventions' },
            { item: 'Allowed antiseptic to dry completely', points: 1, domain: 'interventions' },
            { item: 'Thorough site assessment', points: 1, domain: 'assessment' },
            { item: 'Complete documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'antt-3',
        topic: 'antt',
        title: 'Differentiating Standard vs Surgical ANTT',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Explain the difference between Standard and Surgical ANTT. Provide examples of when each should be used in paediatric nursing.',
        equipment: ['ANTT guidelines/reference', 'Visual aids showing Key Parts and Key Sites'],
        checklist: {
          preparation: [
            'Review ANTT principles',
            'Understand Key Parts and Key Sites concepts',
            'Know local ANTT policy'
          ],
          assessment: [
            'Can identify Key Parts in various procedures',
            'Can identify Key Sites in various procedures',
            'Can determine which ANTT approach needed',
            'Understands infection risk assessment'
          ],
          interventions: [
            'Explain Standard ANTT criteria:',
            '- Procedure duration <20 minutes',
            '- Small Key Parts (e.g., syringe tip, needle tip)',
            '- Technically simple procedures',
            '- Non-sterile gloves and non-touch technique',
            'Explain Surgical ANTT criteria:',
            '- Procedure duration >20 minutes',
            '- Large or multiple Key Parts',
            '- Complex procedures requiring critical asepsis',
            '- Sterile gloves and sterile field required',
            'Give Standard ANTT examples: IV drug admin, blood cultures, simple dressings',
            'Give Surgical ANTT examples: CVC insertion, complex wound care, catheter insertion'
          ],
          communication: [
            'Clear explanation of Key Parts concept',
            'Clear explanation of Key Sites concept',
            'Explain rationale for choosing ANTT type',
            'Discuss consequences of poor technique',
            'Give practical clinical examples'
          ],
          safetyRedFlags: [
            'Using Standard ANTT when Surgical ANTT required',
            'Not understanding Key Parts/Key Sites concept',
            'Touching Key Parts inappropriately',
            'Not recognizing when technique has been breached'
          ],
          documentation: [
            'Understand documentation requirements for ANTT procedures',
            'Know when to escalate concerns about technique',
            'Record any breaches in aseptic technique'
          ]
        },
        tips: [
          'Standard ANTT: Simple, Short, Small Key Parts',
          'Surgical ANTT: Sterile, Sustained, Serious procedures',
          'Both types protect Key Parts - just different methods',
          'Key Parts must NEVER be touched - this is fundamental',
          'When in doubt, use higher level of asepsis (Surgical ANTT)'
        ],
        warnings: [
          'Wrong ANTT type can lead to healthcare-associated infections',
          'Standard ANTT is NOT less important - just different approach',
          'ALWAYS protect Key Parts regardless of ANTT type',
          'Any breach in technique = contamination = potential infection'
        ],
        mnemonics: [
          'Standard ANTT: "Short Simple Small" (<20 min, simple procedure, small Key Parts)',
          'Surgical ANTT: "Sustained Sterile Serious" (>20 min, sterile field, serious risk)',
          'Key Parts: "If it touches patient or fluid, it\'s Key"'
        ],
        scoring: {
          criticalFails: [
            'Could not explain difference between Standard and Surgical ANTT',
            'Could not identify Key Parts or Key Sites',
            'Gave incorrect examples of when to use each type'
          ],
          marks: [
            { item: 'Clear explanation of Standard ANTT criteria', points: 2, domain: 'interventions' },
            { item: 'Clear explanation of Surgical ANTT criteria', points: 2, domain: 'interventions' },
            { item: 'Correct identification of Key Parts and Key Sites', points: 2, domain: 'assessment' },
            { item: 'Appropriate clinical examples provided', points: 2, domain: 'communication' },
            { item: 'Understanding of infection risk rationale', points: 2, domain: 'assessment' }
          ]
        }
      },

      // ========== INJECTION TECHNIQUE STATIONS ==========
      {
        id: 'inj-1',
        topic: 'injection',
        title: 'IM Injection - Vastus Lateralis Site',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Administer an intramuscular injection to this 18-month-old infant using the vastus lateralis site. Demonstrate correct technique including site selection, needle angle, and safe disposal.',
        equipment: ['Prescribed medication and chart', 'Appropriate syringe (2-3ml)', '23-25G needle (25mm)', 'Alcohol wipes', 'Cotton wool/gauze', 'Sharps bin', 'Gloves', 'Tray'],
        checklist: {
          preparation: [
            'Check prescription and perform 9 Rights',
            'Wash hands thoroughly',
            'Gather all equipment on clean tray',
            'Check medication name, dose, expiry',
            'Draw up medication using aseptic technique',
            'Label syringe if not giving immediately',
            'Check sharps bin available at point of use'
          ],
          assessment: [
            'Introduce self to parent and infant',
            'Verify patient identity (3-point check)',
            'Check allergies',
            'Assess injection site for contraindications',
            'Explain procedure to parent',
            'Position infant appropriately (lying/held by parent)'
          ],
          interventions: [
            'Put on gloves',
            'Identify vastus lateralis muscle (outer thigh)',
            'Locate site: middle third between hip and knee',
            'Clean site with alcohol wipe (circular motion)',
            'Allow alcohol to dry completely',
            'Stretch skin taut with non-dominant hand',
            'Hold syringe like a dart',
            'Insert needle at 90-degree angle with swift, smooth motion',
            'Aspirate briefly (if policy requires)',
            'Inject medication slowly and steadily',
            'Withdraw needle swiftly at same angle',
            'Apply gentle pressure with gauze (do NOT rub)',
            'Dispose of needle IMMEDIATELY in sharps bin WITHOUT resheathing',
            'Comfort infant',
            'Remove gloves and wash hands'
          ],
          communication: [
            'Warn parent about quick scratch sensation',
            'Provide distraction for infant during procedure',
            'Praise infant after procedure',
            'Advise parent about post-injection care',
            'Inform about possible side effects (soreness, redness)',
            'Explain when to seek help (signs of infection)'
          ],
          safetyRedFlags: [
            'Resheathing needle - needlestick injury risk',
            'Wrong angle (not 90°) - medication may not reach muscle',
            'Not allowing alcohol to dry - inactivates medication and stings',
            'Leaving needle on surface - sharps injury risk',
            'Rubbing site after injection - increases pain and bruising'
          ],
          documentation: [
            'Sign prescription chart immediately after administration',
            'Document injection site used',
            'Record time of administration',
            'Note any adverse reactions',
            'Document batch number and expiry date'
          ]
        },
        tips: [
          'Vastus lateralis preferred site for infants/toddlers - large, well-developed muscle',
          'Site location: middle third of outer thigh (divide thigh into thirds)',
          'Always insert at 90° for IM - this ensures medication reaches muscle',
          'Never leave needle on work surface - immediate disposal essential',
          'Sharps bin should be at point of use (within arm\'s reach)'
        ],
        warnings: [
          'NEVER resheath needles - most common cause of needlestick injuries',
          'Gluteal site NOT used in children under 3 years (underdeveloped muscle, sciatic nerve risk)',
          'Alcohol must dry completely - wet alcohol inactivates some vaccines',
          'Never inject into inflamed, scarred, or broken skin'
        ],
        mnemonics: [
          'Vastus lateralis location: "Middle third of outer thigh"',
          'IM injection: "90 degrees to reach the muscle"',
          'Safety: "See sharp, drop sharp" - immediate disposal without resheathing'
        ],
        scoring: {
          criticalFails: [
            'Resheathed needle',
            'Did not dispose of needle immediately',
            'Wrong injection angle (not 90°)',
            'Did not verify patient identity'
          ],
          marks: [
            { item: '9 Rights checked including patient ID', points: 2, domain: 'preparation' },
            { item: 'Correct site selection and identification', points: 2, domain: 'interventions' },
            { item: 'Correct 90° angle technique', points: 2, domain: 'interventions' },
            { item: 'Safe immediate needle disposal', points: 2, domain: 'interventions' },
            { item: 'Clear communication with parent', points: 1, domain: 'communication' },
            { item: 'Accurate documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'inj-2',
        topic: 'injection',
        title: 'Subcutaneous Injection Technique',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'Administer a subcutaneous injection (insulin) to this 10-year-old child with diabetes. Demonstrate correct technique including site selection, rotation, and angle.',
        equipment: ['Insulin pen or vial and insulin syringe', 'Alcohol wipes', 'Cotton wool', 'Sharps bin', 'Gloves', 'Injection site rotation chart'],
        checklist: {
          preparation: [
            'Check prescription and 9 Rights',
            'Wash hands thoroughly',
            'Check insulin type, dose, and expiry date',
            'Ensure insulin at room temperature (if refrigerated, remove 30 min prior)',
            'Inspect insulin for clarity (clear/cloudy as expected)',
            'Draw up correct dose or dial pen correctly',
            'Double-check dose',
            'Have sharps bin at point of use'
          ],
          assessment: [
            'Introduce self and verify patient identity',
            'Check allergies',
            'Check blood glucose level if required',
            'Review injection site rotation chart',
            'Select appropriate injection site',
            'Assess site for lumps (lipohypertrophy), redness, or bruising',
            'Avoid sites with lipohypertrophy'
          ],
          interventions: [
            'Put on gloves',
            'Clean injection site with alcohol wipe',
            'Allow alcohol to dry',
            'Pinch up skin fold with non-dominant hand',
            'Hold syringe/pen like a dart',
            'Insert needle at 45-90° angle (depending on needle length and child size)',
            'Release skin pinch after insertion',
            'Inject medication slowly',
            'Count to 5 before withdrawing (ensures full dose delivery)',
            'Withdraw needle smoothly',
            'Apply gentle pressure if needed (do NOT rub)',
            'Dispose of needle immediately in sharps bin',
            'Remove gloves and wash hands',
            'Update site rotation chart'
          ],
          communication: [
            'Explain procedure in age-appropriate language',
            'Involve child in site selection if appropriate',
            'Encourage child participation (older children may self-inject)',
            'Praise child for cooperation',
            'Discuss importance of site rotation',
            'Educate about recognizing lipohypertrophy',
            'Review timing in relation to meals'
          ],
          safetyRedFlags: [
            'Not rotating injection sites - causes lipohypertrophy',
            'Injecting into lipohypertrophy - erratic absorption',
            'Not waiting 5 seconds before withdrawal - medication leakage',
            'Rubbing site after injection - affects absorption',
            'Using cold insulin - painful and poor absorption'
          ],
          documentation: [
            'Sign prescription chart',
            'Document injection site used on rotation chart',
            'Record blood glucose if checked',
            'Note time of administration',
            'Document any site abnormalities'
          ]
        },
        tips: [
          'SC injection sites: Abdomen, outer thighs, outer upper arms, buttocks',
          'Abdomen absorption fastest, thighs slowest - be consistent',
          '45° angle for longer needles or thin children, 90° for shorter needles',
          'Site rotation prevents lipohypertrophy (lumpy areas with poor absorption)',
          'Count to 5-10 after injection before removing needle'
        ],
        warnings: [
          'Lipohypertrophy causes unpredictable insulin absorption - avoid these sites',
          'Site rotation is essential - same site daily causes tissue damage',
          'Cold insulin is painful and poorly absorbed',
          'Never inject into moles, scars, or lumpy areas'
        ],
        mnemonics: [
          'SC sites: "Belly, Bum, Thighs, Arms" (BBTA)',
          'SC angle: "45 if thin, 90 if not" (depends on needle length)',
          'After injection: "Wait 5, Don\'t Drive" (count 5 seconds, don\'t rub site)'
        ],
        scoring: {
          criticalFails: [
            'Injected into lipohypertrophy site',
            'Did not check insulin type/dose',
            'Wrong injection technique (e.g., injected into muscle)',
            'Did not rotate sites'
          ],
          marks: [
            { item: 'Correct site selection and rotation', points: 2, domain: 'assessment' },
            { item: 'Appropriate angle (45-90° based on factors)', points: 2, domain: 'interventions' },
            { item: 'Waited 5+ seconds before needle withdrawal', points: 1, domain: 'interventions' },
            { item: 'Updated site rotation chart', points: 1, domain: 'documentation' },
            { item: 'Patient education about site rotation', points: 2, domain: 'communication' },
            { item: 'Safe disposal and documentation', points: 2, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'inj-3',
        topic: 'injection',
        title: 'Needle Stick Injury Management',
        difficulty: 'medium',
        estimatedMinutes: 6,
        candidateInstructions: 'You have sustained a needlestick injury while administering an injection. Demonstrate immediate first aid and explain the steps you would take following the injury.',
        equipment: ['Running water and soap', 'Incident form', 'Occupational health contact details', 'Patient notes (source patient information)'],
        checklist: {
          preparation: [
            'Remain calm',
            'Put patient safety first (secure sharp, ensure patient safe)',
            'Note time of injury',
            'Note circumstances of injury'
          ],
          assessment: [
            'Assess depth and location of injury',
            'Assess source patient if known',
            'Note source patient bloodborne virus status if known',
            'Consider source patient risk factors'
          ],
          interventions: [
            'DO NOT squeeze or suck wound',
            'Encourage bleeding by gentle pressure around wound',
            'Wash wound thoroughly under running water',
            'Use soap and water for at least 5 minutes',
            'Dry and cover with waterproof dressing',
            'Dispose of sharp safely if not already done',
            'Report to senior nurse/person in charge immediately',
            'Contact occupational health urgently (within 1 hour)',
            'Complete incident report form',
            'Attend A&E or occupational health as directed'
          ],
          communication: [
            'Inform senior nurse immediately',
            'Report to occupational health within 1 hour',
            'Explain incident clearly',
            'Provide source patient details if known',
            'Follow occupational health instructions',
            'Inform own GP if advised',
            'Attend all follow-up appointments'
          ],
          safetyRedFlags: [
            'Delaying occupational health contact - PEP (post-exposure prophylaxis) time-critical',
            'Not knowing source patient status - affects management',
            'Squeezing or sucking wound - can increase infection risk',
            'Not completing incident report - legal and safety requirement',
            'Not following up - may need blood tests and vaccinations'
          ],
          documentation: [
            'Complete incident report form fully',
            'Document: Date, time, location, activity, how injury occurred',
            'Document source patient details if known',
            'Record immediate first aid given',
            'Document occupational health contact and advice',
            'Keep record of all follow-up appointments'
          ]
        },
        tips: [
          'PEP for HIV most effective if started within 1 hour (max 72 hours)',
          'Hepatitis B vaccination protects most healthcare workers',
          'Most needlestick injuries do NOT result in infection',
          'Prevention is key - never resheath needles',
          'Occupational health contact within 1 hour is crucial'
        ],
        warnings: [
          'DO NOT squeeze or suck wound - may increase infection risk',
          'Contact occupational health within 1 hour - PEP is time-critical',
          'Source patient testing requires consent - occupational health will arrange',
          'You may need time off work or adjustments - follow occupational health advice',
          'Needlestick injuries are often due to unsafe practices - reflect and learn'
        ],
        mnemonics: [
          'Needlestick first aid: "WASH" - Wound care (encourage bleeding), Alert senior, Seek occupational health within 1 Hour, Help yourself by documenting',
          'DO NOT: "Suck, Squeeze, or Stall" (don\'t suck wound, squeeze wound, or stall reporting)'
        ],
        scoring: {
          criticalFails: [
            'Did not wash wound under running water',
            'Did not contact occupational health urgently',
            'Squeezed or sucked the wound',
            'Did not complete incident report'
          ],
          marks: [
            { item: 'Immediate wound first aid (encourage bleeding, wash)', points: 2, domain: 'interventions' },
            { item: 'Contacted occupational health urgently (within 1 hour)', points: 3, domain: 'communication' },
            { item: 'Reported to senior nurse immediately', points: 2, domain: 'communication' },
            { item: 'Completed incident report fully', points: 2, domain: 'documentation' },
            { item: 'Explained follow-up requirements', points: 1, domain: 'communication' }
          ]
        }
      },

      // ========== DETERIORATING CHILD STATIONS ==========
      {
        id: 'det-1',
        topic: 'deteriorating',
        title: 'PEWS Score Calculation and Escalation',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Calculate the PEWS score for this 4-year-old child with respiratory symptoms. Determine if escalation is required and communicate using SBAR.',
        equipment: ['PEWS chart', 'Observation chart with vital signs', 'Stethoscope', 'Pulse oximeter', 'SBAR communication tool', 'Phone/call bell'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Wash hands',
            'Gather patient notes and observation chart',
            'Have PEWS chart available',
            'Ensure emergency equipment nearby'
          ],
          assessment: [
            'Review recent vital signs systematically',
            'Assess BEHAVIOUR: Playing/appropriate vs Sleeping/irritable/lethargic',
            'Score behaviour 0-3',
            'Assess CARDIOVASCULAR: HR, CRT, color',
            'Score cardiovascular 0-3',
            'Assess RESPIRATORY: RR, work of breathing, oxygen therapy',
            'Score respiratory 0-3',
            'Calculate TOTAL PEWS score',
            'Compare to escalation thresholds',
            'Identify if score triggers escalation',
            'Assess trend - is child improving or deteriorating?',
            'Note concerning signs not captured by PEWS'
          ],
          interventions: [
            'Document PEWS score on chart',
            'If score triggers escalation: ACT IMMEDIATELY',
            'Call for senior nurse/doctor as per protocol',
            'Prepare SBAR handover',
            'Continue monitoring closely',
            'Implement any immediate interventions needed',
            'Increase observation frequency if required'
          ],
          communication: [
            'Use SBAR framework for escalation',
            'SITUATION: State concern clearly and urgently',
            'BACKGROUND: Provide relevant history',
            'ASSESSMENT: Present PEWS score and observations',
            'RECOMMENDATION: State what you think is needed',
            'Explain to parent why escalating',
            'Reassure child and parent',
            'Document escalation and response'
          ],
          safetyRedFlags: [
            'PEWS ≥5: Immediate senior review required',
            'PEWS increase by 2+ points: Urgent escalation',
            'Respiratory score 3: Critical - immediate action',
            'Downplaying concerns - always escalate if worried',
            'Delaying escalation - minutes matter'
          ],
          documentation: [
            'Record PEWS score on observation chart',
            'Document time score calculated',
            'Note escalation made (who, when, response)',
            'Record any interventions implemented',
            'Document parent discussion'
          ]
        },
        tips: [
          'PEWS is objective tool to identify deterioration early',
          'Score ≥5 requires immediate senior review',
          'Increase of 2+ points in score requires urgent escalation',
          'Trust your gut - if child looks unwell, escalate even if PEWS not triggered',
          'PEWS does not replace clinical judgement - it supports it'
        ],
        warnings: [
          'Never delay escalation waiting for "a bit longer" - deterioration rapid in children',
          'PEWS trigger ignored = potential cardiac arrest',
          'Some sick children have deceptively "normal" PEWS - always consider whole picture',
          'Documenting PEWS without acting on triggers is negligent'
        ],
        mnemonics: [
          'PEWS components: "BCR" - Behaviour, Cardiovascular, Respiratory',
          'Escalation: "5 is High, 2 Up is Action Now" (Score ≥5 or increase ≥2)'
        ],
        scoring: {
          criticalFails: [
            'Did not calculate PEWS score correctly',
            'Failed to escalate when triggered',
            'Delayed escalation inappropriately'
          ],
          marks: [
            { item: 'Accurate PEWS calculation (all 3 components)', points: 3, domain: 'assessment' },
            { item: 'Recognized escalation trigger', points: 2, domain: 'assessment' },
            { item: 'Immediate appropriate escalation', points: 2, domain: 'interventions' },
            { item: 'Effective SBAR communication', points: 2, domain: 'communication' },
            { item: 'Documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'det-2',
        topic: 'deteriorating',
        title: 'ABCDE Assessment of Unwell Child',
        difficulty: 'hard',
        estimatedMinutes: 10,
        candidateInstructions: 'Perform a systematic ABCDE assessment on this 3-year-old who has become increasingly unwell over the past hour. Identify problems and take appropriate action.',
        equipment: ['Stethoscope', 'Pulse oximeter', 'BP cuff', 'Thermometer', 'Torch', 'Oxygen', 'Suction', 'Watch', 'Emergency call bell'],
        checklist: {
          preparation: [
            'Approach safely',
            'Wash hands/use gel',
            'Introduce self briefly',
            'Call for help if child appears critically unwell',
            'Ensure emergency equipment available',
            'Position child appropriately'
          ],
          assessment: [
            'A - AIRWAY: Check if patent and maintainable',
            'A - Look for obstruction signs (stridor, see-saw breathing)',
            'A - Listen for noisy breathing',
            'A - If airway compromised: STOP and manage immediately',
            'B - BREATHING: Assess respiratory effort',
            'B - Count RR for 60 seconds',
            'B - Observe work of breathing (recession, grunting, nasal flaring)',
            'B - Auscultate chest',
            'B - Apply pulse oximeter - check SpO2',
            'B - If breathing inadequate: Give oxygen, call for help',
            'C - CIRCULATION: Palpate pulse (rate, rhythm, volume)',
            'C - Assess CRT and peripheral perfusion',
            'C - Check BP if appropriate',
            'C - Assess color (pale, mottled, cyanosed)',
            'C - Feel peripheries (warm/cool)',
            'C - If circulation compromised: Call for help urgently',
            'D - DISABILITY: Assess consciousness (AVPU)',
            'D - Check pupil size and reaction',
            'D - Assess tone and movement',
            'D - Check blood glucose if available',
            'E - EXPOSURE: Check temperature',
            'E - Look for rash (non-blanching?)',
            'E - Examine for injury/surgical cause',
            'E - Maintain dignity and warmth'
          ],
          interventions: [
            'Treat problems as you find them - do NOT wait',
            'Open airway if needed (head tilt-chin lift)',
            'Give high-flow oxygen if SpO2 <92% or respiratory distress',
            'Call for senior help IMMEDIATELY if red flags',
            'Position child for optimal airway/breathing',
            'Keep child calm (parent nearby)',
            'Prepare for deterioration',
            'Document all findings'
          ],
          communication: [
            'Brief, focused communication with child/parent',
            'Call for help early using emergency call',
            'Use SBAR when senior arrives',
            'Clearly state urgency level',
            'Keep parent informed throughout',
            'Reassure child in age-appropriate way'
          ],
          safetyRedFlags: [
            'Airway obstruction - IMMEDIATE emergency',
            'Silent chest - pre-arrest sign',
            'Grunting respirations - severe respiratory distress',
            'Weak/absent pulse - cardiac arrest imminent',
            'Mottled/blue skin - shock/poor perfusion',
            'Unresponsive to pain (AVPU = U) - critical',
            'Non-blanching rash - meningococcal sepsis?'
          ],
          documentation: [
            'Record full ABCDE assessment findings',
            'Document time of assessment',
            'Note all interventions performed',
            'Record who escalated to and when',
            'Document parent communication'
          ]
        },
        tips: [
          'ABCDE approach is systematic and life-saving',
          'ALWAYS assess and treat in order: A -> B -> C -> D -> E',
          'Treat life-threatening problems IMMEDIATELY before moving to next step',
          'Call for help early - don\'t wait until child arrests',
          'Airway and breathing always take priority'
        ],
        warnings: [
          'Never complete full assessment before treating airway problem',
          'Silent chest is worse than wheeze - means minimal air entry',
          'Hypotension is LATE sign in children - child may be in shock with normal BP',
          'Grunting is serious - not just "noisy breathing"'
        ],
        mnemonics: [
          'ABCDE: Airway, Breathing, Circulation, Disability (neuro), Exposure (temp/wounds)',
          'AVPU: Alert, Voice, Pain, Unresponsive',
          'Assessment priority: "Air Before Blood Before Brain" (ABC order critical)'
        ],
        scoring: {
          criticalFails: [
            'Did not follow ABCDE order',
            'Failed to treat life-threatening problem before progressing',
            'Did not call for help when indicated',
            'Missed critical red flag sign'
          ],
          marks: [
            { item: 'Systematic ABCDE approach followed', points: 3, domain: 'assessment' },
            { item: 'Treated problems as found (not waiting)', points: 2, domain: 'interventions' },
            { item: 'Recognized all red flags', points: 2, domain: 'assessment' },
            { item: 'Appropriate escalation/called for help', points: 2, domain: 'communication' },
            { item: 'Complete documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'det-3',
        topic: 'deteriorating',
        title: 'Recognizing Sepsis Red Flags',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'This 18-month-old has been unwell for 12 hours with fever. Assess for signs of sepsis and explain the red flag features requiring urgent escalation.',
        equipment: ['Thermometer', 'Pulse oximeter', 'Watch', 'Observation chart', 'Sepsis screening tool', 'Emergency call bell'],
        checklist: {
          preparation: [
            'Introduce self to parent',
            'Wash hands',
            'Gather recent observation history',
            'Have sepsis screening tool ready',
            'Be aware of sepsis 6 protocol'
          ],
          assessment: [
            'Assess BEHAVIOUR: Lethargic? Not responding normally?',
            'Check if child rousable/interacting appropriately',
            'Assess APPEARANCE: Mottled/ashen/cyanosed skin?',
            'Look for non-blanching rash',
            'Assess BREATHING: Tachypnoea? Increased work?',
            'Check oxygen saturations',
            'Assess CIRCULATION: Tachycardia?',
            'Check CRT >2 seconds?',
            'Feel peripheries - cold?',
            'Assess HYDRATION: Reduced urine output?',
            'Check skin turgor and mucous membranes',
            'Review temperature - fever >38°C or hypothermia <36°C?',
            'Ask parent: "Does your child seem different to you?"',
            'Apply sepsis screening criteria for age',
            'Identify any RED FLAGS present'
          ],
          interventions: [
            'If red flags present: Call for help IMMEDIATELY',
            'Do not wait - sepsis is time-critical emergency',
            'Commence sepsis 6 pathway if trained',
            'Give high-flow oxygen if any breathing concerns',
            'Keep child with parent for comfort',
            'Prepare for rapid deterioration',
            'Ensure emergency equipment ready'
          ],
          communication: [
            'Escalate urgently using SBAR',
            'State "I am concerned about sepsis" clearly',
            'Communicate specific red flags identified',
            'Explain to parent why escalating urgently',
            'Keep parent informed throughout',
            'Document all concerns clearly'
          ],
          safetyRedFlags: [
            'RED FLAGS (UNDER 5): Appears ill to healthcare professional',
            'Non-blanching rash',
            'Objective evidence of altered mental state',
            'Tachycardia',
            'Reduced skin turgor',
            'Age <3 months with temp ≥38°C',
            'RED FLAGS (OVER 5): Same as above plus: Rigors, New altered mental state, Respiratory rate raised for age, Immune compromise'
          ],
          documentation: [
            'Complete sepsis screening tool',
            'Document all red flags identified',
            'Record vital signs',
            'Note time of escalation and to whom',
            'Document parent concerns',
            'Record interventions commenced'
          ]
        },
        tips: [
          'Sepsis can progress to septic shock rapidly in children',
          'Red flags require IMMEDIATE medical review',
          'Parent concern that "child not themselves" is significant',
          'Non-blanching rash + fever = meningococcal sepsis until proven otherwise',
          'Sepsis 6 should be completed within 1 hour of recognition'
        ],
        warnings: [
          'Never send parent away with "come back if worse" if red flags present',
          'Sepsis kills rapidly - minutes to hours',
          'Children can look relatively well then crash suddenly',
          'If you\'re worried about sepsis, escalate immediately - better false alarm than missed sepsis'
        ],
        mnemonics: [
          'Sepsis 6: "3 In, 3 Out within 1 Hour" (Oxygen, Fluids, Antibiotics IN; Blood cultures, Lactate, Urine output OUT)',
          'RED FLAGS: "Rash (non-blanching), Extremities cold, Decreased urine, Funny behavior (altered), Looks ill to me, Added tachycardia, Going fast (tachypnoea), Skin turgor reduced"'
        ],
        scoring: {
          criticalFails: [
            'Failed to identify red flag sepsis signs',
            'Did not escalate urgently',
            'Dismissed parent concerns about child being "different"'
          ],
          marks: [
            { item: 'Systematic sepsis assessment', points: 2, domain: 'assessment' },
            { item: 'Identified all red flags present', points: 3, domain: 'assessment' },
            { item: 'Immediate urgent escalation', points: 2, domain: 'communication' },
            { item: 'Parent education and communication', points: 2, domain: 'communication' },
            { item: 'Complete documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      // ========== POSITIONING & THERAPEUTIC HOLDING STATIONS ==========
      {
        id: 'pos-1',
        topic: 'positioning',
        title: 'Therapeutic Holding for Venepuncture',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Demonstrate appropriate therapeutic holding technique for a 4-year-old requiring venepuncture. Discuss consent, assent, and alternatives to holding.',
        equipment: ['Age-appropriate distraction toys', 'Topical anaesthetic cream', 'Comfort positioning aids (pillows)', 'Parent present', 'Second nurse available'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure in age-appropriate language',
            'Gain consent from parent for procedure',
            'Gain assent from child',
            'Discuss therapeutic holding with parent',
            'Assess child anxiety and cooperation level',
            'Ensure parent understands they comfort, not restrain',
            'Identify second nurse to assist with holding if needed'
          ],
          assessment: [
            'Assess child developmental level',
            'Identify previous experiences with procedures',
            'Assess child pain/anxiety using appropriate tool',
            'Determine if holding necessary or avoidable',
            'Consider alternatives: distraction, preparation, play therapy',
            'Assess topical anaesthesia applied and working'
          ],
          interventions: [
            'Attempt distraction techniques first',
            'Use play therapy/explanation with visual aids',
            'Give child choices where possible (which arm)',
            'Position child comfortably (sitting on parent lap or bed)',
            'Parent positioned for comfort role (not restraint)',
            'If holding needed: use minimal necessary restriction',
            'Hold limb securely but gently',
            'Avoid holding over joints',
            'Second nurse stabilizes arm for venepuncture',
            'Maintain child dignity throughout',
            'Praise child during and after procedure',
            'Allow child to express feelings'
          ],
          communication: [
            'Speak directly to child throughout',
            'Be honest about sensation ("sharp scratch")',
            'Never lie or use threatening language',
            'Explain to parent their role (cuddle, not hold down)',
            'Reassure child constantly',
            'Praise cooperation and bravery',
            'Debrief with child and parent after',
            'Provide comfort item/reward if appropriate'
          ],
          safetyRedFlags: [
            'Excessive force used - risk of injury',
            'Parent holding child against will - damages trust',
            'Not gaining assent from child - ethical concern',
            'Lying about pain - destroys trust permanently',
            'Using holding as first resort - should be last',
            'Restraining without clinical need - becomes restraint not holding'
          ],
          documentation: [
            'Document consent and assent obtained',
            'Record therapeutic holding used',
            'Note who held child and technique used',
            'Document alternatives attempted first',
            'Record child response to procedure',
            'Note any distress or concerns'
          ]
        },
        tips: [
          'Therapeutic holding is LAST resort - try preparation, distraction, topical anaesthesia first',
          'Parents comfort, staff hold - preserves parent-child trust',
          'Always gain assent from child where developmentally appropriate',
          'Minimal necessary restriction - enough for safety, not more',
          'Holding becomes restraint if excessive force or for staff convenience'
        ],
        warnings: [
          'Never use excessive force - can cause physical injury',
          'Parent restraining child damages parent-child relationship',
          'Therapeutic holding without consent/assent is restraint',
          'Must be in child best interest and last resort',
          'Document thoroughly - legal and safeguarding implications'
        ],
        mnemonics: [
          'Before holding: "PREP" - Preparation, Reduce anxiety, Explain, Play therapy',
          'During holding: "MINIMAL" - Minimum force, Inform constantly, No joints held, Involve child, Maintain dignity, Always last resort, Love and reassure'
        ],
        scoring: {
          criticalFails: [
            'Did not gain consent from parent',
            'Did not attempt alternatives before holding',
            'Used excessive force',
            'Parent forced to restrain child'
          ],
          marks: [
            { item: 'Consent and assent appropriately gained', points: 2, domain: 'preparation' },
            { item: 'Alternatives attempted (distraction, explanation)', points: 2, domain: 'assessment' },
            { item: 'Minimal necessary holding technique', points: 2, domain: 'interventions' },
            { item: 'Parent positioned for comfort not restraint', points: 2, domain: 'interventions' },
            { item: 'Honest, age-appropriate communication', points: 1, domain: 'communication' },
            { item: 'Thorough documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'pos-2',
        topic: 'positioning',
        title: 'Positioning for Lumbar Puncture',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'Position this 6-month-old infant for lumbar puncture. Demonstrate correct positioning while maintaining airway safety.',
        equipment: ['Clean procedure trolley', 'Pillow or rolled towel', 'Monitoring equipment', 'Oxygen and suction available'],
        checklist: {
          preparation: [
            'Introduce self to parent',
            'Explain procedure and positioning to parent',
            'Gain consent from parent',
            'Wash hands thoroughly',
            'Ensure emergency equipment available',
            'Position bed/trolley at appropriate height',
            'Ensure adequate lighting',
            'Have second person to assist'
          ],
          assessment: [
            'Assess infant baseline observations',
            'Check infant not recently fed (aspiration risk)',
            'Assess for contraindications (raised ICP signs)',
            'Note any breathing difficulties',
            'Assess skin integrity at positioning sites'
          ],
          interventions: [
            'Position infant in LATERAL position (on side)',
            'Draw knees up towards chest (fetal position)',
            'Flex head forward gently',
            'Support head with one hand',
            'Hold knees with other hand',
            'Keep spine curved and flexed',
            'Maintain position firmly but gently',
            'DO NOT over-flex neck (airway compromise risk)',
            'Ensure infant can breathe freely',
            'Monitor oxygen saturation continuously',
            'Watch for breathing difficulties',
            'Maintain position throughout procedure',
            'Talk soothingly to infant',
            'Release immediately if airway compromised'
          ],
          communication: [
            'Explain positioning rationale to parent',
            'Warn parent infant may cry',
            'Reassure throughout procedure',
            'Communicate with doctor performing LP',
            'Alert immediately if infant distress',
            'Update parent on progress'
          ],
          safetyRedFlags: [
            'Over-flexion of neck - airway obstruction risk',
            'Desaturation during procedure - STOP immediately',
            'Infant not breathing freely - release and reassess',
            'Excessive crying/distress - may indicate pain or compromise',
            'Cyanosis - immediate emergency'
          ],
          documentation: [
            'Document positioning technique used',
            'Record monitoring during procedure',
            'Note any difficulties or concerns',
            'Document infant tolerance of position',
            'Record vital signs before, during, after'
          ]
        },
        tips: [
          'Lateral fetal position opens lumbar spaces for LP',
          'NEVER over-flex neck - can obstruct airway in infants',
          'Continuous monitoring essential - SpO2, breathing, color',
          'Position should be firm enough to maintain but allow breathing',
          'Have suction and oxygen immediately available'
        ],
        warnings: [
          'Neck over-flexion in infants can cause airway obstruction and death',
          'Monitor breathing constantly - infants cannot tolerate prolonged flexion',
          'Stop immediately if any airway compromise',
          'Never proceed if infant not breathing freely'
        ],
        mnemonics: [
          'LP position: "C-Curve Spine, Open Line" (curved spine opens spaces, but keep airway open)',
          'Safety: "Never Flex neck Excessively" - NFE rule'
        ],
        scoring: {
          criticalFails: [
            'Over-flexed neck compromising airway',
            'Did not monitor breathing/SpO2',
            'Proceeded despite infant distress/desaturation'
          ],
          marks: [
            { item: 'Correct lateral fetal position', points: 2, domain: 'interventions' },
            { item: 'Appropriate neck flexion (NOT over-flexed)', points: 3, domain: 'interventions' },
            { item: 'Continuous monitoring of breathing and SpO2', points: 2, domain: 'interventions' },
            { item: 'Clear communication with parent', points: 1, domain: 'communication' },
            { item: 'Recognition of safety concerns', points: 2, domain: 'assessment' }
          ]
        }
      },

      {
        id: 'pos-3',
        topic: 'positioning',
        title: 'Safe Positioning and Handling Principles',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Discuss the principles of safe positioning and therapeutic holding in children. Explain when holding becomes restraint and legal/ethical considerations.',
        equipment: ['Information leaflet', 'Documentation examples', 'Hospital policy reference'],
        checklist: {
          preparation: [
            'Understand local therapeutic holding policy',
            'Know difference between holding and restraint',
            'Be aware of legal frameworks',
            'Understand children\'s rights',
            'Know escalation procedures'
          ],
          assessment: [
            'Can procedure be delayed until child more cooperative?',
            'Has child been adequately prepared?',
            'Are there alternatives to holding?',
            'Is holding in child best interest?',
            'Is parent informed and consenting?'
          ],
          interventions: [
            'ALWAYS try alternatives first:',
            '- Age-appropriate preparation',
            '- Play therapy and demonstration',
            '- Distraction techniques',
            '- Topical anaesthesia where appropriate',
            '- Giving child choices and control',
            'Therapeutic holding only if:',
            '- In child best interest',
            '- Clinically necessary',
            '- Last resort after alternatives tried',
            '- Minimum force necessary',
            '- Shortest duration possible',
            'Holding becomes RESTRAINT if:',
            '- Excessive force used',
            '- Not in child best interest',
            '- For staff convenience',
            '- No consent/assent obtained',
            '- Alternatives not tried'
          ],
          communication: [
            'Explain difference to parents: holding vs restraint',
            'Discuss parent role (comfort not restraint)',
            'Be honest with child about what will happen',
            'Debrief with child and family after',
            'Document thoroughly and accurately'
          ],
          safetyRedFlags: [
            'Using holding routinely without trying alternatives',
            'Excessive force causing injury',
            'Child extremely distressed without clinical emergency',
            'Parent forced to restrain against wishes',
            'No documentation of decision-making'
          ],
          documentation: [
            'Document alternatives attempted',
            'Record rationale for therapeutic holding',
            'Note consent and assent status',
            'Document technique used and who involved',
            'Record child response and any concerns',
            'Follow local policy for reporting/review'
          ]
        },
        tips: [
          'Therapeutic holding is clinical intervention requiring consent',
          'Always last resort after alternatives exhausted',
          'Minimum necessary force for shortest necessary time',
          'Parents comfort, staff hold - preserves trust',
          'Thorough documentation protects child, family, and staff'
        ],
        warnings: [
          'Restraint without legal justification is assault',
          'Excessive force can cause physical and psychological harm',
          'Poor practice damages trust and future healthcare engagement',
          'Inadequate documentation has legal implications'
        ],
        mnemonics: [
          'HOLDING principles: "Help child, Only if needed, Last resort, Dignity maintained, Informed consent, No excessive force, Gentle minimal restriction"',
          'When it\'s RESTRAINT: "Excessive force, No consent, Damage to child, Staff convenience"'
        ],
        scoring: {
          criticalFails: [
            'Could not differentiate holding from restraint',
            'Did not understand legal/ethical issues',
            'Suggested holding as first-line approach'
          ],
          marks: [
            { item: 'Clear understanding of therapeutic holding principles', points: 3, domain: 'assessment' },
            { item: 'Identified when holding becomes restraint', points: 2, domain: 'assessment' },
            { item: 'Described alternatives to holding', points: 2, domain: 'interventions' },
            { item: 'Explained consent and documentation requirements', points: 2, domain: 'communication' },
            { item: 'Demonstrated awareness of child rights', points: 1, domain: 'preparation' }
          ]
        }
      },

      // ========== PERIOPERATIVE CARE STATIONS ==========
      {
        id: 'peri-1',
        topic: 'perioperative',
        title: 'Pre-Operative Fasting Assessment',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Assess this 4-year-old child scheduled for elective surgery at 10am. Verify fasting status and educate the parent about NPO guidelines.',
        equipment: ['Pre-operative checklist', 'Patient notes', 'Fasting guideline reference', 'Pen'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Verify patient identity (3-point check)',
            'Check consent form signed',
            'Review surgical procedure scheduled',
            'Note scheduled surgery time'
          ],
          assessment: [
            'Ask when child last ate solid food',
            'Ask when child last had formula/milk',
            'Ask when child last had clear fluids',
            'Check type of fluids consumed',
            'Verify child has not chewed gum',
            'Ask about any sweets/snacks given',
            'Assess child hydration status',
            'Note any difficulty with fasting'
          ],
          interventions: [
            'Apply 2-4-6 fasting rule for children over 6 months',
            'Verify clear fluids allowed up to 2 hours pre-op',
            'Verify breast milk allowed up to 4 hours pre-op',
            'Verify formula/solid food allowed up to 6 hours pre-op',
            'Check fasting times meet requirements',
            'Document last oral intake (time and type)',
            'If fasting breached, inform anaesthetist immediately',
            'Apply NPO sign to bed/cot if required'
          ],
          communication: [
            'Explain reason for fasting (aspiration risk)',
            'Educate parent on 2-4-6 rule',
            'Clarify what counts as clear fluids (water, dilute squash)',
            'Explain what is NOT allowed (milk, juice with pulp, chewing gum)',
            'Reassure about child safety',
            'Discuss distraction strategies for hungry child',
            'Inform when child can eat/drink post-operatively'
          ],
          safetyRedFlags: [
            'Fasting times not met - surgery must be delayed',
            'Parent unclear about what was consumed - clarify urgently',
            'Child given food/drink within fasting period - inform anaesthetist',
            'Chewing gum consumed - counts as solid food'
          ],
          documentation: [
            'Record last food intake (time and type)',
            'Record last fluid intake (time and type)',
            'Document fasting compliance verified',
            'Note any fasting breach and escalation',
            'Sign pre-operative checklist'
          ]
        },
        tips: [
          '2-4-6 rule: Clear fluids 2hrs, Breast milk 4hrs, Formula/Food 6hrs',
          'Clear fluids: water, dilute squash (NOT milk, juice with pulp, fizzy drinks)',
          'Chewing gum counts as solid food - stimulates gastric secretions',
          'Infants under 6 months may have different guidelines - check policy'
        ],
        warnings: [
          'Never proceed if fasting breached - aspiration risk during anaesthesia',
          'Some medications need to be given with small sips of water - check with anaesthetist',
          'Prolonged fasting can cause hypoglycaemia - especially in diabetic children',
          'Clear documentation essential - theatre will check'
        ],
        mnemonics: [
          '2-4-6 rule: "2 for Water, 4 for Breast, 6 for the Rest"',
          'NPO = Nil Per Os (nothing by mouth)'
        ],
        scoring: {
          criticalFails: [
            'Did not verify fasting times',
            'Allowed surgery to proceed with fasting breach',
            'Gave incorrect fasting guidelines to parent'
          ],
          marks: [
            { item: 'Thorough fasting history taken', points: 2, domain: 'assessment' },
            { item: 'Correctly applied 2-4-6 rule', points: 2, domain: 'interventions' },
            { item: 'Clear parent education about fasting', points: 2, domain: 'communication' },
            { item: 'Accurate documentation', points: 2, domain: 'documentation' }
          ]
        }
      },

      {
        id: 'peri-2',
        topic: 'perioperative',
        title: 'Post-Operative Observations and ABCDE',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'This 7-year-old child has just returned from theatre following appendicectomy. Perform initial post-operative assessment using ABCDE approach.',
        equipment: ['Observation chart', 'Pulse oximeter', 'Thermometer', 'Stethoscope', 'Blood pressure cuff', 'Watch', 'Torch', 'Pain assessment tool'],
        checklist: {
          preparation: [
            'Receive handover from recovery nurse/anaesthetist',
            'Note procedure performed and anaesthetic type',
            'Check post-operative instructions',
            'Wash hands',
            'Ensure emergency equipment available',
            'Position child appropriately (recovery position if drowsy)'
          ],
          assessment: [
            'AIRWAY: Check airway patent and maintained',
            'AIRWAY: Look for airway obstruction signs',
            'AIRWAY: Listen for noisy breathing, stridor',
            'BREATHING: Count respiratory rate for 60 seconds',
            'BREATHING: Assess work of breathing',
            'BREATHING: Auscultate chest bilaterally',
            'BREATHING: Apply pulse oximeter and record SpO2',
            'CIRCULATION: Palpate pulse (rate, rhythm, volume)',
            'CIRCULATION: Measure blood pressure',
            'CIRCULATION: Assess capillary refill time',
            'CIRCULATION: Check colour (pallor, cyanosis)',
            'CIRCULATION: Assess surgical site for bleeding',
            'DISABILITY: Assess level of consciousness (AVPU)',
            'DISABILITY: Check pupils (size, equality, reaction)',
            'DISABILITY: Assess pain score',
            'EXPOSURE: Check temperature',
            'EXPOSURE: Inspect wound dressing',
            'EXPOSURE: Check drain output if present'
          ],
          interventions: [
            'Record all observations on chart',
            'Compare with baseline pre-operative observations',
            'Ensure oxygen therapy if prescribed',
            'Position for comfort and safety',
            'Administer analgesia as prescribed',
            'Provide anti-emetic if nausea/vomiting',
            'Continue NBM until appropriate',
            'Plan observation frequency (every 15 min initially)'
          ],
          communication: [
            'Explain to parent what you are doing',
            'Reassure child',
            'Report any concerns immediately using SBAR',
            'Document findings clearly',
            'Inform parent of post-op care plan'
          ],
          safetyRedFlags: [
            'Airway obstruction - immediate emergency',
            'SpO2 <92% - oxygen required',
            'Severe pain unrelieved by analgesia - surgical complication?',
            'Tachycardia + pallor + low BP - bleeding/shock',
            'Not rousing appropriately - prolonged sedation',
            'Excessive wound drainage - haemorrhage risk'
          ],
          documentation: [
            'Complete post-operative observation chart',
            'Document ABCDE assessment findings',
            'Record time returned from theatre',
            'Note pain score and analgesia given',
            'Document fluid balance',
            'Sign and time all entries'
          ]
        },
        tips: [
          'ABCDE approach ensures systematic assessment',
          'Treat problems as you find them - don\'t wait to finish assessment',
          'Airway is ALWAYS priority in post-op patient',
          'Initial observations every 15 minutes until stable',
          'Compare to baseline - significant changes need escalation'
        ],
        warnings: [
          'Never leave drowsy child unattended - airway risk',
          'Hypotension is LATE sign in children - look for early shock signs',
          'Post-op bleeding can be internal - monitor for shock signs',
          'Unrelieved pain may indicate surgical complication'
        ],
        mnemonics: [
          'ABCDE: Airway, Breathing, Circulation, Disability (neuro), Exposure (temp/wounds)',
          'AVPU: Alert, Voice responsive, Pain responsive, Unresponsive',
          'Post-op priorities: "Air Before Blood Before Brain" (A, B, C, D, E order)'
        ],
        scoring: {
          criticalFails: [
            'Did not assess airway first',
            'Failed to use systematic ABCDE approach',
            'Did not recognize red flag signs',
            'Left drowsy child unattended'
          ],
          marks: [
            { item: 'Complete systematic ABCDE assessment', points: 4, domain: 'assessment' },
            { item: 'Appropriate positioning for airway safety', points: 1, domain: 'interventions' },
            { item: 'Recognition of red flags and escalation', points: 2, domain: 'assessment' },
            { item: 'Thorough documentation', points: 2, domain: 'documentation' },
            { item: 'Clear communication with parent', points: 1, domain: 'communication' }
          ]
        }
      },

      {
        id: 'peri-3',
        topic: 'perioperative',
        title: 'Pre-Operative Checklist and Safety Checks',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'Complete the pre-operative checklist for this 6-year-old about to go to theatre for tonsillectomy. Perform all safety checks.',
        equipment: ['Pre-operative checklist', 'Patient notes', 'Consent form', 'Patient wristband', 'Surgical site marking pen (if applicable)', 'Allergy band'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Verify patient identity with 3-point check',
            'Check child changed into theatre gown',
            'Ensure child has voided (passed urine)',
            'Check all jewellery removed (including piercings)',
            'Remove nail polish if present',
            'Check hair secured (no clips/bands if metal)'
          ],
          assessment: [
            'Verify correct patient for correct procedure',
            'Check consent form: signed, dated, correct procedure',
            'Verify person with parental responsibility signed consent',
            'Check patient wristband: name, DOB, NHS number',
            'Verify allergy status documented',
            'Check allergy band applied if allergies present',
            'Verify fasting status documented and compliant',
            'Review anaesthetic assessment completed',
            'Check baseline observations recorded',
            'Verify any pre-medication given if prescribed',
            'Check surgical site marked if applicable (WHO guidelines)'
          ],
          interventions: [
            'Complete all sections of pre-operative checklist',
            'Document patient ready for theatre',
            'Ensure notes, X-rays, and consent accompany patient',
            'Apply identification bands if missing',
            'Ensure emergency contact details documented',
            'Remove any loose teeth/dental appliances',
            'Provide comfort item if allowed (toy to anaesthetic room)',
            'Prepare parent if accompanying to anaesthetic room'
          ],
          communication: [
            'Explain theatre process to child in age-appropriate way',
            'Discuss with parent what will happen',
            'Explain who can accompany child (usually one parent to anaesthetic room)',
            'Reassure child and parent',
            'Answer any last-minute questions',
            'Handover to theatre team using SBAR',
            'Document all verbal information given'
          ],
          safetyRedFlags: [
            'Consent not signed - surgery cannot proceed',
            'Wrong patient/wrong procedure - NEVER proceed',
            'Fasting breached - inform anaesthetist immediately',
            'Allergy not documented - critical safety issue',
            'Incomplete checklist - do not send to theatre'
          ],
          documentation: [
            'Complete entire pre-operative checklist',
            'Sign and print name on all relevant sections',
            'Document time patient left ward',
            'Record who accompanied patient',
            'Note any concerns or incidents',
            'Ensure all documents with patient'
          ]
        },
        tips: [
          'WHO Surgical Safety Checklist prevents wrong site/wrong patient surgery',
          'Never rush checklist - each item is there for patient safety',
          'If in doubt about ANY item - stop and clarify',
          'Two patient identifiers minimum - name and DOB',
          'Parent can usually accompany to anaesthetic room - check local policy'
        ],
        warnings: [
          'Missing consent = cancelled surgery',
          'Wrong patient identification is Never Event - check carefully',
          'Incomplete checklist puts patient at risk - every item matters',
          'Allergy information MUST be accurate - anaphylaxis risk'
        ],
        mnemonics: [
          'Pre-op safety: "ID, Consent, Fast, Allergies, Site" - essentials before theatre',
          'WHO checklist: "Sign In, Time Out, Sign Out" - three stages of surgical safety'
        ],
        scoring: {
          criticalFails: [
            'Did not verify patient identity adequately',
            'Sent patient to theatre with incomplete checklist',
            'Failed to check consent form',
            'Did not verify fasting status'
          ],
          marks: [
            { item: 'Thorough patient identification checks', points: 2, domain: 'assessment' },
            { item: 'Complete pre-operative checklist', points: 3, domain: 'interventions' },
            { item: 'Verification of consent and fasting', points: 2, domain: 'assessment' },
            { item: 'Appropriate SBAR handover to theatre', points: 2, domain: 'communication' },
            { item: 'Complete documentation', points: 1, domain: 'documentation' }
          ]
        }
      },

      // ========== MEDICATION MANAGEMENT STATIONS ==========
      {
        id: 'med-1',
        topic: 'medication',
        title: 'Medication Administration - 9 Rights Check',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Prepare and administer oral paracetamol to this 5-year-old child. Demonstrate all 9 Rights of medication administration.',
        equipment: ['Prescription chart', 'Paracetamol suspension', 'Oral syringe', 'BNFc (British National Formulary for Children)', 'Medicine pot', 'Water', 'Patient wristband'],
        checklist: {
          preparation: [
            'Wash hands thoroughly',
            'Check prescription is legible and valid',
            'Verify prescription signed by prescriber',
            'Check no allergies documented',
            'Gather medication and equipment',
            'Check medication not already given'
          ],
          assessment: [
            'RIGHT PATIENT: Check 3-point ID (ask name/DOB, check wristband, check chart)',
            'RIGHT DRUG: Check medication name matches prescription exactly',
            'RIGHT DOSE: Calculate dose using weight/age, check with BNFc',
            'RIGHT ROUTE: Confirm oral route as prescribed',
            'RIGHT TIME: Check due time and timing interval correct',
            'RIGHT DOCUMENTATION: Check prescription chart complete',
            'RIGHT REASON: Understand why medication prescribed',
            'RIGHT RESPONSE: Know expected effect and monitoring needed',
            'RIGHT TO REFUSE: Acknowledge child/parent can refuse'
          ],
          interventions: [
            'Check medication expiry date',
            'Measure dose accurately using oral syringe',
            'Double-check dose measurement',
            'Explain medication to child in simple terms',
            'Gain child cooperation/assent',
            'Position child upright',
            'Administer medication safely',
            'Offer drink of water after',
            'Stay with child until medication swallowed',
            'Dispose of equipment safely',
            'Wash hands',
            'Sign prescription chart IMMEDIATELY AFTER administration'
          ],
          communication: [
            'Introduce self to child and parent',
            'Explain medication name and purpose to parent',
            'Use age-appropriate language for child',
            'Check child/parent understanding',
            'Advise when next dose due',
            'Inform about potential side effects'
          ],
          safetyRedFlags: [
            'Signing chart before administration - NEVER do this',
            'Wrong patient - critical medication error',
            'Wrong dose - can cause harm/overdose',
            'Exceeding maximum daily dose (e.g., >4 paracetamol doses in 24h)',
            'Not checking allergies - anaphylaxis risk'
          ],
          documentation: [
            'Sign prescription chart with full signature',
            'Print name clearly',
            'Record time of administration',
            'Document if dose refused or omitted',
            'Note any adverse reactions'
          ]
        },
        tips: [
          '9 Rights: Patient, Drug, Dose, Route, Time, Documentation, Reason, Response, Right to Refuse',
          'NEVER sign chart before giving medication - falsification of records',
          'If in doubt, don\'t give it out - check with senior/pharmacist',
          'Maximum 4 paracetamol doses in 24 hours - always check timing',
          'Weight-based dosing in children - always verify calculation'
        ],
        warnings: [
          'Signing before administration is professional misconduct',
          'Paracetamol overdose causes liver failure - check timing carefully',
          'Always check allergies - even for common medications',
          'Never leave medications at bedside in paediatrics'
        ],
        mnemonics: [
          '9 Rights mnemonic: "Peter\'s Dog Definitely Runs Towards Dogs Regularly, Refuses Rest" (Patient, Drug, Dose, Route, Time, Documentation, Reason, Response, Refuse)'
        ],
        scoring: {
          criticalFails: [
            'Did not check patient ID with 3-point check',
            'Signed chart before administering medication',
            'Incorrect dose calculation',
            'Did not check allergies'
          ],
          marks: [
            { item: 'Correct 3-point patient identification', points: 2, domain: 'assessment' },
            { item: 'All 9 Rights checked systematically', points: 3, domain: 'assessment' },
            { item: 'Accurate dose preparation', points: 2, domain: 'interventions' },
            { item: 'Signed chart after administration only', points: 2, domain: 'documentation' },
            { item: 'Clear communication with child and parent', points: 1, domain: 'communication' }
          ]
        }
      },

      {
        id: 'med-2',
        topic: 'medication',
        title: 'Controlled Drug Administration',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Administer oral morphine (controlled drug) to this 8-year-old post-operative patient. Demonstrate correct CD procedure with two nurses.',
        equipment: ['Controlled drug register', 'CD keys', 'Morphine solution', 'Oral syringe', 'Prescription chart', 'Calculator', 'Second registered nurse (examiner will role-play)', 'CD cupboard'],
        checklist: {
          preparation: [
            'Identify second registered nurse to witness',
            'Both nurses wash hands',
            'Obtain CD keys',
            'Check prescription chart together',
            'Verify patient ID together (3-point check)',
            'Check allergies together',
            'Open CD cupboard together'
          ],
          assessment: [
            'Both nurses check drug name on bottle',
            'Both nurses check drug strength',
            'Both nurses calculate required dose',
            'Both nurses independently verify calculation',
            'Check expiry date together',
            'Check previous CD register entry',
            'Verify stock balance in cupboard'
          ],
          interventions: [
            'First nurse draws up dose',
            'Second nurse observes and checks dose',
            'Both nurses verify dose in syringe',
            'Lock CD cupboard',
            'Both nurses go to patient together',
            'Confirm patient ID again at bedside',
            'Both nurses witness administration',
            'Ensure patient swallows medication',
            'Both nurses return to CD cupboard together',
            'Both nurses complete CD register',
            'Record: Date, Time, Patient name/details, Dose given, New stock balance',
            'Both nurses sign CD register',
            'Print names clearly',
            'Lock CD cupboard',
            'Return keys to designated person',
            'Both nurses sign prescription chart'
          ],
          communication: [
            'Explain to parent why two nurses required',
            'Inform child about medication in simple terms',
            'Discuss pain relief expectations',
            'Advise about monitoring for effectiveness',
            'Inform about potential side effects (drowsiness, nausea)',
            'Clear handover between nurses about CD procedure'
          ],
          safetyRedFlags: [
            'Single nurse administering CD - must be two RNs',
            'Discrepancy in CD stock - STOP and report immediately',
            'Calculation error - can cause fatal overdose',
            'Not both witnessing administration - both must see patient swallow',
            'CD register not completed - legal requirement'
          ],
          documentation: [
            'CD register: Both nurses sign',
            'CD register: Stock balance calculated and recorded',
            'Prescription chart: Both nurses sign',
            'Document time of administration',
            'Note pain score before and plan reassessment time'
          ]
        },
        tips: [
          'TWO registered nurses required for entire CD process',
          'Both must witness drawing up, administration, and sign register',
          'CD register is legal document - must be accurate',
          'Check stock balance - discrepancies must be reported immediately',
          'Morphine dosing in children is weight-based - verify carefully'
        ],
        warnings: [
          'Single-nurse CD administration is illegal and unsafe',
          'CD stock discrepancies can indicate diversion/theft - escalate',
          'Morphine respiratory depression risk - monitor closely',
          'Never leave CD cupboard unlocked or unattended'
        ],
        mnemonics: [
          'CD procedure: "Two Check Together" - two nurses check everything together throughout'
        ],
        scoring: {
          criticalFails: [
            'Did not have second nurse present throughout',
            'Did not both witness administration',
            'Did not complete CD register',
            'CD cupboard left unlocked'
          ],
          marks: [
            { item: 'Second nurse present throughout entire procedure', points: 2, domain: 'preparation' },
            { item: 'Both nurses checked dose calculation', points: 2, domain: 'assessment' },
            { item: 'Both nurses witnessed administration', points: 2, domain: 'interventions' },
            { item: 'CD register completed correctly by both', points: 2, domain: 'documentation' },
            { item: 'Stock balance verified and recorded', points: 1, domain: 'documentation' },
            { item: 'Clear communication about CD procedure', points: 1, domain: 'communication' }
          ]
        }
      },

      {
        id: 'med-3',
        topic: 'medication',
        title: 'Medication Calculation and Administration',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'Calculate and prepare IV antibiotics for this 10-year-old child weighing 32kg. Demonstrate accurate calculation and preparation using aseptic technique.',
        equipment: ['Prescription chart', 'Gentamicin vial (80mg/2ml)', 'IV fluid bag (50ml 0.9% sodium chloride)', 'Needles and syringes', 'Alcohol wipes', 'Calculator', 'BNFc', 'Sharps bin'],
        checklist: {
          preparation: [
            'Wash hands thoroughly',
            'Check prescription legible and valid',
            'Gather drug information from BNFc',
            'Verify patient weight documented',
            'Check allergies',
            'Gather all equipment',
            'Clean preparation area'
          ],
          assessment: [
            'Check prescribed dose: mg/kg/dose',
            'Calculate required dose for patient weight',
            'CALCULATION: Dose (mg) = weight (kg) × mg/kg prescribed',
            'Example: 32kg × 5mg/kg = 160mg',
            'Calculate volume needed from vial strength',
            'CALCULATION: Volume = (Dose required ÷ Vial strength) × Volume in vial',
            'Example: (160mg ÷ 80mg) × 2ml = 4ml',
            'Double-check calculation independently',
            'Verify dose within safe range (check BNFc max dose)',
            'Check drug compatibility with IV fluid'
          ],
          interventions: [
            'Perform hand hygiene',
            'Check drug name and expiry date',
            'Clean vial top with alcohol wipe',
            'Draw up calculated volume using aseptic technique',
            'Check volume in syringe matches calculation',
            'Label syringe clearly (drug name, dose, patient name, date/time)',
            'Add to IV infusion bag using ANTT',
            'Mix thoroughly',
            'Label IV bag completely',
            'Dispose of needle in sharps bin immediately',
            'Do NOT resheath needle',
            'Take to patient with prescription chart'
          ],
          communication: [
            'Have second nurse check calculation',
            'Explain procedure to parent and child',
            'Discuss expected duration of infusion',
            'Advise about monitoring during infusion',
            'Document calculation clearly'
          ],
          safetyRedFlags: [
            'Calculation error - can cause fatal overdose or under-treatment',
            'Wrong weight used - always verify patient weight',
            'Exceeding maximum dose - check BNFc limits',
            'No second check of calculation - required for high-risk drugs',
            'Unlabeled syringe - drug error risk'
          ],
          documentation: [
            'Document calculation in notes',
            'Show: Weight used, mg/kg dose, total dose calculated, volume drawn',
            'Record second checker name and signature',
            'Sign prescription chart after administration',
            'Document start time of infusion'
          ]
        },
        tips: [
          'Weight-based calculation formula: mg/kg × weight = total dose',
          'Volume calculation: (Required dose ÷ Stock strength) × Stock volume',
          'Always get second nurse to check calculation for IV/high-risk drugs',
          'Write calculation down - don\'t rely on mental math',
          'Check max dose in BNFc - especially important in large/small children'
        ],
        warnings: [
          'Calculation errors are common cause of medication incidents',
          'Aminoglycosides (like gentamicin) can cause kidney/hearing damage - accurate dosing essential',
          'Always use actual patient weight - never estimate',
          'Decimal point errors can cause 10-fold dosing errors'
        ],
        mnemonics: [
          'Calculation check: "Weight × dose per kg = Total dose, then check the Max"',
          'Volume formula: "What you want ÷ What you\'ve got × Volume it\'s in"'
        ],
        scoring: {
          criticalFails: [
            'Incorrect dose calculation',
            'Did not verify patient weight',
            'Exceeded maximum safe dose',
            'No second nurse check'
          ],
          marks: [
            { item: 'Accurate dose calculation using weight', points: 2, domain: 'assessment' },
            { item: 'Accurate volume calculation', points: 2, domain: 'assessment' },
            { item: 'Second nurse check obtained', points: 1, domain: 'communication' },
            { item: 'Aseptic technique during preparation', points: 2, domain: 'interventions' },
            { item: 'Clear documentation of calculation', points: 2, domain: 'documentation' },
            { item: 'Correct labeling of prepared medication', points: 1, domain: 'interventions' }
          ]
        }
      },

      // ========== LINES & TAPES STATIONS (NEW) ==========
      {
        id: 'lines-1',
        topic: 'lines',
        title: 'Securing Peripheral IV Cannula',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Demonstrate how to secure a peripheral IV cannula on a 3-year-old child. Explain your technique and the importance of proper securing to the parent.',
        equipment: ['IV cannula (already inserted on manikin)', 'Transparent IV dressing (e.g., Tegaderm)', 'Sterile gauze', 'Hypoallergenic tape', 'Bandage for splinting', 'Arm splint/board', 'Gloves', 'Documentation chart'],
        checklist: {
          preparation: [
            'Wash hands and apply gloves',
            'Introduce self to child and parent',
            'Explain procedure in age-appropriate terms',
            'Gather all equipment before starting',
            'Ensure child is comfortable and distracted'
          ],
          assessment: [
            'Check cannula is correctly positioned',
            'Assess insertion site for redness, swelling, leakage',
            'Confirm cannula flushes without resistance',
            'Check skin integrity around site',
            'Assess need for splinting based on location and child age'
          ],
          interventions: [
            'Clean around insertion site if needed',
            'Apply transparent dressing over insertion site',
            'Ensure insertion site remains VISIBLE through dressing',
            'Secure tubing with loop to prevent traction',
            'Apply tape to secure extension set',
            'Apply splint if cannula at joint (elbow/wrist)',
            'Ensure fingers visible to check circulation',
            'Avoid circumferential taping',
            'Label dressing with date, time, and initials'
          ],
          communication: [
            'Explain to parent why site must be visible',
            'Teach parent signs of extravasation to report',
            'Discuss importance of not pulling on tubing',
            'Explain when to call for help'
          ],
          safetyRedFlags: [
            'Insertion site NOT visible - risk of undetected extravasation',
            'Circumferential taping - risk of circulation compromise',
            'Too tight splinting - check distal circulation',
            'Signs of extravasation: swelling, blanching, coolness, pain'
          ],
          documentation: [
            'Record cannula site and gauge',
            'Document date and time of insertion',
            'Record VIP score (Visual Infusion Phlebitis)',
            'Note condition of site and any concerns'
          ]
        },
        tips: [
          'Transparent dressing allows continuous site monitoring',
          'Loop tubing before securing to prevent accidental pull-out',
          'Distraction techniques: bubbles, videos, parental comfort',
          'Check VIP score every shift minimum'
        ],
        warnings: [
          'NEVER cover insertion site with opaque dressing',
          'Extravasation can cause tissue necrosis within hours',
          'Tight bandaging can cause compartment syndrome',
          'Always check distal circulation after securing'
        ],
        mnemonics: [
          'VIP score: Visual Infusion Phlebitis - check for pain, redness, swelling',
          'STOP infusion if: Swelling, Tightness, Oozing, Pain'
        ],
        scoring: {
          criticalFails: [
            'Insertion site not visible after securing',
            'Failed to check distal circulation',
            'Circumferential taping applied'
          ],
          marks: [
            { item: 'Site visible through dressing', points: 3, domain: 'interventions' },
            { item: 'Appropriate splinting technique', points: 2, domain: 'interventions' },
            { item: 'Parent education on warning signs', points: 2, domain: 'communication' },
            { item: 'Documentation complete', points: 1, domain: 'documentation' }
          ]
        }
      },
      {
        id: 'lines-2',
        topic: 'lines',
        title: 'Securing Nasogastric Tube',
        difficulty: 'medium',
        estimatedMinutes: 7,
        candidateInstructions: 'Demonstrate how to secure a nasogastric tube on a 6-month-old infant. The tube has already been inserted and position confirmed. Focus on safe securing technique.',
        equipment: ['NG tube (already in situ on manikin)', 'Hydrocolloid dressing', 'Hypoallergenic tape', 'Skin barrier wipe', 'Tape measure', 'Marker pen', 'Documentation chart'],
        checklist: {
          preparation: [
            'Wash hands thoroughly',
            'Introduce self and explain to parent',
            'Ensure infant is settled and comfortable',
            'Gather all equipment',
            'Check NG tube position has been confirmed'
          ],
          assessment: [
            'Verify tube position confirmed (pH/X-ray)',
            'Note measurement at nostril (cm marking)',
            'Assess skin condition on face/cheek',
            'Check nostril for pressure damage',
            'Ensure tube is patent'
          ],
          interventions: [
            'Apply skin barrier to cheek if needed',
            'Cut tape to appropriate size',
            'Secure tube to cheek (NOT forehead)',
            'Avoid pressure on nostril or nasal septum',
            'Ensure tube follows natural curve',
            'Mark tube at nostril level with marker',
            'Create safety loop to prevent traction',
            'Ensure tape not too tight on skin'
          ],
          communication: [
            'Explain securing method to parent',
            'Teach signs of tube displacement',
            'Discuss importance of checking position before feeds',
            'Advise not to pull or adjust tube themselves'
          ],
          safetyRedFlags: [
            'Pressure on nostril - risk of necrosis',
            'Tube secured to forehead - incorrect technique',
            'Tube measurement changed - possible displacement',
            'Skin breakdown under tape'
          ],
          documentation: [
            'Record tube size (Fr) and type',
            'Document measurement at nostril',
            'Note skin condition',
            'Record confirmation method (pH/X-ray)'
          ]
        },
        tips: [
          'Hydrocolloid base protects delicate infant skin',
          'Change tape when soiled or loose - never wait',
          'Natural curve: tube should not pull against nostril',
          'Check tube position before EVERY feed'
        ],
        warnings: [
          'NEVER tape to forehead - pulls on nostril',
          'Nostril pressure can cause necrosis within hours',
          'Displaced tube + feed = aspiration risk',
          'Always confirm position before use, even if just secured'
        ],
        mnemonics: [
          'NG Safety: Position, pH, Prevent pressure',
          'Before every feed: Check position, Check pH, Check patency'
        ],
        scoring: {
          criticalFails: [
            'Taped to forehead',
            'Pressure on nostril',
            'Did not mark/note measurement at nostril'
          ],
          marks: [
            { item: 'Correct tape placement on cheek', points: 3, domain: 'interventions' },
            { item: 'No pressure on nostril/septum', points: 2, domain: 'interventions' },
            { item: 'Measurement documented', points: 2, domain: 'documentation' },
            { item: 'Parent education completed', points: 1, domain: 'communication' }
          ]
        }
      },
      {
        id: 'lines-3',
        topic: 'lines',
        title: 'Central Line Dressing Change',
        difficulty: 'hard',
        estimatedMinutes: 12,
        candidateInstructions: 'Perform a central venous catheter (CVC) dressing change on a 7-year-old child with a Hickman line. Use aseptic non-touch technique throughout.',
        equipment: ['CVC dressing pack', 'Sterile gloves (2 pairs)', 'Chlorhexidine 2% in alcohol', 'Transparent semipermeable dressing', 'Sterile gauze', 'Steri-strips', 'Face mask', 'Apron', 'Sharps bin', 'Documentation chart'],
        checklist: {
          preparation: [
            'Explain procedure to child and parent',
            'Gain consent/assent',
            'Perform hand hygiene',
            'Put on apron and mask',
            'Create aseptic field',
            'Open dressing pack using ANTT',
            'Apply sterile gloves'
          ],
          assessment: [
            'Assess current dressing condition',
            'Check exit site for signs of infection',
            'Assess surrounding skin integrity',
            'Check line is secured and not kinked',
            'Note any discharge or redness',
            'Check external line length/measurement'
          ],
          interventions: [
            'Remove old dressing carefully',
            'Dispose of gloves and re-apply sterile gloves',
            'Clean site with chlorhexidine 2%',
            'Clean from exit site outward in circular motion',
            'Allow to dry completely (30 seconds minimum)',
            'Do NOT fan or blow to dry',
            'Apply new transparent dressing',
            'Ensure exit site visible',
            'Secure line with steri-strips if needed',
            'Ensure no tension on line'
          ],
          communication: [
            'Keep child informed throughout',
            'Use distraction techniques',
            'Explain findings to parent',
            'Discuss signs of infection to report'
          ],
          safetyRedFlags: [
            'Signs of infection: redness, swelling, discharge, fever',
            'Line displacement - external length changed',
            'Cracked or damaged line - do not use, report immediately',
            'Air embolism risk - keep line clamped when open'
          ],
          documentation: [
            'Record date and time of dressing change',
            'Document exit site condition',
            'Note external line length',
            'Record any concerns or actions taken',
            'Sign CVC care bundle'
          ]
        },
        tips: [
          'ANTT throughout - key fields and key parts',
          'Chlorhexidine must dry for full antimicrobial effect',
          'Schedule dressing changes - every 7 days or when soiled',
          'Two-person technique safer for uncooperative child'
        ],
        warnings: [
          'CVCs are HIGH infection risk - strict asepsis essential',
          'Line sepsis can be fatal - report any concerns immediately',
          'Never use scissors near the line',
          'Cracked line = air embolism risk - clamp proximal to crack'
        ],
        mnemonics: [
          'CVC checks: Exit site, External length, Expiry of dressing',
          'ANTT: Aseptic Non-Touch Technique - protect key parts, key sites'
        ],
        scoring: {
          criticalFails: [
            'Broke aseptic technique',
            'Did not allow chlorhexidine to dry',
            'Exit site not visible after dressing',
            'Failed to identify signs of infection'
          ],
          marks: [
            { item: 'Maintained ANTT throughout', points: 4, domain: 'interventions' },
            { item: 'Correct cleaning technique', points: 2, domain: 'interventions' },
            { item: 'Thorough site assessment', points: 2, domain: 'assessment' },
            { item: 'Complete documentation', points: 2, domain: 'documentation' }
          ]
        }
      },

      // ========== ADDITIONAL HANDWASHING STATIONS ==========
      {
        id: 'hand-2',
        topic: 'handwashing',
        title: 'PPE Donning and Doffing Sequence',
        difficulty: 'medium',
        estimatedMinutes: 8,
        candidateInstructions: 'Demonstrate the correct sequence for putting on (donning) and removing (doffing) PPE for contact precautions. Explain the rationale for the sequence.',
        equipment: ['Disposable apron', 'Non-sterile gloves', 'Fluid-resistant surgical mask', 'Eye protection/visor', 'Hand sanitizer', 'Clinical waste bin'],
        checklist: {
          preparation: [
            'Identify correct PPE for precaution type',
            'Perform hand hygiene before donning',
            'Gather all required PPE',
            'Check PPE for defects/damage',
            'Remove watch and jewellery'
          ],
          assessment: [
            'Assess type of precautions required (contact/droplet/airborne)',
            'Check correct size of gloves',
            'Ensure adequate PPE stock available',
            'Identify waste disposal location'
          ],
          interventions: [
            'DONNING - Apron first',
            'DONNING - Mask second (fit over nose and mouth)',
            'DONNING - Eye protection third',
            'DONNING - Gloves last (over apron cuffs)',
            'Enter patient area',
            'Perform care',
            'DOFFING - Gloves first (most contaminated)',
            'DOFFING - Hand hygiene',
            'DOFFING - Apron second',
            'DOFFING - Hand hygiene',
            'DOFFING - Eye protection third',
            'DOFFING - Mask last (by straps only)',
            'Final hand hygiene'
          ],
          communication: [
            'Explain PPE use to parent',
            'Reassure child about appearance in PPE',
            'Discuss reason for precautions appropriately'
          ],
          safetyRedFlags: [
            'Wrong doffing sequence - self-contamination risk',
            'Touching front of mask when removing',
            'Not performing hand hygiene between steps',
            'Gloves removed after apron - contaminates arms'
          ],
          documentation: [
            'Document precaution type in place',
            'Report any PPE breaches',
            'Note any supply issues'
          ]
        },
        tips: [
          'Donning: AMEG (Apron, Mask, Eyes, Gloves)',
          'Doffing: GHAE+M (Gloves, Hands, Apron, Eyes, Mask) with hand hygiene throughout',
          'Gloves most contaminated - always remove first',
          'Touch only straps/ties when removing mask'
        ],
        warnings: [
          'Self-contamination most common during DOFFING',
          'Mask removal is highest risk - viral load on front surface',
          'Never reuse single-use PPE',
          'Report any PPE breaches immediately'
        ],
        mnemonics: [
          'DON: Apron, Mask, Eyes, Gloves (AMEG)',
          'DOFF: Gloves off, Hands clean, Apron off, Eyes off, Mask off - hands clean between EACH step'
        ],
        scoring: {
          criticalFails: [
            'Gloves removed after apron',
            'Touched front of mask during removal',
            'No hand hygiene between doffing steps'
          ],
          marks: [
            { item: 'Correct donning sequence', points: 2, domain: 'interventions' },
            { item: 'Correct doffing sequence', points: 3, domain: 'interventions' },
            { item: 'Hand hygiene at all required points', points: 3, domain: 'interventions' },
            { item: 'Explained rationale', points: 2, domain: 'communication' }
          ]
        }
      },
      {
        id: 'hand-3',
        topic: 'handwashing',
        title: 'Alcohol Hand Rub Technique',
        difficulty: 'easy',
        estimatedMinutes: 5,
        candidateInstructions: 'Demonstrate the correct technique for using alcohol-based hand rub (ABHR). Explain when ABHR is appropriate and when soap and water must be used instead.',
        equipment: ['Alcohol-based hand rub dispenser', 'Information poster (WHO 5 Moments)', 'Sink with soap (for comparison discussion)'],
        checklist: {
          preparation: [
            'Ensure hands are visibly clean',
            'Remove hand jewellery',
            'Bare below elbows',
            'Check ABHR dispenser has product'
          ],
          assessment: [
            'Confirm hands not visibly soiled',
            'Confirm patient not C.diff or norovirus',
            'Identify this as appropriate WHO moment'
          ],
          interventions: [
            'Apply palm-full of ABHR to cupped hand',
            'Step 1: Rub palms together',
            'Step 2: Right palm over left dorsum and vice versa',
            'Step 3: Palm to palm with fingers interlaced',
            'Step 4: Backs of fingers to opposing palms',
            'Step 5: Rotational rubbing of thumbs',
            'Step 6: Rotational rubbing with clasped fingers in palms',
            'Continue until hands completely dry',
            'Do not wipe or rinse off'
          ],
          communication: [
            'Explain when ABHR is/isn\'t appropriate',
            'Discuss C.diff and norovirus exceptions',
            'Describe WHO 5 Moments to parent'
          ],
          safetyRedFlags: [
            'Using ABHR on visibly soiled hands',
            'Using ABHR for C.diff or norovirus patients',
            'Wiping hands before ABHR is dry',
            'Insufficient volume of ABHR used'
          ],
          documentation: [
            'Participate in hand hygiene audits',
            'Report empty dispensers',
            'Note any skin reactions'
          ]
        },
        tips: [
          'ABHR is faster and more effective than soap for most pathogens',
          'Must use enough product - palm full, not a few drops',
          'Hands must air dry - alcohol needs contact time',
          'Most commonly missed areas: thumbs, fingertips, between fingers'
        ],
        warnings: [
          'ABHR does NOT kill C.diff spores or norovirus',
          'Visibly soiled hands = soap and water mandatory',
          'After caring for vomiting/diarrhoea patient = soap and water',
          'ABHR near flames/oxygen = fire risk'
        ],
        mnemonics: [
          'When to use soap: "If in doubt, wash it out" - visible soil, C.diff, norovirus, after toilet',
          '5 Moments: Before touching, Before clean procedure, After body fluid, After touching, After surroundings'
        ],
        scoring: {
          criticalFails: [
            'Used ABHR on visibly soiled hands',
            'Did not cover all hand surfaces',
            'Wiped hands before dry'
          ],
          marks: [
            { item: 'Correct volume applied', points: 2, domain: 'interventions' },
            { item: 'All 6 steps performed', points: 3, domain: 'interventions' },
            { item: 'Allowed to air dry completely', points: 2, domain: 'interventions' },
            { item: 'Explained exceptions correctly', points: 2, domain: 'communication' }
          ]
        }
      },

      // ========== ADDITIONAL RESPIRATORY STATIONS ==========
      {
        id: 'resp-2',
        topic: 'respiratory',
        title: 'Oxygen Administration via Nasal Cannula',
        difficulty: 'easy',
        estimatedMinutes: 7,
        candidateInstructions: 'Administer oxygen via nasal cannula to a 5-year-old child with SpO2 of 91% on room air. Target SpO2 is ≥94%.',
        equipment: ['Oxygen supply (wall/cylinder)', 'Paediatric nasal cannula', 'Flowmeter', 'Pulse oximeter', 'Humidification (if high flow)', 'Observation chart'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain procedure in simple terms',
            'Check oxygen prescription',
            'Wash hands',
            'Gather equipment and check oxygen supply',
            'Select correct size nasal cannula'
          ],
          assessment: [
            'Assess current respiratory status',
            'Confirm current SpO2 reading',
            'Check nasal patency (not blocked)',
            'Assess work of breathing',
            'Check for contraindications'
          ],
          interventions: [
            'Connect cannula to flowmeter',
            'Set prescribed flow rate (usually 0.5-2L/min for child)',
            'Check oxygen is flowing (feel at prongs)',
            'Position prongs in nostrils (curve downward)',
            'Secure tubing behind ears and under chin',
            'Ensure comfortable fit - not too tight',
            'Monitor SpO2 response',
            'Adjust flow to achieve target SpO2'
          ],
          communication: [
            'Reassure child - explain it helps breathing',
            'Explain to parent why oxygen is needed',
            'Teach parent to monitor for displacement',
            'Explain target SpO2 range'
          ],
          safetyRedFlags: [
            'SpO2 not improving - escalate',
            'Flow rate >2L/min via simple cannula may need humidification',
            'Nasal irritation or bleeding',
            'Child removing cannula repeatedly - consider alternative delivery'
          ],
          documentation: [
            'Record oxygen prescription',
            'Document flow rate and delivery device',
            'Record SpO2 before and after',
            'Note any adverse effects'
          ]
        },
        tips: [
          'Low flow (1-2L/min) suitable for mild hypoxia',
          'Nasal cannula allows eating, drinking, talking',
          'Humidification recommended if >2L/min or prolonged use',
          'Wean oxygen gradually - don\'t stop suddenly'
        ],
        warnings: [
          'Never use oil-based products near oxygen (fire risk)',
          'High flow through simple cannula dries mucosa',
          'Oxygen is a drug - must be prescribed',
          'Over-oxygenation harmful in some conditions (chronic lung disease)'
        ],
        mnemonics: [
          'Oxygen checks: Prescription, Patency, Position, Percentage (SpO2)',
          'Target SpO2: >94% for most, 88-92% for chronic lung disease'
        ],
        scoring: {
          criticalFails: [
            'Did not check prescription',
            'Wrong flow rate set',
            'Did not monitor SpO2 response'
          ],
          marks: [
            { item: 'Correct equipment selection', points: 2, domain: 'preparation' },
            { item: 'Proper cannula positioning', points: 2, domain: 'interventions' },
            { item: 'Monitored SpO2 response', points: 2, domain: 'assessment' },
            { item: 'Clear communication with child/parent', points: 2, domain: 'communication' }
          ]
        }
      },
      {
        id: 'resp-3',
        topic: 'respiratory',
        title: 'Peak Flow Measurement',
        difficulty: 'easy',
        estimatedMinutes: 6,
        candidateInstructions: 'Demonstrate how to measure peak expiratory flow rate (PEFR) on an 8-year-old child with asthma. Explain the technique and interpret a reading.',
        equipment: ['Peak flow meter with disposable mouthpiece', 'Peak flow diary/chart', 'Predicted PEFR chart for age/height', 'Observation chart'],
        checklist: {
          preparation: [
            'Introduce self to child and parent',
            'Explain purpose of peak flow measurement',
            'Wash hands',
            'Attach clean mouthpiece to meter',
            'Reset pointer to zero',
            'Ensure child is standing or sitting upright'
          ],
          assessment: [
            'Check child understands technique',
            'Assess child\'s current respiratory status',
            'Identify child\'s predicted/best PEFR',
            'Note any current symptoms'
          ],
          interventions: [
            'Demonstrate technique first',
            'Ask child to stand or sit up straight',
            'Take a deep breath in (maximum inspiration)',
            'Place mouthpiece in mouth with tight seal',
            'Blast out as hard and fast as possible',
            'Read the number indicated by pointer',
            'Reset and repeat 3 times total',
            'Record the BEST of 3 readings',
            'Compare to predicted/personal best'
          ],
          communication: [
            'Use encouraging language - "blow out birthday candles hard"',
            'Explain what the reading means',
            'Discuss traffic light zones if applicable',
            'Teach when to use peak flow at home'
          ],
          safetyRedFlags: [
            'PEFR <50% predicted = severe - escalate',
            'PEFR <33% predicted = life-threatening',
            'Unable to perform test = severe breathlessness',
            'Declining trend over time'
          ],
          documentation: [
            'Record best of 3 readings',
            'Document as % of predicted/personal best',
            'Note time and any symptoms',
            'Update peak flow chart/diary'
          ]
        },
        tips: [
          'Best of 3 readings - not average',
          'Morning readings typically lower than evening',
          'Personal best more useful than predicted values',
          'Traffic light system: Green >80%, Amber 50-80%, Red <50%'
        ],
        warnings: [
          'Poor technique gives falsely low readings',
          'Do not perform during acute severe attack',
          'Coughing during test invalidates that attempt',
          'Ensure tight lip seal around mouthpiece'
        ],
        mnemonics: [
          'Traffic lights: Green (go, >80%), Amber (caution, 50-80%), Red (danger, <50%)',
          'Technique: Stand tall, Breathe in, Seal lips, Blast out'
        ],
        scoring: {
          criticalFails: [
            'Used average instead of best reading',
            'Did not compare to predicted/personal best',
            'Failed to recognise concerning reading'
          ],
          marks: [
            { item: 'Correct demonstration of technique', points: 3, domain: 'interventions' },
            { item: 'Took best of 3 readings', points: 2, domain: 'interventions' },
            { item: 'Compared to predicted/personal best', points: 2, domain: 'assessment' },
            { item: 'Child-friendly explanation', points: 2, domain: 'communication' }
          ]
        }
      },

      // ========== ADDITIONAL COMMUNICATION STATIONS ==========
      {
        id: 'comm-2',
        topic: 'communication',
        title: 'SBAR Handover',
        difficulty: 'medium',
        estimatedMinutes: 6,
        candidateInstructions: 'You are handing over a deteriorating 4-year-old patient to the senior nurse using SBAR. The child has developed increased work of breathing and falling SpO2.',
        equipment: ['Patient observation chart', 'PEWS chart', 'Medical notes', 'Telephone (if practicing remote handover)'],
        checklist: {
          preparation: [
            'Gather all relevant information before handover',
            'Have observations chart in front of you',
            'Calculate PEWS score if applicable',
            'Know what you are recommending/requesting',
            'Identify yourself and your role'
          ],
          assessment: [
            'Current vital signs to hand',
            'Trend of observations (getting better/worse)',
            'Recent interventions and response',
            'Current clinical status'
          ],
          interventions: [
            'SITUATION: State your name, location, patient name and DOB',
            'SITUATION: "I am calling about... I am concerned because..."',
            'BACKGROUND: Reason for admission, relevant history',
            'BACKGROUND: Recent changes or interventions',
            'ASSESSMENT: Current observations with trends',
            'ASSESSMENT: PEWS score, your clinical concern',
            'RECOMMENDATION: What you need/what you think should happen',
            'RECOMMENDATION: How urgent - when do you need response'
          ],
          communication: [
            'Speak clearly and concisely',
            'State level of urgency clearly',
            'Use closed-loop communication',
            'Confirm understanding and agreed actions',
            'Document conversation and outcomes'
          ],
          safetyRedFlags: [
            'Critical information omitted',
            'Urgency not clearly communicated',
            'No clear recommendation made',
            'Handover not documented'
          ],
          documentation: [
            'Record time of handover',
            'Document who you handed over to',
            'Note agreed actions and timeframe',
            'Record if escalation needed'
          ]
        },
        tips: [
          'Prepare before calling - have all info ready',
          'Lead with your concern - don\'t bury the headline',
          'Be specific: "SpO2 dropped from 98% to 91%" not "sats are low"',
          'If concerned, say "I am worried about this child"'
        ],
        warnings: [
          'Never assume the receiver knows the patient',
          'Don\'t minimize your concerns',
          'If you are worried, escalate even if observations "normal"',
          'Follow up if agreed actions don\'t happen'
        ],
        mnemonics: [
          'SBAR: Situation, Background, Assessment, Recommendation',
          'Situation opener: "I am [name], calling about [patient], I am concerned because..."'
        ],
        scoring: {
          criticalFails: [
            'Patient not correctly identified',
            'No recommendation made',
            'Urgency not communicated',
            'Critical information omitted'
          ],
          marks: [
            { item: 'Clear Situation statement', points: 2, domain: 'communication' },
            { item: 'Relevant Background provided', points: 2, domain: 'communication' },
            { item: 'Accurate Assessment with observations', points: 2, domain: 'communication' },
            { item: 'Clear Recommendation made', points: 2, domain: 'communication' },
            { item: 'Handover documented', points: 1, domain: 'documentation' }
          ]
        }
      },
      {
        id: 'comm-3',
        topic: 'communication',
        title: 'Breaking Bad News with Empathy',
        difficulty: 'hard',
        estimatedMinutes: 10,
        candidateInstructions: 'You need to inform a parent that their 2-year-old child\'s blood test shows they need to stay in hospital for IV antibiotics. The parent was expecting to go home. Deliver this news with empathy.',
        equipment: ['Private room/space', 'Tissues', 'Results/documentation', 'Information leaflet if available'],
        checklist: {
          preparation: [
            'Find a private, quiet space',
            'Ensure you have correct information',
            'Allow adequate time - no rushing',
            'Sit at same level as parent',
            'Minimise interruptions (phone on silent)',
            'Consider if other family member should be present'
          ],
          assessment: [
            'Assess parent\'s current understanding',
            'Gauge emotional state',
            'Ask what they have been told so far',
            'Identify any language or communication needs'
          ],
          interventions: [
            'Give a "warning shot" - "I have the results and I need to discuss them with you"',
            'Deliver news clearly using simple language',
            'Pause - allow information to sink in',
            'Acknowledge and validate emotions',
            'Use empathic statements: "I can see this is upsetting"',
            'Check understanding - "What questions do you have?"',
            'Provide clear plan for what happens next',
            'Offer support and reassurance'
          ],
          communication: [
            'Use clear, jargon-free language',
            'Maintain appropriate eye contact',
            'Use open body language',
            'Listen actively without interrupting',
            'Normalise emotional reactions',
            'Summarise and check understanding'
          ],
          safetyRedFlags: [
            'Parent not understanding information',
            'Extreme emotional distress - may need additional support',
            'Safeguarding concerns arising',
            'Parent wanting to leave against medical advice'
          ],
          documentation: [
            'Record conversation in notes',
            'Document parent\'s understanding',
            'Note any concerns or follow-up needed',
            'Record plan agreed'
          ]
        },
        tips: [
          'Silence is okay - let parent process',
          'Empathy before information - acknowledge emotions first',
          'Avoid false reassurance: "I\'m sure it will be fine"',
          'Ask "What would be most helpful right now?"'
        ],
        warnings: [
          'Never deliver significant news in corridor or public area',
          'Avoid medical jargon - parents may not ask for clarification',
          'Don\'t overload with information - focus on key points',
          'Never appear rushed even if busy'
        ],
        mnemonics: [
          'SPIKES: Setting, Perception, Invitation, Knowledge, Empathy, Summary',
          'Empathic responses: Name emotion, Understand, Respect, Support'
        ],
        scoring: {
          criticalFails: [
            'News delivered in inappropriate setting',
            'No empathy or acknowledgment of emotions',
            'Medical jargon without explanation',
            'Parent understanding not checked'
          ],
          marks: [
            { item: 'Appropriate setting and preparation', points: 2, domain: 'preparation' },
            { item: 'Clear delivery of information', points: 2, domain: 'communication' },
            { item: 'Empathic response to emotions', points: 3, domain: 'communication' },
            { item: 'Checked understanding', points: 2, domain: 'communication' },
            { item: 'Documented conversation', points: 1, domain: 'documentation' }
          ]
        }
      },

      // ========== ADDITIONAL SAFETY STATION ==========
      {
        id: 'safety-3',
        topic: 'safety',
        title: 'Patient Identity Check (3-Point ID)',
        difficulty: 'easy',
        estimatedMinutes: 5,
        candidateInstructions: 'Demonstrate how to correctly verify a patient\'s identity before administering medication using three-point identification. The patient is a 6-year-old child with their parent present.',
        equipment: ['Patient wristband', 'Prescription chart', 'Medication to be given', 'Patient notes'],
        checklist: {
          preparation: [
            'Wash hands',
            'Approach patient and parent',
            'Introduce yourself and explain what you are doing',
            'Have prescription chart ready',
            'Ensure adequate lighting to read wristband'
          ],
          assessment: [
            'Check prescription chart is for correct patient',
            'Verify patient has wristband in place',
            'Assess patient\'s ability to state own details',
            'Note any allergies documented'
          ],
          interventions: [
            'POINT 1: Ask patient/parent to STATE full name',
            'Do NOT ask "Are you John Smith?" (leading question)',
            'Ask open question: "Can you tell me your full name?"',
            'POINT 2: Ask patient/parent to STATE date of birth',
            'POINT 3: Check wristband matches stated details',
            'Cross-reference with prescription chart',
            'Check NHS number if available',
            'Check allergy status on wristband and chart match'
          ],
          communication: [
            'Explain why checking identity is important',
            'Use age-appropriate language with child',
            'Thank patient/parent for confirming details',
            'Never rush or skip steps even if you "know" the patient'
          ],
          safetyRedFlags: [
            'No wristband - do not proceed until applied',
            'Details do not match - stop and investigate',
            'Wristband damaged or illegible - replace first',
            'Patient unable to confirm and no family present - check notes/photo ID'
          ],
          documentation: [
            'Sign prescription to confirm ID check done',
            'Report any identification issues',
            'Document if wristband replaced'
          ]
        },
        tips: [
          'Ask OPEN questions - never suggest the answer',
          'Check wristband on patient, not lying on table',
          'Even familiar patients must be checked every time',
          'Verbal confirmation alone is not sufficient - always check wristband'
        ],
        warnings: [
          'Wrong patient medication errors can be fatal',
          'Children may answer "yes" to any name suggested',
          'Wristbands can be swapped in shared rooms - always verify',
          'Never assume - always check'
        ],
        mnemonics: [
          '3-Point ID: Ask name, Ask DOB, Check wristband',
          'Open questions: WHO are you? WHEN were you born?'
        ],
        scoring: {
          criticalFails: [
            'Asked leading question (e.g., "Are you John?")',
            'Did not check wristband',
            'Proceeded without matching all identifiers',
            'Did not check against prescription'
          ],
          marks: [
            { item: 'Open question for name', points: 2, domain: 'interventions' },
            { item: 'Open question for DOB', points: 2, domain: 'interventions' },
            { item: 'Wristband checked against verbal confirmation', points: 2, domain: 'interventions' },
            { item: 'Cross-referenced with prescription', points: 2, domain: 'interventions' },
            { item: 'Allergy status confirmed', points: 1, domain: 'assessment' }
          ]
        }
      }
    ];

 // ==================== PDF GENERATION FUNCTIONS ====================
    window.downloadQuizResultsPDF = async () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      
      const correctCount = sessionAnswers.filter((answer, idx) => answer === sessionQuestions[idx].correct).length;
      const incorrectCount = sessionQuestions.length - correctCount;
      const percentage = Math.round((correctCount / sessionQuestions.length) * 100);
      
      // Topic analysis
      const topicAnalysis = {};
      sessionQuestions.forEach((q, idx) => {
        if (!topicAnalysis[q.topic]) {
          topicAnalysis[q.topic] = { correct: 0, total: 0 };
        }
        topicAnalysis[q.topic].total++;
        if (sessionAnswers[idx] === q.correct) {
          topicAnalysis[q.topic].correct++;
        }
      });
      
      const topicPerformance = Object.entries(topicAnalysis).map(([topicId, data]) => ({
        topic: topics.find(t => t.id === topicId),
        ...data,
        percentage: Math.round((data.correct / data.total) * 100)
      })).sort((a, b) => a.percentage - b.percentage);
      
      const currentDate = new Date().toLocaleDateString('en-GB', { 
        day: '2-digit', 
        month: 'short', 
        year: 'numeric' 
      });
      
      let yPos = 20;
      
      // Header
      doc.setFillColor(167, 70, 224);
      doc.rect(0, 0, 210, 40, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(24);
      doc.setFont(undefined, 'bold');
      doc.text('Quiz Results', 105, 20, { align: 'center' });
      doc.setFontSize(12);
      doc.setFont(undefined, 'normal');
      doc.text(`Children's Nursing OSCE Revision Tool`, 105, 28, { align: 'center' });
      doc.text(`Date: ${currentDate}`, 105, 34, { align: 'center' });
      
      yPos = 50;
      doc.setTextColor(0, 0, 0);
      
      // Summary Box
      doc.setFillColor(240, 240, 240);
      doc.rect(15, yPos, 180, 40, 'F');
      doc.setDrawColor(167, 70, 224);
      doc.setLineWidth(1);
      doc.rect(15, yPos, 180, 40, 'S');
      
      doc.setFontSize(16);
      doc.setFont(undefined, 'bold');
      doc.text('Performance Summary', 20, yPos + 10);
      
      doc.setFontSize(11);
      doc.setFont(undefined, 'normal');
      doc.text(`Overall Score: ${percentage}%`, 20, yPos + 20);
      doc.text(`Questions: ${sessionQuestions.length}`, 20, yPos + 27);
      doc.text(`Correct: ${correctCount}`, 80, yPos + 20);
      doc.text(`Incorrect: ${incorrectCount}`, 80, yPos + 27);
      
      const grade = percentage >= 80 ? 'Excellent' : percentage >= 50 ? 'Building Momentum' : 'Review Needed';
      doc.setFont(undefined, 'bold');
      doc.text(`Grade: ${grade}`, 140, yPos + 23.5);
      
      yPos += 50;
      
      // Performance by Topic
      doc.setFontSize(14);
      doc.setFont(undefined, 'bold');
      doc.text('Performance by Topic', 15, yPos);
      yPos += 8;
      
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      
      topicPerformance.forEach(tp => {
        if (yPos > 270) {
          doc.addPage();
          yPos = 20;
        }
        
        const barWidth = 150;
        const barHeight = 6;
        const fillWidth = (tp.percentage / 100) * barWidth;
        
        doc.text(`${tp.topic.name}`, 20, yPos);
        doc.text(`${tp.correct}/${tp.total}`, 120, yPos);
        doc.text(`${tp.percentage}%`, 145, yPos);
        
        yPos += 5;
        
        // Progress bar
        doc.setFillColor(220, 220, 220);
        doc.rect(20, yPos - 3, barWidth, barHeight, 'F');
        
        const barColor = tp.percentage >= 75 ? [34, 197, 94] : tp.percentage >= 50 ? [245, 158, 11] : [239, 68, 68];
        doc.setFillColor(...barColor);
        doc.rect(20, yPos - 3, fillWidth, barHeight, 'F');
        
        yPos += 8;
      });
      
      yPos += 5;
      
      // Incorrect Questions
      const incorrectQuestions = sessionQuestions.filter((q, idx) => sessionAnswers[idx] !== q.correct);
      
      if (incorrectQuestions.length > 0) {
        if (yPos > 240) {
          doc.addPage();
          yPos = 20;
        }
        
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text('Questions to Review', 15, yPos);
        yPos += 8;
        
        doc.setFontSize(9);
        doc.setFont(undefined, 'normal');
        
        incorrectQuestions.slice(0, 10).forEach((q, idx) => {
          if (yPos > 260) {
            doc.addPage();
            yPos = 20;
          }
          
          const originalIdx = sessionQuestions.indexOf(q);
          const topic = topics.find(t => t.id === q.topic);
          
          doc.setFont(undefined, 'bold');
          doc.text(`Q${originalIdx + 1}: ${topic?.name || 'Unknown'}`, 20, yPos);
          yPos += 5;
          
          doc.setFont(undefined, 'normal');
          const questionLines = doc.splitTextToSize(q.question, 170);
          doc.text(questionLines, 20, yPos);
          yPos += questionLines.length * 5;
          
          doc.setFont(undefined, 'bold');
          doc.text(`Correct: ${q.options[q.correct]}`, 20, yPos);
          yPos += 5;
          
          doc.setFont(undefined, 'italic');
          const explanationLines = doc.splitTextToSize(q.explanation, 170);
          doc.text(explanationLines, 20, yPos);
          yPos += explanationLines.length * 4 + 5;
        });
        
        if (incorrectQuestions.length > 10) {
          doc.text(`... and ${incorrectQuestions.length - 10} more questions to review`, 20, yPos);
        }
      }
      
      // Footer
      const pageCount = doc.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(8);
        doc.setTextColor(128, 128, 128);
        doc.text(`Page ${i} of ${pageCount}`, 105, 290, { align: 'center' });
        doc.text(`Generated by Children's Nursing OSCE Revision Tool`, 105, 285, { align: 'center' });
      }
      
      doc.save(`Quiz-Results-${currentDate.replace(/ /g, '-')}.pdf`);
    };

    window.downloadOSCEResultsPDF = async () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'mm', 'a4');
      
      let totalItems = 0;
      let totalChecked = 0;
      const stationResults = [];

      sessionStations.forEach(station => {
        const stId = station.id;
        const checklist = currentStationChecklist[stId] || {};
        const allItems = [
          ...station.checklist.preparation,
          ...station.checklist.assessment,
          ...station.checklist.interventions,
          ...station.checklist.communication,
          ...station.checklist.safetyRedFlags,
          ...station.checklist.documentation
        ];
        const checkedCount = Object.values(checklist).filter(v => v).length;
        const percentage = allItems.length > 0 ? Math.round((checkedCount / allItems.length) * 100) : 0;
        
        totalItems += allItems.length;
        totalChecked += checkedCount;
        
        const domainBreakdown = {};
        const domains = ['preparation', 'assessment', 'interventions', 'communication', 'safetyRedFlags', 'documentation'];
        domains.forEach(domain => {
          const items = station.checklist[domain] || [];
          const checked = items.filter(item => checklist[item]).length;
          domainBreakdown[domain] = {
            checked,
            total: items.length,
            percentage: items.length > 0 ? Math.round((checked / items.length) * 100) : 0
          };
        });

        stationResults.push({
          station,
          percentage,
          checkedCount,
          totalCount: allItems.length,
          domainBreakdown,
          isFlagged: flaggedStations.includes(stId)
        });
      });

      const overallPercentage = totalItems > 0 ? Math.round((totalChecked / totalItems) * 100) : 0;
      const grade = overallPercentage >= 90 ? 'Outstanding' : overallPercentage >= 75 ? 'Strong Pass' : overallPercentage >= 60 ? 'Pass' : overallPercentage >= 50 ? 'Borderline' : 'Needs Work';
      
      const currentDate = new Date().toLocaleDateString('en-GB', { 
        day: '2-digit', 
        month: 'short', 
        year: 'numeric' 
      });
      
      let yPos = 20;
      
      // Header
      doc.setFillColor(167, 70, 224);
      doc.rect(0, 0, 210, 40, 'F');
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(24);
      doc.setFont(undefined, 'bold');
      doc.text('OSCE Practice Results', 105, 20, { align: 'center' });
      doc.setFontSize(12);
      doc.setFont(undefined, 'normal');
      doc.text(`Children's Nursing OSCE Revision Tool`, 105, 28, { align: 'center' });
      doc.text(`Date: ${currentDate}`, 105, 34, { align: 'center' });
      
      yPos = 50;
      doc.setTextColor(0, 0, 0);
      
      // Summary Box
      doc.setFillColor(240, 240, 240);
      doc.rect(15, yPos, 180, 40, 'F');
      doc.setDrawColor(167, 70, 224);
      doc.setLineWidth(1);
      doc.rect(15, yPos, 180, 40, 'S');
      
      doc.setFontSize(16);
      doc.setFont(undefined, 'bold');
      doc.text('Performance Summary', 20, yPos + 10);
      
      doc.setFontSize(11);
      doc.setFont(undefined, 'normal');
      doc.text(`Overall: ${overallPercentage}%`, 20, yPos + 20);
      doc.text(`Stations: ${sessionStations.length}`, 20, yPos + 27);
      doc.text(`Completed: ${totalChecked}`, 80, yPos + 20);
      doc.text(`Missed: ${totalItems - totalChecked}`, 80, yPos + 27);
      
      doc.setFont(undefined, 'bold');
      doc.text(`Grade: ${grade}`, 140, yPos + 23.5);
      
      yPos += 50;
      
      // Domain Performance
      const domainLabels = {
        preparation: 'Preparation',
        assessment: 'Assessment',
        interventions: 'Interventions',
        communication: 'Communication',
        safetyRedFlags: 'Safety',
        documentation: 'Documentation'
      };
      
      const overallDomains = {};
      Object.keys(domainLabels).forEach(domain => {
        let domainChecked = 0;
        let domainTotal = 0;
        stationResults.forEach(sr => {
          domainChecked += sr.domainBreakdown[domain].checked;
          domainTotal += sr.domainBreakdown[domain].total;
        });
        overallDomains[domain] = {
          checked: domainChecked,
          total: domainTotal,
          percentage: domainTotal > 0 ? Math.round((domainChecked / domainTotal) * 100) : 0
        };
      });
      
      doc.setFontSize(14);
      doc.setFont(undefined, 'bold');
      doc.text('Performance by Domain', 15, yPos);
      yPos += 8;
      
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      
      Object.entries(overallDomains).forEach(([domain, data]) => {
        if (data.total === 0) return;
        
        if (yPos > 270) {
          doc.addPage();
          yPos = 20;
        }
        
        const barWidth = 130;
        const barHeight = 6;
        const fillWidth = (data.percentage / 100) * barWidth;
        
        doc.text(`${domainLabels[domain]}`, 20, yPos);
        doc.text(`${data.checked}/${data.total}`, 110, yPos);
        doc.text(`${data.percentage}%`, 135, yPos);
        
        yPos += 5;
        
        doc.setFillColor(220, 220, 220);
        doc.rect(20, yPos - 3, barWidth, barHeight, 'F');
        
        const barColor = data.percentage >= 75 ? [34, 197, 94] : data.percentage >= 50 ? [245, 158, 11] : [239, 68, 68];
        doc.setFillColor(...barColor);
        doc.rect(20, yPos - 3, fillWidth, barHeight, 'F');
        
        yPos += 8;
      });
      
      yPos += 5;
      
      // Station Breakdown
      doc.addPage();
      yPos = 20;
      
      doc.setFontSize(14);
      doc.setFont(undefined, 'bold');
      doc.text('Station-by-Station Breakdown', 15, yPos);
      yPos += 10;
      
      doc.setFontSize(10);
      
      stationResults.forEach((sr, idx) => {
        if (yPos > 250) {
          doc.addPage();
          yPos = 20;
        }
        
        const topic = topics.find(t => t.id === sr.station.topic);
        
        doc.setFont(undefined, 'bold');
        doc.text(`Station ${idx + 1}: ${sr.station.title}`, 20, yPos);
        yPos += 5;
        
        doc.setFont(undefined, 'normal');
        doc.setFontSize(9);
        doc.text(`${topic?.name || 'Unknown'} • ${sr.station.difficulty} • ${sr.station.estimatedMinutes} min`, 20, yPos);
        yPos += 5;
        
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        const scoreColor = sr.percentage >= 75 ? [34, 197, 94] : sr.percentage >= 50 ? [245, 158, 11] : [239, 68, 68];
        doc.setTextColor(...scoreColor);
        doc.text(`${sr.percentage}% (${sr.checkedCount}/${sr.totalCount})`, 160, yPos - 5);
        doc.setTextColor(0, 0, 0);
        
        yPos += 3;
        
        // Domain bars
        doc.setFont(undefined, 'normal');
        doc.setFontSize(8);
        Object.entries(sr.domainBreakdown).forEach(([domain, data]) => {
          if (data.total === 0) return;
          
          const miniBarWidth = 40;
          const miniBarHeight = 3;
          const miniFillWidth = (data.percentage / 100) * miniBarWidth;
          
          doc.text(domainLabels[domain].substring(0, 10), 20, yPos);
          doc.setFillColor(220, 220, 220);
          doc.rect(55, yPos - 2, miniBarWidth, miniBarHeight, 'F');
          
          const miniBarColor = data.percentage >= 75 ? [34, 197, 94] : data.percentage >= 50 ? [245, 158, 11] : [239, 68, 68];
          doc.setFillColor(...miniBarColor);
          doc.rect(55, yPos - 2, miniFillWidth, miniBarHeight, 'F');
          
          doc.text(`${data.percentage}%`, 98, yPos);
          yPos += 5;
        });
        
        yPos += 5;
        doc.setDrawColor(200, 200, 200);
        doc.line(20, yPos, 190, yPos);
        yPos += 8;
      });
      
      // Footer
      const pageCount = doc.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(8);
        doc.setTextColor(128, 128, 128);
        doc.text(`Page ${i} of ${pageCount}`, 105, 290, { align: 'center' });
        doc.text(`Generated by Children's Nursing OSCE Revision Tool`, 105, 285, { align: 'center' });
      }
      
      doc.save(`OSCE-Results-${currentDate.replace(/ /g, '-')}.pdf`);
    };

  // ==================== UTILITY FUNCTIONS ====================
    // (Note: shuffleArray and createParticles were in Part 1, ensuring we don't duplicate or miss them)
    
    // ==================== RENDER FUNCTIONS ====================
    function render() {
      const container = document.getElementById('main-content');
      
      switch(currentView) {
        case 'selection':
          renderSelection(container);
          break;
        case 'quiz':
          renderQuiz(container);
          break;
        case 'quizResults':
          renderQuizResults(container);
          break;
        case 'osce':
          renderOSCE(container);
          break;
        case 'osceResults':
          renderOSCEResults(container);
          break;
        default:
          container.innerHTML = `
            <div class="fade-in max-w-4xl mx-auto text-center">
              <h1 class="text-4xl text-white font-bold mb-4">Coming Soon</h1>
              <p class="text-slate-300 mb-8">Full functionality being implemented</p>
              <button onclick="currentView='selection'; render();" class="btn-gradient px-8 py-3 rounded-xl text-white">
                Back to Selection
              </button>
            </div>
          `;
      }
      
      if (window.lucide) {
        window.lucide.createIcons();
      }
    }

    function renderQuiz(container) {
      const currentQuestion = sessionQuestions[currentIndex];
      const answered = sessionAnswers[currentIndex] !== null;
      const isCorrect = answered && sessionAnswers[currentIndex] === currentQuestion.correct;
      
      container.innerHTML = `
        <div class="fade-in max-w-4xl mx-auto">
          <div class="glass-card rounded-2xl p-8 mb-6">
            <div class="flex items-center justify-between mb-6">
              <button onclick="exitToSelection()" class="btn-secondary px-4 py-2 rounded-lg text-white text-sm">
                <i data-lucide="arrow-left" class="w-4 h-4 inline mr-1"></i>
                Exit Quiz
              </button>
              <div class="text-white text-sm mono">
                Question ${currentIndex + 1} / ${sessionQuestions.length}
              </div>
            </div>
            
            <div class="mb-8">
              <div class="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style="background: ${topics.find(t => t.id === currentQuestion.topic)?.color}22; color: ${topics.find(t => t.id === currentQuestion.topic)?.color};">
                ${topics.find(t => t.id === currentQuestion.topic)?.name}
              </div>
              <h2 class="text-2xl text-white font-bold mb-6">${currentQuestion.question}</h2>
            </div>
            
            <div class="space-y-3 mb-8">
              ${currentQuestion.options.map((option, idx) => {
                const isSelected = sessionAnswers[currentIndex] === idx;
                const showCorrect = answered && idx === currentQuestion.correct;
                const showIncorrect = answered && isSelected && idx !== currentQuestion.correct;
                
                return `
                  <button 
                    onclick="answerQuestion(${idx})" 
                    ${answered ? 'disabled' : ''}
                    class="w-full p-4 rounded-xl text-left transition-all ${
                      showCorrect ? 'bg-green-500 bg-opacity-20 border-2 border-green-500' :
                      showIncorrect ? 'bg-red-500 bg-opacity-20 border-2 border-red-500' :
                      isSelected ? 'bg-purple-500 bg-opacity-20 border-2 border-purple-500' :
                      'bg-white bg-opacity-5 border-2 border-transparent hover:border-purple-400'
                    }"
                    ${answered ? '' : 'style="cursor: pointer;"'}
                  >
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 rounded-full flex items-center justify-center ${
                        showCorrect ? 'bg-green-500' :
                        showIncorrect ? 'bg-red-500' :
                        isSelected ? 'bg-purple-500' :
                        'bg-white bg-opacity-10'
                      }">
                        ${showCorrect ? '<i data-lucide="check" class="w-5 h-5 text-white"></i>' :
                          showIncorrect ? '<i data-lucide="x" class="w-5 h-5 text-white"></i>' :
                          `<span class="text-white font-semibold">${String.fromCharCode(65 + idx)}</span>`
                        }
                      </div>
                      <span class="text-white text-lg">${option}</span>
                    </div>
                  </button>
                `;
              }).join('')}
            </div>
            
            ${answered ? `
              <div class="glass-card p-6 rounded-xl mb-6">
                <div class="flex items-start gap-3">
                  <i data-lucide="lightbulb" class="w-6 h-6 ${isCorrect ? 'text-green-400' : 'text-yellow-400'} flex-shrink-0"></i>
                  <div>
                    <h3 class="text-white font-bold mb-2">${isCorrect ? 'Correct!' : 'Explanation'}</h3>
                    <p class="text-slate-300">${currentQuestion.explanation}</p>
                  </div>
                </div>
              </div>
            ` : ''}
            
            <div class="flex justify-between items-center">
              <button 
                onclick="previousQuestion()" 
                ${currentIndex === 0 ? 'disabled' : ''}
                class="btn-secondary px-6 py-3 rounded-xl text-white disabled:opacity-30"
              >
                <i data-lucide="chevron-left" class="w-5 h-5 inline mr-1"></i>
                Previous
              </button>
              
              ${currentIndex === sessionQuestions.length - 1 ? `
                <button 
                  onclick="finishQuiz()" 
                  class="btn-gradient px-8 py-3 rounded-xl text-white font-bold"
                >
                  Finish Quiz
                  <i data-lucide="flag" class="w-5 h-5 inline ml-2"></i>
                </button>
              ` : `
                <button 
                  onclick="nextQuestion()" 
                  class="btn-gradient px-6 py-3 rounded-xl text-white"
                >
                  Next
                  <i data-lucide="chevron-right" class="w-5 h-5 inline ml-1"></i>
                </button>
              `}
            </div>
          </div>
          
          <div class="glass-card rounded-xl p-4">
            <div class="flex items-center gap-2 mb-2">
              <i data-lucide="list-checks" class="w-4 h-4 text-slate-400"></i>
              <span class="text-slate-400 text-sm">Progress</span>
            </div>
            <div class="flex gap-1">
              ${sessionQuestions.map((_, idx) => `
                <div class="flex-1 h-2 rounded-full ${
                  sessionAnswers[idx] !== null ? 'bg-purple-500' : 'bg-white bg-opacity-10'
                }"></div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }
    
   function renderQuizResults(container) {
  // ---------- SAFE HELPERS ----------
  const safe = (str) => String(str ?? '')
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;')
    .replaceAll('"', '&quot;')
    .replaceAll("'", '&#039;');

  // Ensure flaggedQuestions exists (your file didn’t have it before)
  window.flaggedQuestions = Array.isArray(window.flaggedQuestions) ? window.flaggedQuestions : [];
  const flaggedQuestions = window.flaggedQuestions;

  // Protect against missing data
  const totalQ = Array.isArray(sessionQuestions) ? sessionQuestions.length : 0;
  const answers = Array.isArray(sessionAnswers) ? sessionAnswers : [];
  const questions = Array.isArray(sessionQuestions) ? sessionQuestions : [];

  const correctCount = questions.reduce((acc, q, idx) => {
    const a = answers[idx];
    return acc + ((a !== null && a !== undefined && a === q.correct) ? 1 : 0);
  }, 0);

  const incorrectCount = totalQ - correctCount;
  const percentage = totalQ ? Math.round((correctCount / totalQ) * 100) : 0;

  // Optional timer support (won’t crash if you don’t track it)
  const totalSeconds = Number(window.quizTimeSeconds || 0);
  const timeLabel = totalSeconds > 0
    ? `${String(Math.floor(totalSeconds / 60)).padStart(2, '0')}:${String(totalSeconds % 60).padStart(2, '0')}`
    : '--:--';
  const avgPace = totalQ && totalSeconds > 0 ? Math.round(totalSeconds / totalQ) : 0;

  // ---------- TOPIC PERFORMANCE ----------
  const topicAnalysis = {};
  questions.forEach((q, idx) => {
    const t = q.topic || 'unknown';
    if (!topicAnalysis[t]) topicAnalysis[t] = { correct: 0, total: 0 };
    topicAnalysis[t].total++;

    const a = answers[idx];
    if (a !== null && a !== undefined && a === q.correct) topicAnalysis[t].correct++;
  });

  const topicPerformance = Object.entries(topicAnalysis)
    .map(([topicId, data]) => {
      const topic = topics.find(t => t.id === topicId) || { id: topicId, name: topicId.toUpperCase(), color: '#a855f7', icon: 'tag' };
      const pct = data.total ? Math.round((data.correct / data.total) * 100) : 0;
      return { topicId, topic, ...data, percentage: pct };
    })
    .sort((a, b) => a.percentage - b.percentage);

  const weakTopics = topicPerformance.filter(t => t.total > 0 && t.percentage < 75);
  const weakest = weakTopics[0];

  // ---------- GRADE ----------
  let grade = 'Review Needed';
  let gradeColor = '#ef4444';
  let gradeIcon = 'book-open';
  let gradeMessage = 'Every quiz builds stronger knowledge. Focus on the areas below.';

  if (percentage >= 90) {
    grade = 'Outstanding'; gradeColor = '#22c55e'; gradeIcon = 'trophy';
    gradeMessage = 'Exceptional work — your knowledge is exam-ready.';
  } else if (percentage >= 75) {
    grade = 'Strong Pass'; gradeColor = '#84cc16'; gradeIcon = 'check-circle';
    gradeMessage = 'Great performance — a few tweaks and you’re at mastery level.';
  } else if (percentage >= 60) {
    grade = 'Pass'; gradeColor = '#f59e0b'; gradeIcon = 'trending-up';
    gradeMessage = 'Solid foundation — target your weaker topics to improve quickly.';
  } else if (percentage >= 50) {
    grade = 'Borderline'; gradeColor = '#f97316'; gradeIcon = 'alert-circle';
    gradeMessage = 'You’re close — focus revision on the weakest topic first.';
  }

  // ---------- INSIGHTS ----------
  const insights = [];
  if (weakest) {
    insights.push({
      icon: 'target',
      color: '#f59e0b',
      title: 'Focus Area',
      text: `${safe(weakest.topic.name)}: ${weakest.correct}/${weakest.total} correct (${weakest.percentage}%). Prioritize revision here.`
    });
  }
  if (incorrectCount > 0) {
    insights.push({
      icon: 'arrow-right',
      color: '#a855f7',
      title: 'Next Best Action',
      text: `Review the ${incorrectCount} incorrect answer${incorrectCount !== 1 ? 's' : ''} below—small gaps, easy wins!`
    });
  }

  // ---------- REVIEW LISTS ----------
  const incorrectIdxs = questions
    .map((q, idx) => ({ q, idx }))
    .filter(({ q, idx }) => {
      const a = answers[idx];
      return a === null || a === undefined || a !== q.correct;
    });

  const flaggedSet = new Set(flaggedQuestions.map(Number).filter(Number.isFinite));

  window.__quizReviewFilter = window.__quizReviewFilter || 'all'; // 'all' | 'incorrect' | 'flagged'

  const getReviewList = () => {
    if (window.__quizReviewFilter === 'incorrect') return incorrectIdxs;
    if (window.__quizReviewFilter === 'flagged') {
      return questions.map((q, idx) => ({ q, idx })).filter(({ idx }) => flaggedSet.has(idx));
    }
    return questions.map((q, idx) => ({ q, idx }));
  };

  const reviewList = getReviewList();

  // ---------- ACTIONS ----------
  window.setQuizReviewFilter = (filter) => { window.__quizReviewFilter = filter; render(); };

  window.scrollToQuizReview = () => {
    const el = document.getElementById('quiz-review');
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  };

  window.toggleFlagQuestion = (idx) => {
    const i = Number(idx);
    if (!Number.isFinite(i)) return;
    const pos = flaggedQuestions.indexOf(i);
    if (pos > -1) flaggedQuestions.splice(pos, 1);
    else flaggedQuestions.push(i);
    render();
  };

  window.tryAnotherQuiz = () => {
    currentView = 'selection';
    sessionQuestions = [];
    sessionAnswers = [];
    currentIndex = 0;
    window.quizTimeSeconds = 0;
    flaggedQuestions.length = 0;
    render();
  };

  // ---------- EXTRA PANELS (What you asked for) ----------
  const whatToWorkOnNext = weakest
    ? `Focus revision on <strong>${safe(weakest.topic.name)}</strong> (${weakest.percentage}% accuracy).`
    : 'Pick one topic and re-try a short set to build momentum.';

  const personalPlanTopicBullets = weakest
    ? `<li class="flex items-start gap-2"><span class="text-purple-400 font-bold flex-shrink-0">•</span><span><strong>${safe(weakest.topic.name)}:</strong> Focus on ${weakest.total - weakest.correct} missed question${(weakest.total - weakest.correct) !== 1 ? 's' : ''} — review explanations thoroughly</span></li>`
    : `<li class="flex items-start gap-2"><span class="text-purple-400 font-bold flex-shrink-0">•</span><span><strong>Keep going:</strong> Re-test a small set daily to build retention</span></li>`;

  // ---------- UI ----------
  container.innerHTML = `
    <div class="fade-in max-w-6xl mx-auto">

      <!-- HERO -->
      <div class="glass-card rounded-3xl p-8 md:p-12 text-center mb-8 relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
          <div class="absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full blur-3xl"></div>
          <div class="absolute bottom-0 right-0 w-64 h-64 bg-gradient-to-tl from-cyan-400 to-purple-400 rounded-full blur-3xl"></div>
        </div>

        <div class="relative z-10">
          <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full mb-6 ${grade === 'Review Needed' ? 'pulse-red-badge' : ''}" style="background:${gradeColor}22; border:2px solid ${gradeColor};">
            <i data-lucide="${gradeIcon}" class="w-5 h-5" style="color:${gradeColor};"></i>
            <span class="font-bold text-sm" style="color:${gradeColor};">${grade}</span>
          </div>

          <h1 class="text-5xl md:text-6xl font-extrabold text-white mb-4 tracking-tight">Quiz Complete!</h1>
          <p class="text-xl text-slate-300 max-w-2xl mx-auto">${gradeMessage}</p>
        </div>
      </div>

      <!-- KPI ROW -->
      <div class="grid grid-cols-2 md:grid-cols-6 gap-4 mb-8">
        <div class="glass-card rounded-2xl p-5 hover:scale-105 transition-transform">
          <i data-lucide="percent" class="w-5 h-5 text-purple-400 mb-2"></i>
          <div class="text-3xl font-extrabold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent mb-1">${percentage}%</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Accuracy</div>
        </div>

        <div class="glass-card rounded-2xl p-5 hover:scale-105 transition-transform">
          <i data-lucide="check-circle" class="w-5 h-5 text-green-400 mb-2"></i>
          <div class="text-3xl font-extrabold text-green-400 mb-1">${correctCount}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Correct</div>
        </div>

        <div class="glass-card rounded-2xl p-5 hover:scale-105 transition-transform">
          <i data-lucide="x-circle" class="w-5 h-5 text-red-400 mb-2"></i>
          <div class="text-3xl font-extrabold text-red-400 mb-1">${incorrectCount}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Incorrect</div>
        </div>

        <div class="glass-card rounded-2xl p-5 hover:scale-105 transition-transform">
          <i data-lucide="clock" class="w-5 h-5 text-cyan-400 mb-2"></i>
          <div class="text-3xl font-extrabold text-cyan-400 mb-1">${timeLabel}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Time</div>
        </div>

        <div class="glass-card rounded-2xl p-5 hover:scale-105 transition-transform">
          <i data-lucide="zap" class="w-5 h-5 text-yellow-400 mb-2"></i>
          <div class="text-3xl font-extrabold text-yellow-400 mb-1">${avgPace ? `${avgPace}s` : '—'}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Avg Pace</div>
        </div>

        <div class="glass-card rounded-2xl p-5 hover:scale-105 transition-transform">
          <i data-lucide="flag" class="w-5 h-5 text-pink-400 mb-2"></i>
          <div class="text-3xl font-extrabold text-pink-400 mb-1">${flaggedQuestions.length}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Flagged</div>
        </div>
      </div>

      <!-- SMART INSIGHTS -->
      ${insights.length ? `
        <div class="glass-card rounded-2xl p-8 mb-8">
          <h2 class="text-white text-2xl font-bold mb-6 flex items-center gap-3">
            <i data-lucide="brain" class="w-7 h-7 text-pink-400"></i>
            Smart Insights
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${insights.map(ins => `
              <div class="p-4 rounded-xl border-2 transition-all hover:scale-105" style="background:${ins.color}11; border-color:${ins.color}33;">
                <div class="flex items-start gap-3">
                  <div class="p-2 rounded-lg" style="background:${ins.color}22;">
                    <i data-lucide="${ins.icon}" class="w-5 h-5" style="color:${ins.color};"></i>
                  </div>
                  <div class="flex-1">
                    <h4 class="text-white font-bold mb-1">${ins.title}</h4>
                    <p class="text-slate-300 text-sm leading-relaxed">${ins.text}</p>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      ` : ''}

      <!-- PERFORMANCE BY TOPIC -->
      <div class="glass-card rounded-2xl p-8 mb-8">
        <h2 class="text-white text-2xl font-bold mb-6 flex items-center gap-3">
          <i data-lucide="bar-chart-3" class="w-7 h-7 text-purple-400"></i>
          Performance by Topic
        </h2>

        <div class="space-y-4">
          ${topicPerformance.map(tp => {
            const isPriority = tp.percentage < 75 && tp.total > 0;
            const color = tp.topic.color || '#a855f7';
            return `
              <div class="p-4 rounded-xl ${isPriority ? 'bg-orange-500 bg-opacity-10 border-2 border-orange-500 border-opacity-30' : 'bg-white bg-opacity-5'}">
                <div class="flex items-center justify-between mb-3">
                  <div class="flex items-center gap-3">
                    <div class="p-2 rounded-lg" style="background:${color}22;">
                      <i data-lucide="${tp.topic.icon || 'tag'}" class="w-5 h-5" style="color:${color};"></i>
                    </div>
                    <div>
                      <div class="flex items-center gap-2">
                        <span class="text-white font-semibold">${safe(tp.topic.name)}</span>
                        ${isPriority ? '<span class="px-2 py-0.5 bg-orange-500 text-white text-xs font-bold rounded-full">PRIORITY</span>' : ''}
                      </div>
                      <span class="text-slate-400 text-sm">${tp.correct}/${tp.total} correct</span>
                    </div>
                  </div>
                  <div class="text-2xl font-bold ${tp.percentage >= 75 ? 'text-green-400' : tp.percentage >= 50 ? 'text-yellow-400' : 'text-red-400'}">${tp.percentage}%</div>
                </div>
                <div class="w-full bg-white bg-opacity-5 rounded-full h-3 overflow-hidden">
                  <div class="h-3 rounded-full transition-all duration-1000 ease-out" style="width:${tp.percentage}%; background:linear-gradient(90deg, ${color}, ${tp.percentage >= 75 ? '#22c55e' : tp.percentage >= 50 ? '#f59e0b' : '#ef4444'});"></div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </div>

      <!-- WHAT YOU DID WELL + WHAT NEXT -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="glass-card rounded-2xl p-6 border-2 border-green-500 border-opacity-30">
          <h3 class="text-white text-xl font-bold mb-4 flex items-center gap-2">
            <i data-lucide="thumbs-up" class="w-6 h-6 text-green-400"></i>
            What You Did Well
          </h3>
          <ul class="space-y-3">
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="check" class="w-4 h-4 text-green-400 mt-0.5"></i>
              <span>You completed the session — this is active retrieval practice strengthening your memory!</span>
            </li>
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="check" class="w-4 h-4 text-green-400 mt-0.5"></i>
              <span>You reviewed multiple topics — the best way to build exam stamina.</span>
            </li>
          </ul>
        </div>

        <div class="glass-card rounded-2xl p-6 border-2 border-orange-500 border-opacity-30">
          <h3 class="text-white text-xl font-bold mb-4 flex items-center gap-2">
            <i data-lucide="alert-circle" class="w-6 h-6 text-orange-400"></i>
            What to Work On Next
          </h3>
          <ul class="space-y-3">
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="target" class="w-4 h-4 text-pink-400 mt-0.5"></i>
              <span>${whatToWorkOnNext}</span>
            </li>
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="book-open" class="w-4 h-4 text-purple-400 mt-0.5"></i>
              <span>Review all <strong>${incorrectCount}</strong> incorrect answer${incorrectCount !== 1 ? 's' : ''} — focus on understanding <em>why</em>, not memorising.</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- PERSONALIZED STUDY PLAN -->
      <div class="glass-card rounded-2xl p-8 mb-8 border-2 border-purple-500 border-opacity-30">
        <h2 class="text-white text-2xl font-bold mb-6 flex items-center gap-3">
          <i data-lucide="map" class="w-7 h-7 text-purple-400"></i>
          Your Personalized Study Plan
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="text-purple-300 font-bold mb-4 flex items-center gap-2">
              <i data-lucide="zap" class="w-5 h-5"></i>
              Priority Study Topics
            </h4>
            <ul class="space-y-3 text-slate-300 text-sm">
              ${personalPlanTopicBullets}
            </ul>
          </div>

          <div>
            <h4 class="text-pink-300 font-bold mb-4 flex items-center gap-2">
              <i data-lucide="calendar-check" class="w-5 h-5"></i>
              Your Revision Strategy
            </h4>
            <ul class="space-y-3 text-slate-300 text-sm">
              <li class="flex items-start gap-2"><span class="text-pink-400 font-bold flex-shrink-0">•</span><span><strong>Daily practice:</strong> Tackle 5–10 questions per day on your weakest topic until comfortable</span></li>
              <li class="flex items-start gap-2"><span class="text-pink-400 font-bold flex-shrink-0">•</span><span><strong>Review mistakes:</strong> Spend 2× longer reviewing incorrect answers than taking the quiz</span></li>
              <li class="flex items-start gap-2"><span class="text-pink-400 font-bold flex-shrink-0">•</span><span><strong>Track trends:</strong> Re-take weekly to measure improvement</span></li>
              <li class="flex items-start gap-2"><span class="text-pink-400 font-bold flex-shrink-0">•</span><span><strong>Teach others:</strong> Explaining concepts to peers solidifies understanding</span></li>
            </ul>
          </div>
        </div>
      </div>
      <!-- ESSENTIAL MED FORMULAS -->
      <div class="glass-card rounded-2xl p-8 mb-8">
        <h2 class="text-white text-2xl font-bold mb-2 flex items-center gap-3">
          <i data-lucide="calculator" class="w-7 h-7 text-pink-400"></i>
          Essential Medication Formulas to Revise
        </h2>
        <p class="text-slate-300 text-sm mb-6">
          Master these formulas for safe medication administration. In clinical practice, always double-check calculations and have a second registered nurse verify high-risk drug doses.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div class="rounded-2xl p-6" style="background: linear-gradient(135deg, rgba(236,72,153,.35), rgba(168,85,247,.25)); border: 1px solid rgba(255,255,255,.12);">
            <div class="text-white font-bold mb-2 flex items-center gap-2"><i data-lucide="scale" class="w-5 h-5"></i>Weight-Based Dosing</div>
            <div class="bg-black bg-opacity-20 rounded-lg p-3 text-slate-100 mono text-sm mb-3">Dose (mg) = Weight (kg) × mg/kg</div>
            <ul class="text-slate-100 text-sm space-y-1">
              <li>• Example: Child weighs 25kg, prescribed 10mg/kg paracetamol → <strong>250mg</strong></li>
              <li>• Critical check: Always verify dose is within safe range in <strong>BNFc</strong></li>
            </ul>
          </div>

          <div class="rounded-2xl p-6" style="background: linear-gradient(135deg, rgba(99,102,241,.35), rgba(34,211,238,.25)); border: 1px solid rgba(255,255,255,.12);">
            <div class="text-white font-bold mb-2 flex items-center gap-2"><i data-lucide="droplet" class="w-5 h-5"></i>Volume Calculation</div>
            <div class="bg-black bg-opacity-20 rounded-lg p-3 text-slate-100 mono text-sm mb-3">Volume = (Dose Required ÷ Stock Strength) × Stock Volume</div>
            <ul class="text-slate-100 text-sm space-y-1">
              <li>• Example: Need 250mg, stock is 100mg/5ml → <strong>12.5ml</strong></li>
              <li>• Memory aid: “What you want ÷ what you’ve got × volume it’s in”</li>
            </ul>
          </div>

          <div class="rounded-2xl p-6" style="background: linear-gradient(135deg, rgba(20,184,166,.35), rgba(34,197,94,.25)); border: 1px solid rgba(255,255,255,.12);">
            <div class="text-white font-bold mb-2 flex items-center gap-2"><i data-lucide="activity" class="w-5 h-5"></i>IV Infusion Rate</div>
            <div class="bg-black bg-opacity-20 rounded-lg p-3 text-slate-100 mono text-sm mb-3">Rate (ml/hr) = Volume (ml) ÷ Time (hours)</div>
            <ul class="text-slate-100 text-sm space-y-1">
              <li>• Example: Infuse 500ml over 4 hours → <strong>125ml/hr</strong></li>
              <li>• Sense-check: Does the rate make sense? Not too fast/slow?</li>
            </ul>
          </div>

          <div class="rounded-2xl p-6" style="background: linear-gradient(135deg, rgba(132,204,22,.35), rgba(234,179,8,.25)); border: 1px solid rgba(255,255,255,.12);">
            <div class="text-white font-bold mb-2 flex items-center gap-2"><i data-lucide="percent" class="w-5 h-5"></i>Percentage Strength</div>
            <div class="bg-black bg-opacity-20 rounded-lg p-3 text-slate-100 mono text-sm mb-3">X% = X grams per 100ml (or X mg per 1ml)</div>
            <ul class="text-slate-100 text-sm space-y-1">
              <li>• Example: 0.9% sodium chloride → 0.9g/100ml → <strong>9mg per ml</strong></li>
              <li>• Common use: Fluid concentrations, local anaesthetics</li>
            </ul>
          </div>
        </div>

        <div class="bg-red-500 bg-opacity-10 border border-red-500 border-opacity-30 rounded-xl p-5">
          <div class="text-red-200 font-bold mb-2 flex items-center gap-2"><i data-lucide="shield-alert" class="w-5 h-5"></i>Critical Safety Checks</div>
          <ul class="text-red-100 text-sm space-y-1">
            <li>• Write it down: Never do calculations mentally — always write them out</li>
            <li>• Check units: mg vs g, ml vs L — decimal errors cause 10-fold mistakes</li>
            <li>• Verify weight: Always use actual documented weight, never estimate</li>
            <li>• Second check: High-risk drugs require independent double-check</li>
            <li>• Sense check: Is the dose realistic? Does volume seem reasonable?</li>
            <li>• BNFc check: Confirm dose is within safe range for age and weight</li>
          </ul>
        </div>
      </div>



      <!-- QUESTION REVIEW -->
      <div id="quiz-review" class="glass-card rounded-2xl p-8 mb-8">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
          <h2 class="text-white text-2xl font-bold flex items-center gap-3">
            <i data-lucide="list-checks" class="w-7 h-7 text-cyan-400"></i>
            Question Review
          </h2>

          <div class="flex gap-2">
            <button onclick="setQuizReviewFilter('all')" class="btn-secondary px-4 py-2 rounded-lg text-sm text-white ${window.__quizReviewFilter === 'all' ? 'border border-purple-400' : ''}">All (${totalQ})</button>
            <button onclick="setQuizReviewFilter('incorrect')" class="btn-secondary px-4 py-2 rounded-lg text-sm text-white ${window.__quizReviewFilter === 'incorrect' ? 'border border-purple-400' : ''}">Incorrect (${incorrectCount})</button>
            <button onclick="setQuizReviewFilter('flagged')" class="btn-secondary px-4 py-2 rounded-lg text-sm text-white ${window.__quizReviewFilter === 'flagged' ? 'border border-purple-400' : ''}">Flagged (${flaggedQuestions.length})</button>
          </div>
        </div>

        <div class="space-y-4">
          ${reviewList.map(({ q, idx }) => {
            const userAns = answers[idx];
            const isCorrect = (userAns !== null && userAns !== undefined && userAns === q.correct);
            const topic = topics.find(t => t.id === q.topic) || { name: q.topic || 'Topic', color: '#a855f7' };
            const isFlagged = flaggedSet.has(idx);

            return `
              <div class="rounded-xl border-2 ${isCorrect ? 'border-green-500 border-opacity-25' : 'border-red-500 border-opacity-35'} bg-white bg-opacity-5 overflow-hidden">
                <div class="p-4 flex items-start justify-between gap-4">
                  <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-lg flex items-center justify-center ${isCorrect ? 'bg-green-500 bg-opacity-20' : 'bg-red-500 bg-opacity-20'}">
                      <i data-lucide="${isCorrect ? 'check' : 'x'}" class="w-5 h-5 ${isCorrect ? 'text-green-400' : 'text-red-400'}"></i>
                    </div>

                    <div>
                      <div class="flex items-center gap-2 mb-1">
                        <span class="text-white font-bold">Question ${idx + 1}</span>
                        <span class="text-xs px-2 py-0.5 rounded-full" style="background:${topic.color}22; color:${topic.color};">${safe(topic.name)}</span>
                      </div>
                      <div class="text-slate-200 text-sm">${safe(q.question)}</div>
                    </div>
                  </div>

                  <button onclick="toggleFlagQuestion(${idx})" class="btn-secondary px-3 py-2 rounded-lg text-white text-xs">
                    <i data-lucide="flag" class="w-4 h-4 inline mr-1 ${isFlagged ? 'text-yellow-400 fill-yellow-400' : ''}"></i>
                    ${isFlagged ? 'Flagged' : 'Flag'}
                  </button>
                </div>

                <div class="px-4 pb-4">
                  <div class="bg-white bg-opacity-5 rounded-lg p-4">
                    <div class="text-xs text-slate-400 mb-2">Correct answer:</div>
                    <div class="text-green-300 font-semibold text-sm mb-3">${safe(q.options?.[q.correct])}</div>

                    ${!isCorrect ? `
                      <div class="text-xs text-slate-400 mb-2">Your answer:</div>
                      <div class="text-red-300 font-semibold text-sm mb-3">${safe(q.options?.[userAns])}</div>
                    ` : ''}

                    <div class="text-xs text-slate-400 mb-2">Explanation:</div>
                    <div class="text-slate-200 text-sm leading-relaxed">${safe(q.explanation || '—')}</div>
                  </div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </div>

      <!-- ACTION BUTTONS -->
      <div class="flex flex-wrap gap-4 justify-center pb-10">
        <button onclick="downloadQuizResultsPDF()" class="btn-secondary px-10 py-4 rounded-xl text-white font-semibold text-lg hover:scale-105 transition-transform">
          <i data-lucide="download" class="w-6 h-6 inline mr-2"></i>
          Download PDF
        </button>
        <button onclick="scrollToQuizReview()" class="btn-secondary px-10 py-4 rounded-xl text-white font-semibold text-lg hover:scale-105 transition-transform">
          <i data-lucide="eye" class="w-6 h-6 inline mr-2"></i>
          Review Questions
        </button>
        <button onclick="tryAnotherQuiz()" class="btn-gradient px-10 py-4 rounded-xl text-white font-bold text-lg hover:scale-105 transition-transform shadow-2xl">
          <i data-lucide="rotate-cw" class="w-6 h-6 inline mr-2"></i>
          Try Another Quiz
        </button>
      </div>

    </div>
  `;

  if (window.lucide) window.lucide.createIcons();
}

function renderOSCE(container) {
  const currentStation = sessionStations[currentIndex];
  const stationId = currentStation.id;
  const checklist = currentStationChecklist[stationId] || {};
  const isFlagged = flaggedStations.includes(stationId);

  // ✅ % COMPLETE BADGE CALC (ADD THIS)
  const allItems = ['preparation','assessment','interventions','communication','safetyRedFlags','documentation']
    .flatMap(k => currentStation.checklist?.[k] || []);
  const totalItems = allItems.length;
  const checkedItems = allItems.reduce((acc, item) => acc + (checklist[item] ? 1 : 0), 0);
  const stationPct = totalItems ? Math.round((checkedItems / totalItems) * 100) : 0;

  container.innerHTML = `
    <div class="fade-in max-w-6xl mx-auto">

      

        <h1 class="text-3xl text-white font-bold mb-2">${currentStation.title}</h1>

        <div class="flex gap-3 text-sm text-slate-300">
          <span class="px-2 py-1 rounded bg-white bg-opacity-10">
            ${currentStation.estimatedMinutes} mins
          </span>
          <span class="px-2 py-1 rounded bg-white bg-opacity-10 capitalize">
            ${currentStation.difficulty}
          </span>
        </div>
      </div>

      <!-- MAIN GRID -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2">

          <div class="glass-card rounded-2xl p-2 mb-6">
            <div class="flex gap-2">
              <button onclick="switchTab('brief')" class="tab-button flex-1 px-4 py-2 rounded-lg text-white ${currentTab === 'brief' ? 'active' : ''}">
                Brief
              </button>
              <button onclick="switchTab('checklist')" class="tab-button flex-1 px-4 py-2 rounded-lg text-white ${currentTab === 'checklist' ? 'active' : ''}">
                Checklist
              </button>
              <button onclick="switchTab('notes')" class="tab-button flex-1 px-4 py-2 rounded-lg text-white ${currentTab === 'notes' ? 'active' : ''}">
                Notes
              </button>
            </div>
          </div>

          ${currentTab === 'brief' ? renderBriefTab(currentStation) : ''}
          ${currentTab === 'checklist' ? renderChecklistTab(currentStation, checklist) : ''}
          ${currentTab === 'notes' ? renderNotesTab(stationId) : ''}
        </div>

        <div class="space-y-6">
          ${renderEquipmentPanel(currentStation)}
          ${renderTipsPanel(currentStation)}
          ${renderWarningsPanel(currentStation)}
        </div>
      </div>

      <!-- NAV BUTTONS -->
      <div class="glass-card rounded-2xl p-6 mt-6 flex justify-between items-center">
        <button onclick="previousStation()" ${currentIndex === 0 ? 'disabled' : ''} class="btn-secondary px-6 py-3 rounded-xl text-white disabled:opacity-30">
          Previous
        </button>

        ${currentIndex === sessionStations.length - 1 ? `
          <button onclick="finishOSCE()" class="btn-gradient px-8 py-3 rounded-xl text-white font-bold">
            Finish Practice
          </button>
        ` : `
          <button onclick="nextStation()" class="btn-gradient px-6 py-3 rounded-xl text-white">
            Next Station
          </button>
        `}
      </div>
    </div>
  `;

  if (window.lucide) window.lucide.createIcons();
}

    
    function renderBriefTab(station) {
      return `
        <div class="glass-card rounded-2xl p-8 space-y-6">
          <div>
            <h3 class="text-white font-bold text-lg mb-3">Candidate Instructions</h3>
            <p class="text-slate-300 leading-relaxed text-lg">${station.candidateInstructions}</p>
          </div>
          ${station.mnemonics ? `
            <div class="bg-purple-500 bg-opacity-10 p-4 rounded-xl border border-purple-500 border-opacity-30">
              <h4 class="text-purple-300 font-bold mb-2">Memory Aid</h4>
              <ul class="list-disc pl-5 text-slate-300 space-y-1">
                ${station.mnemonics.map(m => `<li>${m}</li>`).join('')}
              </ul>
            </div>
          ` : ''}
        </div>
      `;
    }

    function renderChecklistTab(station, checklist) {
  const sections = [
    { key: 'safetyRedFlags', label: 'Safety & Red Flags', color: '#ef4444', icon: 'alert-triangle', pinned: true },
    { key: 'preparation', label: 'Preparation', color: '#06b6d4', icon: 'settings' },
    { key: 'assessment', label: 'Assessment', color: '#8b5cf6', icon: 'stethoscope' },
    { key: 'interventions', label: 'Interventions', color: '#22c55e', icon: 'activity' },
    { key: 'communication', label: 'Communication', color: '#f59e0b', icon: 'message-circle' },
    { key: 'documentation', label: 'Documentation', color: '#64748b', icon: 'file-text' }
  ];

  // ---- state: show missed only (persist per-station) ----
  window.__osceShowMissedOnly = window.__osceShowMissedOnly || {};
  const showMissedOnly = !!window.__osceShowMissedOnly[station.id];

  // ---- build flat counts ----
  const getItems = (k) => (station.checklist?.[k] || []);
  const allItems = sections.flatMap(s => getItems(s.key));
  const total = allItems.length;
  const checked = allItems.reduce((acc, item) => acc + (checklist[item] ? 1 : 0), 0);
  const pct = total ? Math.round((checked / total) * 100) : 0;

  // per-domain breakdown
  const domainStats = sections.map(s => {
    const items = getItems(s.key);
    const t = items.length;
    const c = items.reduce((acc, item) => acc + (checklist[item] ? 1 : 0), 0);
    const p = t ? Math.round((c / t) * 100) : 0;
    return { ...s, total: t, checked: c, pct: p, items };
  }).filter(d => d.total > 0);

  // pinned first
  domainStats.sort((a, b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0));

  // ---- actions (safe, no global collisions) ----
  window.toggleOSCEShowMissedOnly = (stationId) => {
    window.__osceShowMissedOnly = window.__osceShowMissedOnly || {};
    window.__osceShowMissedOnly[stationId] = !window.__osceShowMissedOnly[stationId];
    render();
  };

  // ---- UI ----
  return `
    <div class="glass-card rounded-2xl p-6 mb-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <div class="flex items-center gap-3">
            <h3 class="text-white font-bold text-xl flex items-center gap-2">
              <i data-lucide="list-checks" class="w-6 h-6 text-cyan-400"></i>
              Checklist Progress
            </h3>
            <span class="px-3 py-1 rounded-full text-xs font-bold"
              style="background: rgba(167,70,224,.18); border:1px solid rgba(167,70,224,.35); color:#f472b6;">
              ${pct}% complete
            </span>
          </div>
          <div class="text-slate-400 text-sm mt-1">${checked}/${total} items completed</div>
        </div>

        <button
          onclick="toggleOSCEShowMissedOnly('${station.id}')"
          class="btn-secondary px-4 py-2 rounded-lg text-white text-sm"
          style="${showMissedOnly ? 'border-color: rgba(244,114,182,.6);' : ''}"
        >
          <i data-lucide="${showMissedOnly ? 'filter-x' : 'filter'}" class="w-4 h-4 inline mr-2"></i>
          ${showMissedOnly ? 'Showing missed only' : 'Show missed only'}
        </button>
      </div>

      <div class="mt-4 w-full bg-white bg-opacity-5 rounded-full h-3 overflow-hidden">
        <div class="h-3 rounded-full" style="width:${pct}%; background:linear-gradient(90deg, #a746e0, #f472b6);"></div>
      </div>
    </div>

    <div class="space-y-4">
      ${domainStats.map(domain => {
        // Filter items
        const visibleItems = showMissedOnly
          ? domain.items.filter(item => !checklist[item])
          : domain.items;

        const missed = domain.total - domain.checked;
        const priorityTag = (!domain.pinned && domain.pct < 75) ? `<span class="ml-2 px-2 py-0.5 bg-orange-500 text-white text-xs font-bold rounded-full">PRIORITY</span>` : '';
        const pinnedTag = domain.pinned ? `<span class="ml-2 px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded-full">CRITICAL</span>` : '';

        return `
          <div class="glass-card rounded-2xl p-6 ${domain.pinned ? 'border-2 border-red-500 border-opacity-30' : ''}">
            <div class="flex items-start justify-between gap-4 mb-4">
              <div class="flex items-start gap-3">
                <div class="p-2 rounded-lg" style="background:${domain.color}22;">
                  <i data-lucide="${domain.icon}" class="w-5 h-5" style="color:${domain.color};"></i>
                </div>
                <div>
                  <div class="flex items-center">
                    <h4 class="text-white font-bold">${domain.label}</h4>
                    ${pinnedTag}
                    ${priorityTag}
                  </div>
                  <div class="text-slate-400 text-sm">
                    ${domain.checked}/${domain.total} • ${domain.pct}% • ${missed} missed
                  </div>
                </div>
              </div>

              <div class="text-right">
                <div class="text-2xl font-bold ${domain.pct >= 75 ? 'text-green-400' : domain.pct >= 50 ? 'text-yellow-400' : 'text-red-400'}">${domain.pct}%</div>
              </div>
            </div>

            <div class="w-full bg-white bg-opacity-5 rounded-full h-3 overflow-hidden mb-4">
              <div class="h-3 rounded-full" style="width:${domain.pct}%; background:linear-gradient(90deg, ${domain.color}, ${domain.pct >= 75 ? '#22c55e' : domain.pct >= 50 ? '#f59e0b' : '#ef4444'});"></div>
            </div>

            ${visibleItems.length ? `
              <div class="space-y-2">
                ${visibleItems.map(item => {
                  const isChecked = !!checklist[item];
                  const isCritical = domain.key === 'safetyRedFlags';
                  const safeItem = String(item).replace(/'/g, "\\'");

                  return `
                    <label class="checklist-item ${isChecked ? 'checked' : ''} ${isCritical ? 'critical' : ''} p-3 rounded-lg flex items-start gap-3 cursor-pointer">
                      <input
                        type="checkbox"
                        ${isChecked ? 'checked' : ''}
                        onchange="toggleChecklistItem('${station.id}', '${safeItem}', this.checked)"
                        class="w-5 h-5 mt-0.5"
                      >
                      <span class="text-slate-300 flex-1">${item}</span>
                      ${isCritical ? `<span class="text-xs font-bold text-red-300">RED FLAG</span>` : ''}
                    </label>
                  `;
                }).join('')}
              </div>
            ` : `
              <div class="bg-white bg-opacity-5 rounded-xl p-4 text-slate-300 text-sm">
                <i data-lucide="check-circle" class="w-4 h-4 inline mr-2 text-green-400"></i>
                ${showMissedOnly ? 'No missed items in this domain 🎉' : 'No items to show.'}
              </div>
            `}
          </div>
        `;
      }).join('')}
    </div>
  `;
}

    function renderNotesTab(stationId) {
      const notes = stationNotes[stationId] || '';
      return `
        <div class="glass-card rounded-2xl p-6">
          <h3 class="text-white font-bold text-lg mb-4">Your Notes</h3>
          <textarea 
            class="w-full h-96 bg-white bg-opacity-5 border border-white border-opacity-10 rounded-xl p-4 text-slate-300 resize-none focus:outline-none focus:border-purple-400"
            placeholder="Type your reflection here..."
            oninput="updateStationNotes('${stationId}', this.value)"
          >${notes}</textarea>
        </div>
      `;
    }

    function renderEquipmentPanel(station) {
      return `
        <div class="glass-card rounded-2xl p-6">
          <h3 class="text-white font-bold mb-4">Equipment</h3>
          <ul class="space-y-2">
            ${station.equipment.map(item => `
              <li class="text-slate-300 text-sm flex items-start gap-2">
                <i data-lucide="box" class="w-4 h-4 text-cyan-400 mt-0.5 flex-shrink-0"></i>
                <span>${item}</span>
              </li>
            `).join('')}
          </ul>
        </div>
      `;
    }

    function renderTipsPanel(station) {
      if (!station.tips || station.tips.length === 0) return '';
      return `
        <div class="glass-card rounded-2xl p-6">
          <h3 class="text-white font-bold mb-4 text-yellow-400">Tips</h3>
          <ul class="space-y-3">
            ${station.tips.map(tip => `
              <li class="text-slate-300 text-sm flex items-start gap-2">
                <i data-lucide="star" class="w-4 h-4 text-yellow-400 mt-0.5 flex-shrink-0"></i>
                <span>${tip}</span>
              </li>
            `).join('')}
          </ul>
        </div>
      `;
    }

    function renderWarningsPanel(station) {
      if (!station.warnings || station.warnings.length === 0) return '';
      return `
        <div class="glass-card rounded-2xl p-6 border border-red-500 border-opacity-30">
          <h3 class="text-red-400 font-bold mb-4">Warnings</h3>
          <ul class="space-y-3">
            ${station.warnings.map(w => `
              <li class="text-red-200 text-sm flex items-start gap-2">
                <i data-lucide="alert-triangle" class="w-4 h-4 text-red-400 mt-0.5 flex-shrink-0"></i>
                <span>${w}</span>
              </li>
            `).join('')}
          </ul>
        </div>
      `;
    }

    function renderOSCEResults(container) {
  // --------- CALCS ----------
  let totalItems = 0;
  let totalChecked = 0;
  const stationResults = [];

  sessionStations.forEach(station => {
    const stId = station.id;
    const checklist = currentStationChecklist[stId] || {};

    const domains = ['preparation','assessment','interventions','communication','safetyRedFlags','documentation'];
    const allItems = domains.flatMap(d => station.checklist?.[d] || []);
    const checkedCount = Object.values(checklist).filter(Boolean).length;

    totalItems += allItems.length;
    totalChecked += checkedCount;

    const domainBreakdown = {};
    domains.forEach(domain => {
      const items = station.checklist?.[domain] || [];
      const checked = items.filter(item => checklist[item]).length;
      domainBreakdown[domain] = {
        checked,
        total: items.length,
        percentage: items.length ? Math.round((checked / items.length) * 100) : 0
      };
    });

    stationResults.push({
      station,
      checkedCount,
      totalCount: allItems.length,
      percentage: allItems.length ? Math.round((checkedCount / allItems.length) * 100) : 0,
      domainBreakdown,
      isFlagged: flaggedStations.includes(stId),
      notes: stationNotes?.[stId] || ''
    });
  });

  const overallPercentage = totalItems ? Math.round((totalChecked / totalItems) * 100) : 0;

  // --------- GRADE ----------
  let grade = 'Needs Work';
  let gradeColor = '#ef4444';
  let gradeIcon = 'book-open';
  let gradeMessage = 'Every practice session strengthens your clinical skills. Focus on the key areas below.';

  if (overallPercentage >= 90) {
    grade = 'Outstanding'; gradeColor = '#22c55e'; gradeIcon = 'trophy';
    gradeMessage = 'Exceptional performance! Your technique and knowledge are OSCE-ready.';
  } else if (overallPercentage >= 75) {
    grade = 'Strong Pass'; gradeColor = '#84cc16'; gradeIcon = 'check-circle';
    gradeMessage = 'Excellent work! Just a few refinements needed to reach mastery.';
  } else if (overallPercentage >= 60) {
    grade = 'Pass'; gradeColor = '#f59e0b'; gradeIcon = 'trending-up';
    gradeMessage = 'Solid foundation! Target the domains below to strengthen your performance.';
  } else if (overallPercentage >= 50) {
    grade = 'Borderline'; gradeColor = '#f97316'; gradeIcon = 'alert-circle';
    gradeMessage = 'You’re close! Focus practice on weak areas to push over the pass mark.';
  }

  // --------- DOMAIN SUMMARY ----------
  const domainLabels = {
    preparation: 'Preparation',
    assessment: 'Assessment',
    interventions: 'Interventions',
    communication: 'Communication',
    safetyRedFlags: 'Safety & Red Flags',
    documentation: 'Documentation'
  };
  const domainIcons = {
    preparation: 'settings',
    assessment: 'stethoscope',
    interventions: 'activity',
    communication: 'message-circle',
    safetyRedFlags: 'alert-triangle',
    documentation: 'file-text'
  };
  const domainColors = {
    preparation: '#06b6d4',
    assessment: '#8b5cf6',
    interventions: '#22c55e',
    communication: '#f59e0b',
    safetyRedFlags: '#ef4444',
    documentation: '#64748b'
  };

  const overallDomains = {};
  Object.keys(domainLabels).forEach(domain => {
    let domainChecked = 0;
    let domainTotal = 0;
    stationResults.forEach(sr => {
      domainChecked += sr.domainBreakdown[domain].checked;
      domainTotal += sr.domainBreakdown[domain].total;
    });
    overallDomains[domain] = {
      checked: domainChecked,
      total: domainTotal,
      percentage: domainTotal ? Math.round((domainChecked / domainTotal) * 100) : 0
    };
  });

  const domainArray = Object.entries(overallDomains)
    .map(([key, data]) => ({
      key,
      label: domainLabels[key],
      icon: domainIcons[key],
      color: domainColors[key],
      ...data
    }))
    .sort((a, b) => a.percentage - b.percentage);

  const weakDomains = domainArray.filter(d => d.total > 0 && d.percentage < 75);
  const strongDomains = domainArray.filter(d => d.total > 0 && d.percentage >= 75).slice(-3);

  // --------- INSIGHTS ----------
  const insights = [];
  if (overallPercentage >= 90) {
    insights.push({ icon:'trophy', color:'#22c55e', title:'Exam Ready', text:'Strong clinical competence across all domains. Maintain this standard!' });
  } else if (overallPercentage >= 75) {
    insights.push({ icon:'target', color:'#84cc16', title:'Nearly There', text:`Just ${90 - overallPercentage}% away from excellence. Perfect your weak domains.` });
  } else {
    insights.push({ icon:'trending-up', color:'#f59e0b', title:'Growth Opportunity', text:`${Math.max(0, 75 - overallPercentage)}% improvement needed to reach strong pass. Target high-impact domains first.` });
  }
  if (weakDomains.length) {
    const w = weakDomains[0];
    insights.push({ icon:'alert-circle', color:'#f97316', title:'Priority Focus Area', text:`${w.label}: ${w.percentage}% (${w.total - w.checked} items missed). This domain needs immediate attention.` });
  }
  if (strongDomains.length) {
    const s = strongDomains[strongDomains.length - 1];
    insights.push({ icon:'award', color:'#8b5cf6', title:'Key Strength', text:`${s.label}: ${s.percentage}%. Keep this as your confidence anchor.` });
  }
  if (flaggedStations.length) {
    insights.push({ icon:'flag', color:'#ec4899', title:'Flagged Stations', text:`You flagged ${flaggedStations.length} station${flaggedStations.length > 1 ? 's' : ''}. Review these carefully.` });
  }

  // --------- CRITICAL SAFETY MISSES ----------
  const missedSafetyItems = [];
  stationResults.forEach((sr, idx) => {
    const checklist = currentStationChecklist[sr.station.id] || {};
    const safetyItems = sr.station.checklist?.safetyRedFlags || [];
    safetyItems.forEach(item => {
      if (!checklist[item]) {
        missedSafetyItems.push({
          stationIndex: idx,
          stationTitle: sr.station.title,
          item
        });
      }
    });
  });

  // --------- RENDER ----------
  container.innerHTML = `
    <div class="fade-in max-w-6xl mx-auto">
    
<!-- HERO -->
<div class="glass-card rounded-3xl p-8 md:p-12 text-center mb-8 relative overflow-hidden">
  <div class="absolute inset-0 opacity-10">
    <div class="absolute top-0 left-0 w-64 h-64 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 right-0 w-64 h-64 bg-gradient-to-tl from-cyan-400 to-purple-400 rounded-full blur-3xl"></div>
  </div>

  <div class="relative z-10">
    <div
      class="inline-flex items-center gap-2 px-4 py-2 rounded-full mb-6 ${grade === 'Needs Work' ? 'pulse-red-badge' : ''}"
      style="background:${gradeColor}33; border:2px solid ${gradeColor};"
    >
      <i data-lucide="${gradeIcon}" class="w-5 h-5" style="color:${gradeColor};"></i>
      <span class="font-bold text-sm" style="color:${gradeColor};">${grade}</span>
    </div>

    <h1 class="text-5xl md:text-6xl font-extrabold text-white mb-4 tracking-tight">
      OSCE Complete!
    </h1>

    <p class="text-xl text-slate-300 max-w-2xl mx-auto">
      ${gradeMessage}
    </p>
  </div>
</div>

      <!-- KPI GRID -->
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
        <div class="glass-card rounded-2xl p-5">
          <i data-lucide="percent" class="w-5 h-5 text-purple-400"></i>
          <div class="text-3xl font-extrabold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent mt-2">${overallPercentage}%</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Overall</div>
        </div>
        <div class="glass-card rounded-2xl p-5">
          <i data-lucide="check-square" class="w-5 h-5 text-green-400"></i>
          <div class="text-3xl font-extrabold text-green-400 mt-2">${totalChecked}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Completed</div>
        </div>
        <div class="glass-card rounded-2xl p-5">
          <i data-lucide="square" class="w-5 h-5 text-red-400"></i>
          <div class="text-3xl font-extrabold text-red-400 mt-2">${Math.max(0, totalItems - totalChecked)}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Missed</div>
        </div>
        <div class="glass-card rounded-2xl p-5">
          <i data-lucide="layers" class="w-5 h-5 text-cyan-400"></i>
          <div class="text-3xl font-extrabold text-cyan-400 mt-2">${sessionStations.length}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Stations</div>
        </div>
        <div class="glass-card rounded-2xl p-5">
          <i data-lucide="flag" class="w-5 h-5 text-yellow-400"></i>
          <div class="text-3xl font-extrabold text-yellow-400 mt-2">${flaggedStations.length}</div>
          <div class="text-slate-400 text-xs uppercase tracking-wider">Flagged</div>
        </div>
      </div>

      <!-- INSIGHTS -->
      <div class="glass-card rounded-2xl p-8 mb-8">
        <h2 class="text-white text-2xl font-bold mb-6 flex items-center gap-3">
          <i data-lucide="brain" class="w-7 h-7 text-pink-400"></i>
          Smart Insights
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          ${insights.map(insight => `
            <div class="p-4 rounded-xl border-2" style="background:${insight.color}11; border-color:${insight.color}33;">
              <div class="flex items-start gap-3">
                <div class="p-2 rounded-lg" style="background:${insight.color}22;">
                  <i data-lucide="${insight.icon}" class="w-5 h-5" style="color:${insight.color};"></i>
                </div>
                <div class="flex-1">
                  <h4 class="text-white font-bold mb-1">${insight.title}</h4>
                  <p class="text-slate-300 text-sm leading-relaxed">${insight.text}</p>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      </div>

      <!-- PERFORMANCE BY DOMAIN -->
      <div class="glass-card rounded-2xl p-8 mb-8">
        <h2 class="text-white text-2xl font-bold mb-6 flex items-center gap-3">
          <i data-lucide="bar-chart-3" class="w-7 h-7 text-purple-400"></i>
          Performance by Domain
        </h2>
        <div class="space-y-4">
          ${domainArray.map(d => {
            const isPriority = d.total > 0 && d.percentage < 75;
            return `
              <div class="p-4 rounded-xl ${isPriority ? 'bg-orange-500 bg-opacity-10 border-2 border-orange-500 border-opacity-30' : 'bg-white bg-opacity-5'}">
                <div class="flex items-center justify-between mb-3">
                  <div class="flex items-center gap-3">
                    <div class="p-2 rounded-lg" style="background:${d.color}22;">
                      <i data-lucide="${d.icon}" class="w-5 h-5" style="color:${d.color};"></i>
                    </div>
                    <div>
                      <div class="flex items-center gap-2">
                        <span class="text-white font-semibold">${d.label}</span>
                        ${isPriority ? '<span class="px-2 py-0.5 bg-orange-500 text-white text-xs font-bold rounded-full">PRIORITY</span>' : ''}
                      </div>
                      <span class="text-slate-400 text-sm">${d.checked}/${d.total} items</span>
                    </div>
                  </div>
                  <div class="text-2xl font-bold ${d.percentage >= 75 ? 'text-green-400' : d.percentage >= 50 ? 'text-yellow-400' : 'text-red-400'}">${d.percentage}%</div>
                </div>
                <div class="w-full bg-white bg-opacity-5 rounded-full h-3 overflow-hidden">
                  <div class="h-3 rounded-full" style="width:${d.percentage}%; background:linear-gradient(90deg, ${d.color}, ${d.percentage >= 75 ? '#22c55e' : d.percentage >= 50 ? '#f59e0b' : '#ef4444'});"></div>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      </div>

      <!-- STATION BREAKDOWN -->
      <div class="glass-card rounded-2xl p-8 mb-8">
        <h2 class="text-white text-2xl font-bold mb-6 flex items-center gap-3">
          <i data-lucide="list-checks" class="w-7 h-7 text-cyan-400"></i>
          Station Breakdown
        </h2>

        <div class="space-y-4">
          ${stationResults.map((sr, idx) => {
            const topic = topics.find(t => t.id === sr.station.topic);
            return `
              <div class="glass-card p-6 rounded-xl border-2 ${sr.percentage >= 75 ? 'border-green-500 border-opacity-30' : sr.percentage >= 50 ? 'border-yellow-500 border-opacity-30' : 'border-red-500 border-opacity-30'}">
                <div class="flex items-start justify-between mb-4">
                  <div class="flex-1">
                    <div class="flex items-center gap-2 mb-2">
                      <span class="text-white font-bold text-lg">Station ${idx + 1}</span>
                      ${sr.isFlagged ? '<i data-lucide="flag" class="w-5 h-5 text-yellow-400"></i>' : ''}
                      ${topic ? `<span class="text-xs px-3 py-1 rounded-full font-semibold" style="background:${topic.color}22; color:${topic.color};">${topic.name}</span>` : ''}
                    </div>
                    <h3 class="text-slate-300 font-semibold mb-1">${sr.station.title}</h3>
                    <p class="text-slate-400 text-sm">
                      <span class="capitalize ${
                        sr.station.difficulty === 'easy' ? 'text-green-400' :
                        sr.station.difficulty === 'medium' ? 'text-yellow-400' : 'text-red-400'
                      }">${sr.station.difficulty}</span> • ${sr.station.estimatedMinutes} minutes
                    </p>
                  </div>

                  <div class="text-right">
                    <div class="text-4xl font-bold ${sr.percentage >= 75 ? 'text-green-400' : sr.percentage >= 50 ? 'text-yellow-400' : 'text-red-400'}">${sr.percentage}%</div>
                    <div class="text-slate-400 text-sm">${sr.checkedCount}/${sr.totalCount} items</div>
                  </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                  ${Object.entries(sr.domainBreakdown)
                    .filter(([_, d]) => d.total > 0)
                    .map(([domain, data]) => `
                      <div class="bg-white bg-opacity-5 rounded-lg p-3">
                        <div class="flex items-center justify-between mb-2">
                          <span class="text-xs text-slate-400 font-semibold">${domainLabels[domain]}</span>
                          <span class="text-xs text-slate-300 mono font-bold">${data.percentage}%</span>
                        </div>
                        <div class="w-full bg-white bg-opacity-5 rounded-full h-2">
                          <div class="h-2 rounded-full" style="width:${data.percentage}%; background:${domainColors[domain]};"></div>
                        </div>
                      </div>
                    `).join('')}
                </div>

                ${sr.notes ? `
                  <div class="mt-4 p-3 bg-purple-500 bg-opacity-10 border border-purple-500 border-opacity-30 rounded-lg">
                    <div class="text-purple-200 text-xs mb-1 flex items-center gap-1 font-semibold">
                      <i data-lucide="sticky-note" class="w-3 h-3"></i> Your Notes
                    </div>
                    <p class="text-slate-300 text-sm leading-relaxed">${sr.notes.substring(0, 180)}${sr.notes.length > 180 ? '...' : ''}</p>
                  </div>
                ` : ''}
              </div>
            `;
          }).join('')}
        </div>
      </div>

      ${missedSafetyItems.length ? `
        <div class="glass-card rounded-2xl p-8 mb-8 border-2 border-red-500 border-opacity-50">
          <h2 class="text-white text-2xl font-bold mb-4 flex items-center gap-3">
            <i data-lucide="alert-octagon" class="w-7 h-7 text-red-400"></i>
            Critical Safety Items Missed
          </h2>
          <p class="text-red-200 text-sm mb-6 leading-relaxed">
            <strong>Important:</strong> These are patient-safety red flags. Missing them in a real OSCE can trigger immediate fail criteria.
          </p>
          <div class="space-y-3">
            ${missedSafetyItems.map(m => `
              <div class="bg-red-500 bg-opacity-10 border-2 border-red-500 border-opacity-30 rounded-xl p-4">
                <div class="text-red-300 font-bold mb-1">Station ${m.stationIndex + 1}: ${m.stationTitle}</div>
                <p class="text-red-100 text-sm leading-relaxed">${m.item}</p>
              </div>
            `).join('')}
          </div>
        </div>
      ` : ''}

      <!-- Personalized Action Plan -->
      <div class="glass-card rounded-2xl p-8 mb-8 border-2 border-purple-500 border-opacity-30">
        <h2 class="text-white text-2xl font-bold mb-6 flex items-center gap-3">
          <i data-lucide="map" class="w-7 h-7 text-purple-400"></i>
          Your Personalized Action Plan
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Immediate Priorities -->
          <div>
            <h4 class="text-purple-300 font-bold mb-4 flex items-center gap-2">
              <i data-lucide="zap" class="w-5 h-5"></i>
              Immediate Priorities
            </h4>

            <ul class="space-y-3 text-slate-300 text-sm">
              ${weakDomains.length > 0 ? weakDomains.slice(0, 3).map(d => `
                <li class="flex items-start gap-2">
                  <span class="text-purple-400 font-bold flex-shrink-0">•</span>
                  <span>
                    <strong>${d.label}:</strong> Practice ${d.total - d.checked} missed item${(d.total - d.checked) !== 1 ? 's' : ''} until technique is fluent
                    (${d.percentage}% → aim for 90%+)
                  </span>
                </li>
              `).join('') : `
                <li class="flex items-start gap-2">
                  <span class="text-purple-400 font-bold flex-shrink-0">•</span>
                  <span><strong>Maintain excellence:</strong> Your performance is strong across all domains—keep practicing regularly.</span>
                </li>
              `}

              <li class="flex items-start gap-2">
                <span class="text-purple-400 font-bold flex-shrink-0">•</span>
                <span><strong>Checklist mastery:</strong> Aim for 100% completion on all domains—every step matters in real clinical practice</span>
              </li>
            </ul>
          </div>

          <!-- Practice Strategy -->
          <div>
            <h4 class="text-pink-300 font-bold mb-4 flex items-center gap-2">
              <i data-lucide="calendar-check" class="w-5 h-5"></i>
              Practice Strategy
            </h4>

            <ul class="space-y-3 text-slate-300 text-sm">
              <li class="flex items-start gap-2">
                <span class="text-pink-400 font-bold flex-shrink-0">•</span>
                <span><strong>Daily focused practice:</strong> Spend 15–20 minutes daily on your weakest domain until comfortable</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-pink-400 font-bold flex-shrink-0">•</span>
                <span><strong>Break it down:</strong> Practice each station section separately (prep → assessment → interventions) before combining</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-pink-400 font-bold flex-shrink-0">•</span>
                <span><strong>Real-world application:</strong> Practice on manikins or volunteer for supervised clinical opportunities</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-pink-400 font-bold flex-shrink-0">•</span>
                <span><strong>Communication drill:</strong> Practice SBAR handovers and patient explanations out loud until natural and confident</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- What You Did Well + Common OSCE Pitfalls -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="glass-card rounded-2xl p-6 border-2 border-green-500 border-opacity-30">
          <h3 class="text-white text-xl font-bold mb-4 flex items-center gap-2">
            <i data-lucide="thumbs-up" class="w-6 h-6 text-green-400"></i>
            What You Did Well
          </h3>
          <ul class="space-y-3">
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="check" class="w-4 h-4 text-green-400 mt-0.5 flex-shrink-0"></i>
              <span>You completed ${sessionStations.length} station${sessionStations.length !== 1 ? 's' : ''}—this active practice builds clinical confidence and competence</span>
            </li>
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="check" class="w-4 h-4 text-green-400 mt-0.5 flex-shrink-0"></i>
              <span>Used the checklist system effectively—this mirrors real OSCE mark schemes and builds exam technique</span>
            </li>
          </ul>
        </div>

        <div class="glass-card rounded-2xl p-6 border-2 border-orange-500 border-opacity-30">
          <h3 class="text-white text-xl font-bold mb-4 flex items-center gap-2">
            <i data-lucide="alert-circle" class="w-6 h-6 text-orange-400"></i>
            Common OSCE Pitfalls
          </h3>
          <ul class="space-y-3">
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="x" class="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0"></i>
              <span><strong>Skipping introduction:</strong> Always introduce yourself, verify patient ID, and gain consent—first impressions matter</span>
            </li>
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="x" class="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0"></i>
              <span><strong>Silent procedures:</strong> Talk through what you're doing—examiners need to hear your clinical reasoning</span>
            </li>
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="x" class="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0"></i>
              <span><strong>Forgetting hand hygiene:</strong> Wash hands before AND after every patient contact—it's an automatic fail if missed</span>
            </li>
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="x" class="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0"></i>
              <span><strong>Poor time management:</strong> Practice timing yourself—running over time loses marks even if technique is perfect</span>
            </li>
            <li class="flex items-start gap-2 text-slate-300 text-sm">
              <i data-lucide="x" class="w-4 h-4 text-orange-400 mt-0.5 flex-shrink-0"></i>
              <span><strong>Not documenting:</strong> Real clinical practice requires documentation—practice this step even in mock OSCEs</span>
            </li>
          </ul>
        </div>
      </div>


      <!-- ACTIONS -->
      <div class="flex gap-4 justify-center flex-wrap">
        <button onclick="downloadOSCEResultsPDF()" class="btn-secondary px-10 py-4 rounded-xl text-white font-semibold text-lg">
          <i data-lucide="download" class="w-6 h-6 inline mr-2"></i>
          Download PDF
        </button>
        <button onclick="exitToSelection()" class="btn-gradient px-10 py-4 rounded-xl text-white font-bold text-lg">
          <i data-lucide="refresh-cw" class="w-6 h-6 inline mr-2"></i>
          Practice Again
        </button>
      </div>
    </div>
  `;
}


    function renderSelection(container) {
      container.innerHTML = `
        <div class="fade-in max-w-6xl mx-auto">
          <header class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-bold text-white mb-4">${config.app_title}</h1>
            <p class="text-xl text-slate-300">${config.app_subtitle}</p>
          </header>

          <div class="glass-card rounded-2xl p-8 mb-8">
            <label class="block text-white font-semibold mb-4 text-lg">Select Mode</label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <button onclick="selectMode('quiz')" class="topic-card p-6 rounded-xl transition-all text-left ${sessionMode === 'quiz' ? 'selected' : ''}">
                <i data-lucide="brain" class="w-8 h-8 text-pink-400 mb-3"></i>
                <h3 class="text-white font-bold text-lg mb-2">Quiz Mode</h3>
                <p class="text-slate-300 text-sm">Multiple-choice questions to test knowledge</p>
              </button>
              <button onclick="selectMode('osce')" class="topic-card p-6 rounded-xl transition-all text-left ${sessionMode === 'osce' ? 'selected' : ''}">
                <i data-lucide="clipboard-check" class="w-8 h-8 text-purple-400 mb-3"></i>
                <h3 class="text-white font-bold text-lg mb-2">OSCE Stations</h3>
                <p class="text-slate-300 text-sm">Practice clinical scenarios with checklists</p>
              </button>
            </div>
          </div>

          <div class="glass-card rounded-2xl p-8 mb-8">
            <div class="flex items-center justify-between mb-6">
              <label class="text-white font-semibold text-lg">Select Topics (${selectedTopics.length} selected)</label>
              <div class="flex gap-2">
                <button onclick="selectAllTopics()" class="btn-secondary px-4 py-2 rounded-lg text-sm text-white">Select All</button>
                <button onclick="clearTopics()" class="btn-secondary px-4 py-2 rounded-lg text-sm text-white">Clear</button>
              </div>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
              ${topics.map(topic => {
                const count = sessionMode === 'quiz' 
                  ? quizBank.filter(q => q.topic === topic.id).length
                  : stationBank.filter(s => s.topic === topic.id).length;
                const isSelected = selectedTopics.includes(topic.id);
                
                return `
                  <button 
                    onclick="toggleTopic('${topic.id}')" 
                    class="topic-card p-6 rounded-xl transition-all text-left ${isSelected ? 'selected' : ''}"
                    style="border-color: ${isSelected ? topic.color : 'rgba(167, 70, 224, 0.2)'};"
                  >
                    <div class="flex items-center justify-between mb-3">
                      <i data-lucide="${topic.icon}" class="w-8 h-8" style="color: ${topic.color};"></i>
                      <span class="text-xs mono px-2 py-1 rounded bg-white bg-opacity-10">${count}</span>
                    </div>
                    <h3 class="text-white font-semibold text-base">${topic.name}</h3>
                  </button>
                `;
              }).join('')}
            </div>
          </div>

          <div class="text-center">
            <button 
              onclick="startSession()" 
              ${selectedTopics.length === 0 ? 'disabled' : ''}
              class="btn-gradient px-12 py-4 rounded-xl text-white font-bold text-lg disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Start ${sessionMode === 'quiz' ? 'Quiz' : 'OSCE Practice'}
            </button>
          </div>
        </div>
      `;
    }

    function renderNavigator() {
      const content = document.getElementById('navigator-content');
      content.innerHTML = `
        <div class="space-y-3">
          ${sessionStations.map((station, idx) => {
            const stId = station.id;
            const stChecklist = currentStationChecklist[stId] || {};
            const stAllItems = [
              ...station.checklist.preparation,
              ...station.checklist.assessment,
              ...station.checklist.interventions,
              ...station.checklist.communication,
              ...station.checklist.safetyRedFlags,
              ...station.checklist.documentation
            ];
            const stCheckedCount = Object.values(stChecklist).filter(v => v).length;
            const completionPercent = stAllItems.length > 0 ? Math.round((stCheckedCount / stAllItems.length) * 100) : 0;
            const isCurrent = idx === currentIndex;
            
            return `
              <button 
                onclick="jumpToStation(${idx}); closeNavigator();"
                class="w-full glass-card p-4 rounded-xl text-left transition-all hover:border-purple-400 ${isCurrent ? 'border-2 border-purple-500' : 'border border-white border-opacity-10'}"
              >
                <div class="flex items-start justify-between mb-2">
                  <div class="flex-1">
                    <div class="text-white font-semibold mb-1">Station ${idx + 1}</div>
                    <div class="text-slate-300 text-sm">${station.title}</div>
                  </div>
                </div>
                <div class="flex items-center gap-2">
                  <div class="flex-1 bg-white bg-opacity-5 rounded-full h-2">
                    <div class="h-2 rounded-full bg-purple-500 transition-all" style="width: ${completionPercent}%"></div>
                  </div>
                  <span class="text-xs text-slate-400 mono">${completionPercent}%</span>
                </div>
              </button>
            `;
          }).join('')}
        </div>
      `;
      if (window.lucide) window.lucide.createIcons();
    }

    // ==================== EVENT HANDLERS ====================
    window.selectMode = (mode) => { sessionMode = mode; render(); };
    window.toggleTopic = (topicId) => {
      const index = selectedTopics.indexOf(topicId);
      if (index > -1) selectedTopics.splice(index, 1);
      else selectedTopics.push(topicId);
      render();
    };
    window.selectAllTopics = () => { selectedTopics = topics.map(t => t.id); render(); };
    window.clearTopics = () => { selectedTopics = []; render(); };
    
    window.startSession = () => {
      if (selectedTopics.length === 0) return;
      
      if (sessionMode === 'quiz') {
        // UPGRADE 1: Pick exactly 10 questions per selected topic (or all if fewer than 10)
        const questionsPerTopic = 10;
        let pickedQuestions = [];
        
        selectedTopics.forEach(topicId => {
          const topicQuestions = quizBank.filter(q => q.topic === topicId);
          const picked = shuffleAndPickN(topicQuestions, questionsPerTopic);
          pickedQuestions = pickedQuestions.concat(picked);
        });
        
        if (pickedQuestions.length === 0) { alert('No questions available for selected topics'); return; }
        
        // Final shuffle so topics are interleaved
        sessionQuestions = shuffleArray(pickedQuestions);
        sessionAnswers = new Array(sessionQuestions.length).fill(null);
        currentIndex = 0;
        currentView = 'quiz';
      } else {
        // UPGRADE 2: Pick exactly 3 stations per selected topic (or all if fewer than 3)
        const stationsPerTopic = 3;
        let pickedStations = [];
        
        selectedTopics.forEach(topicId => {
          const topicStations = stationBank.filter(s => s.topic === topicId);
          const picked = shuffleAndPickN(topicStations, stationsPerTopic);
          pickedStations = pickedStations.concat(picked);
        });
        
        if (pickedStations.length === 0) { alert('No stations available for selected topics'); return; }
        
        // Final shuffle so topics are interleaved
        sessionStations = shuffleArray(pickedStations);
        currentIndex = 0;
        currentStationChecklist = {};
        stationNotes = {};
        flaggedStations = [];
        currentTab = 'brief';
        currentView = 'osce';
      }
      render();
    };

    window.closeNavigator = () => {
      document.getElementById('navigator-drawer').classList.remove('open');
      document.getElementById('navigator-overlay').classList.remove('visible');
    };
    window.openNavigator = () => {
      document.getElementById('navigator-drawer').classList.add('open');
      document.getElementById('navigator-overlay').classList.add('visible');
      renderNavigator();
    };

    window.answerQuestion = (optionIndex) => { sessionAnswers[currentIndex] = optionIndex; render(); };
    window.nextQuestion = () => { if (currentIndex < sessionQuestions.length - 1) { currentIndex++; render(); } };
    window.previousQuestion = () => { if (currentIndex > 0) { currentIndex--; render(); } };
    window.finishQuiz = () => { currentView = 'quizResults'; render(); };
    
    window.exitToSelection = () => {
      currentView = 'selection';
      selectedTopics = [];
      sessionQuestions = [];
      sessionAnswers = [];
      sessionStations = [];
      currentIndex = 0;
      currentStationChecklist = {};
      stationNotes = {};
      flaggedStations = [];
      render();
    };

    window.nextStation = () => { if (currentIndex < sessionStations.length - 1) { currentIndex++; currentTab = 'brief'; render(); } };
    window.previousStation = () => { if (currentIndex > 0) { currentIndex--; currentTab = 'brief'; render(); } };
    window.jumpToStation = (index) => { currentIndex = index; currentTab = 'brief'; render(); };
    window.switchTab = (tab) => { currentTab = tab; render(); };
    
    window.toggleChecklistItem = (stationId, item, checked) => {
      if (!currentStationChecklist[stationId]) currentStationChecklist[stationId] = {};
      currentStationChecklist[stationId][item] = checked;
      render();
    };
    window.updateStationNotes = (stationId, notes) => { stationNotes[stationId] = notes; };
    window.toggleFlag = () => {
      const stationId = sessionStations[currentIndex].id;
      const index = flaggedStations.indexOf(stationId);
      if (index > -1) flaggedStations.splice(index, 1);
      else flaggedStations.push(stationId);
      render();
    };
    window.finishOSCE = () => { currentView = 'osceResults'; render(); };

    // ==================== INITIALIZATION ====================
    async function onConfigChange(newConfig) {
      config = { ...config, ...newConfig };
      render();
    }

    window.finishOSCE = () => { currentView = 'osceResults'; render(); };

   // ==================== INITIALIZATION ====================
   function init() {
     createParticles();
     render();
   }

   init();
 </script>
</body>
</html>